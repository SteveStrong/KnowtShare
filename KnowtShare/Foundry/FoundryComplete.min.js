var Foundry=Foundry||{},fa,fo,saveAs,canonicalizeNewlines,Canvas2Image;(function(n){n.version="2.1.0";n.buildDate="01 May 2014 16:05:45 GMT"})(Foundry);Foundry=Foundry||{},function(n,t){function i(n){return n?String(n):""}n.dom={ul:function(n,i){return i==t?"<ul>"+n+"<\/ul>":"<ul id='"+i+"'>"+n+"<\/ul>"},li:function(n,i){return i==t?"<li>"+n+"<\/li>":"<li id='"+i+"'>"+n+"<\/li>"},p:function(n,i){return i==t?"<p>"+n+"<\/p>":"<p id='"+i+"'>"+n+"<\/p>"},span:function(n,i){return i==t?"<span>"+n+"<\/span>":"<span id='"+i+"'>"+n+"<\/span>"},div:function(n,i){return i==t?"<div>"+n+"<\/div>":"<div id='"+i+"'>"+n+"<\/div>"},pre:function(n,i){return i==t?"<pre>"+n+"<\/pre>":"<pre id='"+i+"'>"+n+"<\/pre>"},w:function(n,i){return i==t?"<div>"+n+"<br/><\/div>":"<div id='"+i+"'>"+n+"<br/><\/div>"}};n.traceEnabled=!1;n.trace={clr:function(){window.console&&window.console.clear&&window.console.clear()},exception:function(n){window.console&&window.console.log&&window.console.log(n)},log:function(n){window.console&&window.console.log&&window.console.log(n)},assert:function(t,i){n.traceEnabled&&window.console&&window.console.assert&&window.console.assert(t,i)},error:function(t){n.traceEnabled&&window.console&&window.console.error&&window.console.error(t)},warn:function(t){n.traceEnabled&&window.console&&window.console.warn&&window.console.warn(t)},info:function(t){n.traceEnabled&&window.console&&window.console.info&&window.console.info(t)},dir:function(t){if(n.traceEnabled&&window.console&&window.console.dir)try{window.console.dir(t)}catch(i){window.console.dir(i)}},assert:function(t,i){n.traceEnabled&&window.console&&window.console.assert&&window.console.assert(t,i)},funcTrace:function(t,i){var f=i?i+"()":t.callee.caller.toString().split(")")[0]+")",r,u;for(f+=" -> ",r=0;r<t.length;r++)u=t[r],f+=typeof u=="function"?" "+u.toString().split("(")[0]+", ":" "+u+", ";n.trace.log(f)},alert:function(n){window.alert&&window.alert(n)},writeLog:function(t){for(var i,u=t+" -> ",r=1;r<arguments.length;r++)i=arguments[r],u+=typeof i=="function"?" "+i.toString().split("(")[0]+", ":" "+i+", ";n.trace.log(u)},p:function(n,t){var r=document.createElement("div"),u,f;return r.innerHTML="<p>"+i(n)+"<\/p>",r.style.color="#0000FF",r.setAttribute("class","foundry-trace"),u=document.getElementById("debug"),f=t||u||document.body,f.appendChild(r),r},br:function(n){var t=document.createElement("div"),i,r;return t.innerHTML="<br/>",t.style.color="#0000FF",t.setAttribute("class","foundry-trace"),i=document.getElementById("debug"),r=n||i||document.body,r.appendChild(t),t},pre:function(n,t){var r=document.createElement("div"),u,f;return r.innerHTML="<pre>"+i(n)+"<\/pre>",r.style.color="#0000FF",r.setAttribute("class","foundry-trace"),u=document.getElementById("debug"),f=t||u||document.body,f.appendChild(r),r},w:function(n,t){var r=document.createElement("div"),u,f;return r.innerHTML=i(n)+"<br />",r.style.color="#0000FF",r.setAttribute("class","foundry-trace"),u=document.getElementById("debug"),f=t||u||document.body,f.appendChild(r),r},clear:function(n){var t=document.getElementById("debug"),i=n||t||document.body;return i.innerHTML="",this.clr(),!0},timerStart:function(n){var t=this.w("start :"+i(n)).style;return t.backgroundColor="#000000",t.color="#FFFFFF",{time:Date.now(),text:n}},timerReport:function(n,i){var u=(Date.now()-n.time)/1e3,r=this.w("report:"+n.text+" ("+u+" sec) "+(i==t?"":i)).style;return r.backgroundColor="#000000",r.color="#FFFFFF",{time:Date.now(),text:i||n.text}},reportValueChange:function(n){var t=n.asReference(),i;return n.initValueComputed?this.w("change: "+t+" is changed to formula: "+n.init.toString()):(i="<pre>"+n.owner.stringify(n)+"<\/pre>",this.w("change: "+t+" is changed to: "+i))},reportValueSmash:function(n){var i=n.asReference(),r=n.formula===t?"V: "+n.value:"F: "+n.formula.toString();return this.w("smash: "+i+" status: "+n.status+" "+r)},varifyValue:function(n,t,i,r){n[t]===i?this.w("CORRECT! The value of "+t+" == "+i,r).style.color="#00FF00":this.w("ERROR    The value of "+t+"("+n[t]+") != "+i,r).style.color="#FF0000"},reportValue:function(t,i,r){var f,u;if(this.w("The value of Property: "+i+" is "+t[i],r),t[i]instanceof n.Collection)for(f=t[i].elements,u=0;u<f.length;u++)this.w("["+u+"] is "+f[u],r)},reportProperties:function(n,t){for(var r,u=Object.keys(n),i=0;i<u.length;i++)r=u[i],"_"===r[0]&&this.reportValue(n,r.substring(1),t)},reportPropertyState:function(n,i,r){var u=n[i],e=u.asReference(),f=u.formula===t?"V:"+u.value:"F:"+u.formula.toString();f=u.status!==t?"Value=|"+u.value+"|":f;this.w("Property: "+e+" status: "+u.status+" "+f,r)},reportState:function(n,t){for(var r,u=Object.keys(n),i=0;i<u.length;i++)r=u[i],"_"===r[0]&&this.reportPropertyState(n,r,t)},reportDependencyState:function(t,i){function r(t){var i=n.utils.isArray(t.value)?"array["+t.value.length+"]total":t.value;return"|{0} s: {1} v: {2}| ".format(t.asReference(),t.status,i)}var f=this,u=t[i],o=u.thisValueDependsOn,e;o&&o[0]?o.forEach(function(n){f.w(r(u)+" Depends on "+r(n))}):f.w(r(u)+" Depends on NOTHING ");e=u.thisInformsTheseValues;e&&e[0]?e.forEach(function(n){f.w(r(u)+" Informs "+r(n))}):f.w(r(u)+" Informs NOTHING ")},reportDependencyNetwork:function(n,t){for(var r,u=Object.keys(n),i=0;i<u.length;i++)r=u[i],"_"===r[0]&&this.reportDependencyState(n,r,t)},inspectProperty:function(n,t,i){var r=n[t];this.w("Property: "+r.asReference(),i);this.pre(r.stringify(),i)},inspect:function(n,t){for(var r,u=Object.keys(n),i=0;i<u.length;i++)r=u[i],"_"===r[0]&&this.inspectProperty(n,r,t);this.dir(n)},reportStructure:function(i,r,u){function f(t){var u=r(t),e=n.dom.div(u),i=n.dom.li(e,t.getID());return t.Subcomponents.isNotEmpty()&&(i=t.Subcomponents.mapReduce(function(t){return n.dom.ul(f(t))},function(n,t){return n+t},i)),i}r===t&&(r=function(n){return n.toString()});var o=f(i),s=document.getElementById("debug"),h=u||s||document.body,e=document.createElement("div");h.appendChild(e);e.innerHTML=o}}}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n,t){Array.prototype.every||(Array.prototype.every=function(n){for(var i=new Object(this),t=0,r=i.length>>>0;t<r;t++)if(t in i&&!n.call(arguments[1],i[t],t,i))return!1;return!0});Array.prototype.map||(Array.prototype.map=function(n){for(var r=[],i=new Object(this),t=0,u=i.length>>>0;t<u;t++)t in i&&r.push(n.call(arguments[1],i[t],t,i));return r});Array.prototype.filter||(Array.prototype.filter=function(n){for(var u=[],r,i=new Object(this),t=0,f=i.length>>>0;t<f;t++)r=i[t],t in i&&n.call(arguments[1],r,t,i)&&u.push(r);return u});Array.prototype.firstWhere||(Array.prototype.firstWhere=function(n){for(var r,u,i=0;i<this.length;i++)if(r=this[i],u=n==t?!0:n(r),u)return r});Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)=="[object Array]"});Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var i=new Object(this),r=i.length>>>0,t;if(!r)return-1;for(t=0,arguments.length>1&&(t=arguments[1]),t=t>=0?t:Math.max(0,r+t);t<r;t++)if(t in i&&i[t]===n)return t;return-1});Array.prototype.insert||(Array.prototype.insert=function(n,t){this.splice(n,0,t)});Array.prototype.max||(Array.prototype.max=function(){var n,i;if(this.length==0)return t;for(n=Number(this[0]),i=1;i<this.length;i++)n=Math.max(n,this[i]);return n});Array.prototype.min||(Array.prototype.min=function(){var n,i;if(this.length==0)return t;for(n=Number(this[0]),i=1;i<this.length;i++)n=Math.min(n,this[i]);return n});Array.prototype.sortOn||(Array.prototype.sortOn=function(n,t){var i=t?-1:1;return n?this.sort(function(t,r){return t[n]<r[n]?-1*i:t[n]>r[n]?1*i:0}):this});Array.prototype.forEach||(Array.prototype.forEach=function(n){for(var t=0,i=this.length>>>0;t<i;t++)n(this[t])});Array.prototype.indexOfFirst||(Array.prototype.indexOfFirst=function(n){for(var t=0,i=this.length;t<i;t++)if(n(this[t]))return t;return-1});Array.prototype.itemByIndex||(Array.prototype.itemByIndex=function(n){return n<0||n>this.length?t:this[n]});Array.prototype.contains||(Array.prototype.contains=function(n){for(var t=0,i=this.length;t<i;t++)if(this[t]==n)return!0});Array.prototype.distinctItems||(Array.prototype.distinctItems=function(){for(var t=[],n=0,i=this.length;n<i;n++)t.indexOf(this[n])<0&&t.push(this[n]);return t});Array.prototype.addNoDupe||(Array.prototype.addNoDupe=function(n){this.length===0?this.push(n):this.length===1&&n!==this[0]?this.push(n):(found=this.indexOf(n),found===-1&&this.push(n))});Array.prototype.prependNoDupe||(Array.prototype.prependNoDupe=function(n){this.length===0?this.push(n):this.length===1&&n!==this[0]?this.splice(0,0,n):(found=this.indexOf(n),found===-1&&this.splice(0,0,n))});Array.prototype.peek||(Array.prototype.peek=function(){if(this.length>0){var n=this.length-1;return this[n]}});Array.prototype.isEmpty||(Array.prototype.isEmpty=function(){return this.length==0});Array.prototype.isNotEmpty||(Array.prototype.isNotEmpty=function(){return this.length>0});Array.prototype.remove||(Array.prototype.remove=function(n,t){var i=this.slice((t||n)+1||this.length);return this.length=n<0?this.length+n:n,this.push.apply(this,i)});Array.prototype.removeItem||(Array.prototype.removeItem=function(n){var t=this.indexOf(n);return t<0?this:this.remove(t)});Array.prototype.duplicate||(Array.prototype.duplicate=function(){for(var t=new Array(this.length),n=0;n<this.length;n++)t[n]=this[n];return t});Array.prototype.uniqueValue||(Array.prototype.uniqueValue=function(n,t){for(var f,r,i=t?t:{},u=0;u<this.length;u++)f=this[u],r=n(f),i[r]?i[r]+=1:i[r]=1;return i});Array.prototype.groupBy||(Array.prototype.groupBy=function(n,t){for(var r,u,i=t?t:{},f=0;f<this.length;f++)r=this[f],u=n(r),i[u]?i[u].push(r):i[u]=[r];return i});String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};String.prototype.fulltrim=function(){return this.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")};String.prototype.removeSpaces=function(){return this.replace(/\s+/g,"")};String.prototype.format=function(){for(var i,t=this,n=0;n<arguments.length;n++)i=new RegExp("\\{"+n+"\\}","gi"),t=t.replace(i,arguments[n]);return t};String.prototype.matches||(String.prototype.matches=function(n){return n?this.toLocaleLowerCase()==n.toLocaleLowerCase():n==this});String.prototype.startsWith=function(n){return this.match("^"+n)==n};String.prototype.endsWith=function(n){return this.match(n+"$")==n};String.prototype.containsString=function(n){return this.indexOf(n)!=-1};String.prototype.contains||(String.prototype.contains=function(n){return this.toLocaleLowerCase().containsString(n.toLocaleLowerCase())});String.prototype.begins=function(n){return this[0]===n};String.prototype.ends=function(n){return this[this.length-1]===n};Function.prototype.debounce||(Function.prototype.debounce=function(n,t){var r=this,i;return function(){function e(){t||r.apply(u,f);i=null}var u=this,f=arguments;i?clearTimeout(i):t&&r.apply(u,f);i=setTimeout(e,n||100)}});Function.prototype.wait100||(Function.prototype.wait100=function(){function i(){return n.apply(n,t)}var n=this,t=arguments;setTimeout(i,100)});Function.prototype.wait200||(Function.prototype.wait200=function(){function i(){return n.apply(n,t)}var n=this,t=arguments;setTimeout(i,200)});Function.prototype.wait500||(Function.prototype.wait500=function(){function i(){return n.apply(n,t)}var n=this,t=arguments;setTimeout(i,500)});Function.prototype.wait1000||(Function.prototype.wait1000=function(){function i(){return n.apply(n,t)}var n=this,t=arguments;setTimeout(i,1e3)})}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n,t){n.lastGUID=0;n.newGuid=function(){return n.lastGUID+=1,n.lastGUID};n.utils={replaceAll:function(n,t){return this.split(n).join(t)},createID:function(t){var i=n.newGuid();return t&&(i=new String(t).replace(/ /g,"_")+"_"+i),i},generateUUID:function(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(t=="x"?i:i&7|8).toString(16)})},removeCRLF:function(n){return n.replace(/(\r\n|\n|\r)/gm," ")},removeExtraSpaces:function(n){return n.replace(/\s{2,}/g," ")},removeJSComments:function(n){return n.replace(/\/\*.+?\*\/|\/\/.*(?=[\n\r])/g,"")},cleanFormulaText:function(t){var i=t.toString();return n.utils.removeExtraSpaces(n.utils.removeCRLF(n.utils.removeJSComments(i)))},cleanTemplateHtml:function(t){var i=t;return n.utils.removeCRLF(t)},capitaliseFirstLetter:function(t){var i=n.utils.asString(t);return i.charAt(0).toUpperCase()+i.slice(1)},asString:function(n){return n===t?"":n.toString()},asInt:function(n,t){var r=t?t:0,i=parseInt(n);return isNaN(i)?r:i},isArray:function(n){return Array.isArray?Array.isArray(n):Object.prototype.toString.call(n)==="[object Array]"?!0:!1},isFunction:function(n){return typeof n=="function"},isString:function(n){return typeof n=="string"},isNumber:function(n){return typeof n=="number"},isObject:function(n){return n&&typeof n=="object"},asArray:function(i){return n.utils.isaCollection(i)?i.elements:n.utils.isArray(i)?i:i===t?[]:[i]},objectToArray:function(i){var r,u;if(n.utils.isaCollection(i))return i.elements;if(n.utils.isArray(i))return i;if(n.utils.isObject(i)){r=[];for(u in i)i.hasOwnProperty(u)&&r.push(i[u]);return r}return i?[i]:t},removeDuplicates:function(n){for(var f,u,i=[],e=n.length,r=0;r<e;r++){for(f=t,u=0;u<i.length;u++)if(origArr[r]===i[u]){f=!0;break}f||i.push(origArr[r])}return i},getParamNames:function(n){var t=n.toString();return t.slice(t.indexOf("(")+1,t.indexOf(")")).match(/([^\s,]+)/g)},hasAspect:function(n,t){return n&&(n[t]||n[t.toLowerCase()])},getAspectOrDefault:function(n,t){return n[t]?n[t]:n[t.toLowerCase()]?n[t.toLowerCase()]:n},extractSlots:function(n,t){var u={},i,r;for(i in n)n.hasOwnProperty(i)&&(r=n[i],t(r)&&(u[i]=r));return u},isSelf:function(n){return n.matches("@")||n.matches("this")||n.matches("self")},isaCollection:function(t){return t instanceof n.Collection?!0:!1},asCollection:function(t,i){return n.utils.isaCollection(t)?t:new n.Collection(n.utils.asArray(t),i)},isaComponent:function(t){return t instanceof n.Component?!0:!1},isaRelationship:function(t){return t instanceof n.Relationship?!0:!1},isaProperty:function(t){return t instanceof n.Property?!0:!1},isManaged:function(n){return this.isaComponent(n)||this.isaCollection(n)||this.isaProperty(n)},isArrayOrCollection:function(n){return this.isArray(n)||this.isaCollection(n)},isaPromise:function(t){return t instanceof n.Promise?!0:!1},forEachValue:function(n,t){var i=[],r=n?Object.keys(n):[];return r.forEach(function(r){var f=n[r],u=t(r,f);u&&i.push(u)}),i},findKeyForValue:function(n,t){for(var i in n)if(n[i].matches(t))return i},propEq:function(n,t){return function(i){return i[n]===t}},debounce:function(n,t,i){return n.debounce(t,i)},pluck:function(n){return function(t){return t[n]}},getNamespace:function(n){var t=n.myType.split("::");return t[0]},getType:function(n){var t=n.myType.split("::");return t.length==2?t[1]:t[0]},isComment:function(n){return n.startsWith("//")},comment:function(t){return n.utils.isComment(t)?t:"//"+t},unComment:function(t){return n.utils.isComment(t)?t.substring(2):t},bindingStringToObject:function(n){var i=t,f,r,e,u,o,s;if(n)for(f=n.split(","),r=0;r<f.length;r++)(e=f[r],u=e.split(":"),u.length!=1)&&(i=i||{},o=decodeURI(u[1].trim()),s=decodeURI(u[0].trim()),i[o]=s);return i},stylingStringToObject:function(n){var i=t,f,r,e,u,o,s;if(n)for(f=n.split(","),r=0;r<f.length;r++)(e=f[r],u=e.split(":"),u.length!=1)&&(i=i||{},o=decodeURI(u[0].trim()),s=decodeURI(u[1].trim()),i[o]=s);return i},queryStringToObject:function(n,i){var r=t,i,e,u,o,f,s,h;if(n)for(i=i===t?"&":i,e=n.split(i),u=0;u<e.length;u++)if(o=e[u],o){if(f=o.split("="),f.length==1)continue;r=r||{};s=decodeURI(f[0].trim());h=decodeURI(f[1].trim());r[s]=h}return r},hashStringToArray:function(n,i){var e=t,i,u,r,f;if(n)for(i=i===t?"#":i,u=n.split(i),r=0;r<u.length;r++)f=u[r],f&&(e=f.split("/").map(function(n){return decodeURI(n.trim())}));return e},objectToQueryString:function(n,i){var r="",u,f,e;if(n&&(u=Object.keys(n),u.length>0)){for(f=0;f<u.length;f++)(e=u[f],n[e]!==t)&&(r+="&"+e+"="+n[e]);i&&(r="?"+r.substring(1))}return r},clone:function(t){var r,f,i,u;if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return i=new Date,i.setTime(t.getTime()),i;if(t instanceof Array){for(i=[],r=0,f=t.length;r<f;r++)i[r]=n.utils.clone(t[r]);return i}if(t instanceof Object){i={};for(u in t)t.hasOwnProperty(u)&&(i[u]=n.utils.clone(t[u]));return i}throw new Error("Unable to copy obj! Its type isn't supported.");},getOwnPropertyValues:function(n){var t=[];for(var i in n)hasOwnProperty.call(n,i)&&t.push(n[i]);return t},makeComputedValue:function(t,i,r){var u=n.utils.isFunction(r);return Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:function(){return u?result=r.call(t,t):r}}),t},extendWithComputedValues:function(t,i){if(t&&i)for(var r in i)hasOwnProperty.call(i,r)&&n.utils.makeComputedValue(t,r,i[r]);return t},extend:function(n,t){if(!t)return n;for(var i in t)hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n},mixExtend:function(n,t){if(!t)return n;for(var i in t)hasOwnProperty.call(n,i)||(n[i]=t[i]);return n},mixin:function(n,t){if(!t)return n;if(!n)return t;for(var i in t)n[i]=t[i];return n},mixout:function(n,t){if(!t)return n;if(!n)return t;for(var i in t)n.hasOwnProperty(i)&&delete n[i];return n},union:function(n,t){var r={},i;if(n)for(i in n)r[i]=n[i];if(t)for(i in t)r[i]=t[i];return r},getEvent:function(n){return n||window.event},getEventSource:function(t){var i=n.utils.getEvent(t);return i.srcElement||i.originalTarget},getParentElement:function(n){if(n&&n.parentNode)return n.parentNode},getParentElementWithClassName:function(n,t){var i=n;if(t)while(i&&i.className!=t&&i.parentNode)i=i.parentNode;else i&&(i=i.parentNode);return i},getParentElementWithAttribute:function(n,i){for(var r=n;r&&r.hasAttribute&&r.hasAttribute(i)==!1;r=r.parentNode);return r&&r.hasAttribute&&r.hasAttribute(i)?r:t},urlCasheBuster:function(n){var t=Math.round((new Date).getTime()/1e3),i=n.indexOf("?")>=0?"&cb=":"?cb=";return n+i+t},xmlHttpGet:function(n,t,i){var r=new XMLHttpRequest;r.onload=function(){var n=r.responseText;t&&t(n,r)};try{r.open("GET",n,!1);r.send(null)}catch(u){i&&i(u,r)}},loadTemplate:function(t,i){n.utils.xmlHttpGet(t,function(n){var r=document.getElementsByTagName("head")[0],t=document.createElement("div");t.innerHTML=n;r.appendChild(t);i&&i()})},captureLine:function(){function i(n){var r=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(n),t,i;return r?[r[1],Number(r[2])]:(t=/at ([^ ]+):(\d+):(?:\d+)$/.exec(n),t)?[t[1],Number(t[2])]:(i=/.*@(.+):(\d+)$/.exec(n),i?[i[1],Number(i[2])]:void 0)}var f;try{throw new Error;}catch(r){var n=r.stack.split("\n"),u=n[0].indexOf("@")>0?n[1]:n[2],t=i(u);return t?(f=t[0],t[1]):void 0}}}}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n,t){var u=0,f,r;globalDependencyLock=function(n){return u=u+n,u==0,u};n.suspendDependencies=function(n,t){globalDependencyLock(1);n&&n(t);globalDependencyLock(-1)};f=function(i,r,u){var o="_"+r,e,f;return u==null&&(u=function(){return null}),e=n.utils.isFunction(u),u===fo.fromParent&&(u=function(){return fo.fromParent.call(i,r)}),this.myName=r,this.owner=i,this.formula=e?u:t,this.status=!e&&u!==t?"init":t,this.value=e?t:u,this.thisValueDependsOn=t,this.thisInformsTheseValues=t,this.uiBindings=t,this.onRefreshUi=t,this.onValueSet=t,this.onValueDetermined=t,this.onValueSmash=t,n.utils.isaCollectionSpec(this.value)?(f=this.value.createCollection(i),f.myName=r,this.value=f):n.utils.isaCollection(this.value)&&this.value.owner===t&&(f=n.makeCollection(this.value.elements,i),f.myName=r,this.value=f),Object.defineProperty(i,r,{enumerable:!0,configurable:!0,set:function(r){var u=i[o],s=u.value,e=n.utils.isFunction(r),f=e?t:r,h=s==f;if(!u.status||!h||e){if(u.guard){u.smash();return}i.withDependencies?(u.smash(),u.removeSmashTrigger()):r===t&&u.formula!==t&&(f=u.formula.call(u.owner));u.value=f;u.formula=e?r:u.formula;u.status=e?t:"given";fo.publishNoLock("setValue",[u,f]);e||(n.markForRefresh(u),u.onValueSet&&u.onValueSet.call(u,f,u.formula,u.owner),u.formula&&u.validate&&u.validate.call(u,f,u.owner))}},get:function(){var u=i[o],f,h=u.status===t,e,s,c;if(!i.withDependencies)return h&&u.formula!==t&&(f=u.formula.call(u.owner),fo.publishNoLock("setValueTo",[u,f]),u.value=f),u.value;if(e=i.globalComputeStack(),s=e?e.peek():t,h){if(s===u)return fo.publishNoLock("getValue",[u,u.value]),u.value;h&&(fo.publishNoLock("mustCompute",[u]),u.formula!==t?(e&&e.push(u),f=u.formula.call(u.owner,u),u.status=f===t?t:"calculated",c=e?e.pop():u,c!=u&&n.trace&&n.trace.alert("during compute: Something is not working")):(f=u.defaultValue,f===t&&n.utils.isFunction(u.defaultFormula)&&(f=u.defaultFormula.call(u.owner,u)),u.status=f===t?t:"default"),s&&s.addDependency(u),n.utils.isaCollection(f)&&f.owner===t&&(f.owner=i,f.myName=r),fo.publishNoLock("setValueTo",[u,f]),u.onValueDetermined&&u.onValueDetermined.call(u,f,u.formula,u.owner),u.value=f)}else return s===t?u.value:(s.addDependency(u),fo.publishNoLock("getValue",[u,u.value]),u.value);return f}}),i[o]=this,this};f.prototype={getID:function(){return this.guid?this.guid:(this.guid=n.utils.createID(this.myName),this.guid)},redefine:function(i,r){this.smash();var u=n.utils.isFunction(i);this.formula=u?i:t;this.status=u?t:"given";this.value=u?t:i;r&&(this.guard=r)},asLocalReference:function(){try{return this.owner._name?this.owner._name&&this.owner._name.status?this.myName+"@"+this.owner.myName:this.myName+"@OWNER_NAME_NOT_COMPUTED":this.myName+"@"+this.owner.myName}catch(n){return this.myName+"@???"}},asReference:function(){return this.myName+"@"+this.owner.asReference()},asDisplayValue:function(){return fo.utils.isManaged(this.value)?"=> "+this.value.myName:this.value},resolveReference:function(t){if(this.myName.match(t)||n.utils.isSelf(t))return this;return this.owner.resolveReference(t)},resolveSuperior:function(t){if(this.myName.match(t)||n.utils.isSelf(t))return this;return this.owner.resolveSuperior(t)},resolveProperty:function(n){var i={};return i.property=this,i.meta=n&&"@".matches(n)?t:n,i},getProperty:function(n,i){return n.matches(this.myName)?this:i&&this.owner?this.owner.getProperty(n,i):t},smashProperty:function(n,t){var i=this.getProperty(n,t);return i&&i.status&&i.smash(),i},smashPropertyTree:function(n){var i=this.smashProperties(n),t=this.myParent;return t?t.smashPropertyTree(n):i},smashPropertyBranch:function(n){this.smashProperties(n);this.Subcomponents.forEach(function(t){t.smashPropertyBranch(n)})},addDependency:function(n){return this===n?this:u?this:(this.thisValueDependsOn===t&&(this.thisValueDependsOn=[]),this.thisValueDependsOn.addNoDupe(n),fo.publishNoLock("nowDependsOn",[this,n]),n.thisInformsTheseValues===t&&(n.thisInformsTheseValues=[]),n.thisInformsTheseValues.addNoDupe(this),fo.publishNoLock("nowInforms",[n,this]),this)},removeDependency:function(n){return this.thisValueDependsOn?this.thisValueDependsOn.removeItem(n):fo.publishNoLock("dependsOnNotRemoved",[this,n]),n.thisInformsTheseValues?n.thisInformsTheseValues.removeItem(this):fo.publishNoLock("informsNotRemoved",[n,this]),fo.publishNoLock("noLongerDependsOn",[this,n]),this},valueDependsOnCount:function(){return this.thisValueDependsOn?this.thisValueDependsOn.length:0},informsTheseValuesCount:function(){return this.thisInformsTheseValues?this.thisInformsTheseValues.length:0},removeSmashTrigger:function(){var n=this;this.valueDependsOnCount()>0&&(this.thisValueDependsOn.length==1?this.removeDependency(this.thisValueDependsOn[0]):this.thisValueDependsOn.duplicate().forEach(function(t){n.removeDependency(t)}))},isolateFromSmash:function(){this.thisValueDependsOn&&this.thisValueDependsOn.length>0&&(this.removeSmashTrigger(),this.thisValueDependsOn=[]);this.status="isolated";fo.publishNoLock("isolated",[this])},smash:function(){var i,r;return this.status&&(this.onValueSmash&&this.onValueSmash.call(this,this.value,this.formula,this.owner),this.formula?this.status=t:this.status!="init"&&(this.status=t),fo.publishNoLock("smash",[this,this.value]),i=this,i.smashAndRemove=function(n){n.removeDependency(i);n.status&&(fo.publishNoLock("smashed",[i]),n.status&&fo.publishNoLock("thenSmashes",[n]));n.smash()},this.informsTheseValuesCount()>0&&(this.thisInformsTheseValues.length==1?i.smashAndRemove(this.thisInformsTheseValues[0]):(r=this.thisInformsTheseValues.duplicate(),this.thisInformsTheseValues=[],r.forEach(i.smashAndRemove))),(this.uiBindings||this.onRefreshUi)&&n.markForRefresh(this)),this},addBinding:function(i,r){return this.uiBindings=this.uiBindings===t?[]:this.uiBindings,n.utils.isFunction(i)?(this.uiBindings.push(i),r!==!1&&n.markForRefresh(this)):n.trace.alert("Binding must be a formula"),this},clearBinding:function(){if(this.uiBindings!==t)return this.uiBindings=t,this},purgeBindings:function(){var n=this.uiBindings!==t;return this.uiBindings&&this.uiBindings.length&&this.uiBindings.forEach(function(n){delete n}),this.uiBindings=t,n},updateBindings:function(){var r,u;if(this.uiBindings!==t){r=this.uiBindings.duplicate();try{for(i=0;i<r.length;i++)u=r[i],u.call(this,this,this.owner)}catch(f){n.trace&&n.trace.alert(f)}}return this},stringify:function(i){function u(i,r){switch(i){case"owner":case"myParent":return r?r.asReference():r;case"formula":return n.utils.isFunction(r)?n.utils.cleanFormulaText(r):r;case"thisValueDependsOn":case"thisInformsTheseValues":case"uiBindings":case"onRefreshUi":return t}return n.utils.isaPromise(r)?"Promise":r}var r=i||this;return JSON.stringify(r,u,3)},refreshUi:function(){return this.updateBindings(),this.onRefreshUi&&(this.getValue(),this.onRefreshUi.call(this,this,this.owner)),this},doCommand:function(i,r,u){var f,e;return this.status?this.value:(f=this.formula,r!==t&&n.utils.isFunction(this[r]))?(f=this[r],f.call(this,i)):f!==t?(e=f.call(this.owner,i,r,u),this.status=e===t?t:"calculated",this.value=e,e):f===t?this.getValue(r):void 0},isValueKnown:function(){return this.status?!0:!1},getValue:function(n){if(n===t)return this.owner[this.myName];return this.getMetaData(n)},getValueAsync:function(t){var i=this.getValue(t),r;return n.utils.isaPromise(i)?i:(r=new n.Promise(this.owner,t),r.value=i,r)},setValue:function(n){this.owner[this.myName]=n},refreshValue:function(t){var i=this;n.runWithUIRefreshLock(function(){i.setValue(t)})},getMetaData:function(i,r){if(i===t||this[i]===t)return r;var u=r,f=this[i];return(n.utils.isFunction(f)?u=f.call(this):f!==t&&(u=f),n.utils.isaPromise(u)&&r!==t)?r:u},getMetaDataAsync:function(i,r){var u=this.getMetaData(i,r),f;return n.utils.isaPromise(u)?u:(u=u?u:this.status?this.value:t,f=new n.Promise(this.owner,i),f.value=u,f)},setMetaData:function(n,i){return n!==t&&(this[n]=i),this},extendWith:function(n){for(var t in n)n.hasOwnProperty(t)&&(this[t]=n[t]);return this},createView:function(n,t){var i=n&&this[n]?this[n]:this;return i.makeUi?i.makeUi.call(this,t):""},extendUi:function(n){var i=this;for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return this},reCompute:function(){if(this.formula)return this.smash(),this.compute()},compute:function(){return this.getValue()}};n.Property=f;r=function(t){return this.base=n.Property,this.base(t,"count",function(){return this.elements.length}),this};r.prototype=function(){var t=function(){this.constructor=r};return t.prototype=n.Property.prototype,new t}();r.prototype.smash=function(){return this.base.prototype.smash.call(this)};r.prototype.addDependency=function(n){return this.base.prototype.smash.addDependency(this,n)};r.prototype.removeDependency=function(n){return this.base.prototype.smash.removeDependency(this,n)};r.prototype.asLocalReference=function(){var n=this.myName+"@"+this.owner.myName;return this.owner.owner&&(n+="."+this.owner.owner.myName),n};n.Counter=r}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n,t){var i=function(n,t,i){this.elements=n?n:[];this.baseSpec=t;this.uponCreation=i};i.prototype={createCollection:function(i){var r=this.baseSpec,f=this.elements.map(function(u){var f=u,e=u.spec?u.spec:n.utils.isObject(u)?u:t,o=u.myName?u.myName:n.utils.isString(u)?u:t;return n.utils.isaComponent(f)||(f=n.makeComponent(r?r:e,t,i),r!==t&&f.extendWith(e),o&&(f.myName=o)),f.myParent=f.myParent?f.myParent:i,f}),u=n.makeCollection(f,i);return this.uponCreation&&u.forEach(this.uponCreation),u},createSubcomponents:function(i){var r=this.baseSpec,u=this.elements.map(function(u){var f=u,e=u.spec?u.spec:n.utils.isObject(u)?u:t,o=u.myName?u.myName:n.utils.isString(u)?u:t;return n.utils.isaComponent(f)?i.addSubcomponent(f):(f=i.createSubcomponent(r?r:e),r!==t&&f.extendWith(e),o&&(f.myName=o)),f});return this.uponCreation&&u.forEach(this.uponCreation),u}};n.CollectionSpec=i;n.utils.isaCollectionSpec=function(t){return t instanceof n.CollectionSpec?!0:!1}}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n,t){var r=function(i,r,u){this.myName=t;this.owner=r;this.elements=i===t?[]:i;this.withDependencies=!0;var f=new n.Counter(this);return u&&n.utils.extendWithComputedValues(this,u),this},i;r.prototype={getID:function(){return this.guid?this.guid:(this.guid=n.utils.createID(this.myName),this.guid)},globalComputeStack:function(){return this.owner?this.owner.globalComputeStack():t},currentComputingProperty:function(){var n=this.globalComputeStack();return n&&n.peek()},findByName:function(n){return this.firstWhere(function(t){return t.myName&&t.myName.matches(n)})},stringify:function(n){function r(n,i){switch(n){case"owner":case"myParent":return i?i.asReference():i;case"thisValueDependsOn":case"thisInformsTheseValues":case"uiBindings":case"onRefreshUi":case"trace":return t}return i}var i=n||this;return JSON.stringify(i,r,3)},getSpec:function(n){if(this.count==0)return t;return this.elements.map(function(t){return t.getSpec(n)})},asReference:function(){return this.owner===t?this.myName?this.myName:"collection":this.owner.asReference()+"."+this.myName},smash:function(){var n=this._count;n.status&&(fo.publishNoLock("smash",[n]),n.smash())},purgeBindings:function(n){var t=!1;return this.elements.forEach(function(i){t=i.purgeBindings(n)||t}),t},resolveProperty:function(n){alert("please bind to a data-repeater"+n)},resolveSuperior:function(t){if(this.myName.match(t)||n.utils.isSelf(t))return this;return this.owner.resolveSuperior(t)},resolvePropertyReference:function(i){var r={},o=this,e,f,u;return i.containsString("#")?(e=i.split("#"),r=this.resolvePropertyReference(e[0]),r.meta=e[1],r):(f=o.getProperty(i),u=t,f===t?u=o[i]:(r.property=f,f.status&&(u=f.value)),n.utils.isaCollection(u)?r.collection=u:n.utils.isaComponent(u)&&(r.component=u),r)},getProperty:function(n,t){var r="_"+n,i=this[r];return i?i:t&&this.myParent?this.myParent.getProperty(n,t):i},smashProperty:function(n,t){var i=this.getProperty(n,t);return i&&i.status&&i.smash(),i},smashPropertyTree:function(n){var i=this.smashProperties(n),t=this.myParent;return t?t.smashPropertyTree(n):i},smashPropertyBranch:function(n){this.smashProperties(n);this.Subcomponents.forEach(function(t){t.smashPropertyBranch(n)})},smashProperties:function(n,t){var i=this,r=fo.utils.isArray(n)?n:n.split(",");return r.forEach(function(n){i.smashProperty(n,t)}),i},getMetaData:function(i,r){if(i===t||this[i]===t)return r;var u=r,f=this[i];return(n.utils.isFunction(f)?u=f.call(this):f!==t&&(u=f),n.utils.isaPromise(u)&&r!==t)?r:u},getMetaDataAsync:function(t,i){var u=this.getMetaData(t,i),r;return n.utils.isaPromise(u)?u:(r=new Promise(this.owner,t),r.value=this,r)},setMetaData:function(n,i){return n!==t&&(this[n]=i),this},getValue:function(n){return n!==t,this},push:function(n){return n&&(this.elements.push(n),this.smash()),n},addList:function(n){return n&&(this.elements=this.elements.concat(n),this.smash()),this},addNoDupe:function(n){return n&&(this.elements.addNoDupe(n),this.smash()),n},prependNoDupe:function(n){return n&&(this.elements.prependNoDupe(n),this.smash()),n},insertNoDupe:function(n,t){return t&&this.elements.indexOf(t)==-1&&(this.elements.insert(n,t),this.smash()),t},pop:function(){var n=this.elements.pop();return this.smash(),n},peek:function(){if(this.elements&&this.elements.length>0){var n=this.elements.length-1;return this.elements[n]}},item:function(n){return this.elements[n]},first:function(){return this.elements.length>0?this.elements[0]:t},last:function(){var n=this.elements.length-1;return n>=0?this.elements[n]:t},next:function(n,t){var i=this.indexOf(n)+1;return i>=this.elements.length?t?this.first():n:this.elements[i]},previous:function(n,t){var i=this.indexOf(n)-1;return i<0?t?this.last():n:this.elements[i]},add:function(i){if(i===t)return i;if(n.utils.isArray(i))for(var r=0;r<i.length;r++)this.elements.push(i[r]);else this.elements.push(i);return this.smash(),i},reset:function(n){return this.clear(),this.add(n)},remove:function(n){var t=this.elements.length,i=this.elements.removeItem(n).length;return t!==i&&this.smash(),n},removeWhere:function(n){for(var i=this.filter(n).elements,t=0;t<i.length;t++)this.remove(i[t]);return this},sumOver:function(n){return this.reduce(function(n,t){return n+t},n?n:0)},commaDelimited:function(n){var t=n?n:",";return this.reduce(function(n,i){return n+(i+t)},"")},slice:function(n,t){return this.elements.slice(n,t)},members:function(){return this.copyTo([])},membersWhere:function(i,r){var u=r===t?n.makeCollection([],this):r;return this.count>0&&this.copyWhere(i,u),u},isEmpty:function(){return this.elements.isEmpty()},isNotEmpty:function(){return this.elements.isNotEmpty()},copyTo:function(n){for(var i=n?n:[],t=0;t<this.elements.length;t++)i.push(this.elements[t]);return i},copyWhere:function(n,i){for(var u,e,f=i?i:[],r=0;r<this.elements.length;r++)u=this.elements[r],e=n==t?!0:n(u),e&&f.push(u);return f},firstWhere:function(n){for(var r,u,i=0;i<this.elements.length;i++)if(r=this.elements[i],u=n==t?!0:n(r),u)return r},clear:function(){this.elements=[];this.smash()},indexOf:function(n){return this.elements.indexOf(n)},indexOfFirst:function(n){return this.elements.indexOfFirst(n)},itemByIndex:function(n){return this.elements.itemByIndex(n)},duplicate:function(){var t=n.makeCollection();return this.count===0?t:(this.copyTo(t),t)},filter:function(t){var i=n.makeCollection();return this.count===0?i:this.copyWhere(t,i)},sortOn:function(t){var i=!1,r;return t&&(r=this.elements.sort(function(n,r){var u=n[t]<r[t]?-1:n[t]>r[t]?1:0;return u<0&&(i=!0),u})),i&&(this.elements=r,n.trace&&n.trace.error("SORTING SMASHED THE COLLECTION"),this.smash()),this},forEach:function(n){return this.count===0?t:this.elements.forEach(n)},map:function(n){return this.count===0?this.elements:this.elements.map(n)},reduce:function(n,i){return this.count===0?t:this.elements.reduce(n,i)},mapReduce:function(n,t,i){return this.elements.map(n).reduce(t,i)},sumAll:function(t,i){var r=n.utils.pluck(t),u=function(n,t){return n+t};return this.elements.map(r).reduce(u,i?i:0)},maxAll:function(i,r){var u=n.utils.pluck(i),f=function(n,t){return Math.max(n,t)};return this.elements.map(u).reduce(f,r!==t?r:-Infinity)},minAll:function(i,r){var u=n.utils.pluck(i),f=function(n,t){return Math.min(n,t)};return this.elements.map(u).reduce(f,r!==t?r:Infinity)},selectComponents:function(i,r){var f=r===t?n.makeCollection([],this):r,u,e;if(this.count>0)for(this.copyWhere(i,f),u=0;u<this.elements.length;u++)e=this.elements[u],e.selectComponents(i,f);return f}};i=function(t,i,u){this.base=r;var f=n.utils.isaCollection(t)?t.elements:t;return this.base(f,i),this.indexName=u,this.sortOn(this.indexName),this.synchronizeElements(),this};i.prototype=function(){var n=function(){this.constructor=i};return n.prototype=r.prototype,new n}();i.prototype.setItemIndex=function(i,r){return this.indexName===t?i:(i[this.indexName]!==t?i[this.indexName]=r:n.utils.isaComponent(i)?i.createProperty(this.indexName,r):i[this.indexName]=r,i)};i.prototype.synchronizeElements=function(){for(var i,t=this.elements,n=0;n<t.length;n++)i=t[n],this.setItemIndex(i,n);this.markForRefresh()};i.prototype.markForRefresh=function(){return n.markForRefresh(this.getProperty("count")),this};i.prototype.addItem=function(n){var t=this.add(n);return this.setItemIndex(t,this.elements.length-1),this.markForRefresh(),n};i.prototype.removeItem=function(n){var t=this.remove(n);return n.getProperty(this.indexName)&&n.deleteProperty(this.indexName),delete t[this.indexName],this.synchronizeElements(),t};i.prototype.swapItemTo=function(n,i){if(i<0||i>this.count-1||isNaN(i))return n;var u=this.elements[i],r=n[this.indexName];return r!==t&&(this.elements[i]=this.setItemIndex(n,i),this.elements[r]=this.setItemIndex(u,r),this.markForRefresh()),n};n.Collection=r;n.OrderedCollection=i}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n,t){function u(n){return n+"Begin"}function f(n){return n+"Complete"}function s(t,i,r){var u=new Blob([t],{type:"text/plain;charset=utf-8"});n.writeBlobFile(u,i,r)}var o=function(i,r,u){var f,e;return this.myName=t,this.myParent=u,this.myType="Component",this.withDependencies=!0,f=i&&i.uponCreation,f&&delete i.uponCreation,this.establishCollection("Properties",this.createParameters(i)),this.simpleProperty("myType"),this.simpleProperty("myName"),this.establishCollection("Subcomponents",this.createSubparts(r)),f&&(i.uponCreation=f,e=n.utils.isFunction(f)?f.call(this):f,n.utils.isaCollectionSpec(e)&&e.createSubcomponents(this)),this},e=[],i,r;o.prototype={toString:function(){return this.getID()+", |"+this.myName+"| type: "+this.myType},globalComputeStack:function(){return e},currentComputingProperty:function(){return e&&e.peek()},isType:function(n){return n===this.myType?!0:this.myType?n&&n.matches(this.myType):!1},isOfType:function(n){var i=this.isType(n),t;return i?!0:(t=this.myType.split("::"),t=t.length==2?t[1]:t[0],n&&n.matches(t))},createProperty:function(t,i){return new n.Property(this,t,i)},createParameters:function(n){var r=[],i,u,f;if(n!==t)for(i in n)n.hasOwnProperty(i)&&(u=n[i],f=this.createProperty.call(this,i,u),r.push(f));return r},createSubparts:function(i){var u=[],r;return n.utils.isArray(i)&&(r=this,u=i.map(function(i){var e=i.spec?i.spec:t,o=i.Subcomponents?i.Subcomponents:t,f=i.dependencies?i.dependencies:t,u=n.makeComponent(e,o,r);return i.myName&&(u.myName=i.myName),u.withDependencies=f?f:r.withDependencies,u})),u},establishCollection:function(t,i,r){var u=this[t];return n.utils.isaCollection(u)||(u=n.makeCollection(i,this,r),u.withDependencies=this.withDependencies,u.myName=t,this[t]=u),u},rootComponent:function(n){if(n&&this[n])return this[n];var i=this.myParent;return i===t?this:i.rootComponent(n)},getID:function(){return this.guid?this.guid:(this.guid=n.utils.createID(this.myName),this.guid)},setName:function(n){return this.myName=n,this},componentDepth:function(){return this.myParent?1+this.myParent.componentDepth():0},branchDepth:function(){var t=this.Subcomponents.first(),n;return t?(n=t.branchDepth(),this.Subcomponents.forEach(function(t){n=Math.max(t.branchDepth(),n)}),1+n):0},createSlots:function(n,i){var u=[],r;if(i!=t)for(r in i)this.getProperty(r)||(this[r]=i[r],u.push(r));return u},getProperty:function(n,t){var r="_"+n,i=this[r];return i?i:t&&this.myParent?this.myParent.getProperty(n,t):i},smashProperty:function(n,t){var i=this.getProperty(n,t);return i&&i.status&&i.smash(),i},smashPropertyTree:function(n){var i=this.smashProperties(n),t=this.myParent;return t?t.smashPropertyTree(n):i},smashPropertyBranch:function(n){this.smashProperties(n);this.Subcomponents.forEach(function(t){t.smashPropertyBranch(n)})},smashProperties:function(n,t){var i=this,r=fo.utils.isArray(n)?n:n.split(",");return r.forEach(function(n){i.smashProperty(n,t)}),i},deleteProperty:function(n){var i="_"+n,t=this[i];t&&(t.smash(),this.Properties.remove(t),delete this[i],delete this[n])},establishProperty:function(n,i,r){var u=this.getProperty(n);return u===t&&(u=this.createProperty(n,i),u.onValueSmash=r),u},simpleProperty:function(n,i){var r=this.getProperty(n),u;r!==t?(u=i?i:r.getValue(),this.deleteProperty(n),this[n]=u):i&&(this[n]=i)},asReference:function(){return this.myParent===t?"root":this.myName+"."+this.myParent.asReference()},superior:function(n){return n.matches(this.myName)?this:this.myParent?this.myParent.superior(n):void 0},findParentWhere:function(n){return n.call(this,this)?this:this.myParent?this.myParent.findParentWhere(n):void 0},getValueOf:function(n,i){var r=this.getProperty(n,!0),u=r?r.getValue():t;return u?u:i},resolveSuperior:function(t,i){var u=this,r;return n.utils.isSelf(t)?u:(r=this.getProperty(t),r)?r.getValue(i):(r=this[t],!r&&this.myParent)?this.myParent.resolveSuperior(t,i):r},resolveReference:function(i){var u=this,f,s,r,e,o;if(n.utils.isSelf(i))return u;if(f=i.split("@"),f.length==2&&f[1]!="")return this.resolveReference(f[1]);for(s=f[0].split("."),r=t,e=0;e<s.length;e++)o=s[e],r=u.getSubcomponent(o),r===t?(r=u.getProperty(o),r===t&&(u=u[o])):u=r;return r},resolvePropertyReference:function(i){var r={},h,e,s,f,u;if(i.begins("(")&&i.ends(")"))return h="return {0}; ".format(i),r.formula=new Function(h),r;if(i.begins("{")&&i.ends("}"))return r.JSON=JSON.parse(i),r;if(e=this,i.startsWith("@"))return u=this.resolveReference(i),n.utils.isaCollection(u)?r.collection=u:n.utils.isaComponent(u)?r.component=u:n.utils.isaProperty(u)?r.property=u:u&&(r.found=u),r;if(i.endsWith("@")){for(var c=i.substring(0,i.length-1),o=e.myParent,f=e.getProperty(c);f===t&&o;)f=o.getProperty(c),o=o.myParent;return r.property=f,r}return i.containsString("#")?(s=i.split("#"),r=this.resolvePropertyReference(s[0]),r.meta=s[1],r):i.startsWith("_")?(u=e[i],u&&(r.propertyPeek=u),r):(f=e.getProperty(i),u=t,f===t?u=e[i]:(r.property=f,f.status&&(u=f.value)),n.utils.isaCollection(u)?r.collection=u:n.utils.isaComponent(u)?r.component=u:u&&(r.slot=u),r)},resolveProperty:function(i){var e,f;if(i.ends("?"))return this.resolveProperty(i.substring(0,i.length-1));if(i.begins("?"))return this.resolveProperty(i.substring(1));if(i.begins("(")||i.begins("{")||!i.containsString("."))return this.resolvePropertyReference(i);var r=t,o=i.split("."),u=this;for(e=0;e<o.length;e++)f=o[e].trim(),r=u.resolvePropertyReference?u.resolvePropertyReference(f):t,r===t?u=u[f]:r.component?u=r.component:r.collection?u=r.collection:r.property&&r.property.status?u=r.property.getValue():n.utils.isaComponent(u)?(r.component=u.getSubcomponent(f),u=r.component?r.component:u[f]):u=u[f];return r},removeFromModel:function(){var n=this;return n.myParent&&n.myParent.removeSubcomponent(n),n.purgeBindings(!0),n},deleteAndPurge:function(){var n=this;n.removeFromModel()},purgeBindings:function(n){var t=!1;return this.Properties.forEach(function(i){t=i.purgeBindings(n)||t}),this.Subcomponents.forEach(function(i){t=i.purgeBindings(n)||t}),t},stringify:function(n){function r(n,i){switch(n){case"owner":case"myParent":case"source":case"target":return i?i.asReference():i;case"thisValueDependsOn":case"thisInformsTheseValues":case"uiBindings":case"onRefreshUi":return t}return i}var i=n||this;return JSON.stringify(i,r,3)},rehydrate:function(n,t,i,r){var u=this,f={};return t.forEach(function(t){var s=t.uniqueID?t.uniqueID:t.myName,c,h,e,o;if(t.myType=r?r(t):t.myType,c=t.parentHydrateId,delete t.parentHydrateId,h=t.Subcomponents,h&&delete t.Subcomponents,e=u,o=e.getSubcomponent(s),!o&&c&&(e=n.getSubcomponent(c,!0),e?o=e.getSubcomponent(s):e=u),o||(o=fo.make(t,e),e.getSubcomponent(s)&&alert("rehydrateing: We have a problem"),e.addSubcomponent(o,s)),i[s]=f[s]=o,h)try{o.rehydrate(n,h,i,r)}catch(l){fo.trace&&fo.trace.exception("rehydrate",l)}}),f},dehydrate:function(i,r){var u=this,f=u.myType?{myType:u.myType}:{},e,o;return u.myName&&(f.myName=u.myName),u.myParent&&u.myParent.myName&&(f.parentHydrateId=u.myParent.myName),e=r?Object.keys(r):[],u.Properties.forEach(function(i){var o=i.myName,h=e.contains(o),s,u;(!h||r[o])&&((s="given".matches(i.status)?!1:i.formula!==t,s)||(u=i.value,n.utils.isaComponent(u)||n.utils.isaCollection(u))||(f[o]=u))}),i&&u.Subcomponents.count>0&&(o=u.Subcomponents.map(function(n){return n.dehydrate(i,r)}),f.Subcomponents=o),f},makePartOfSpec:function(n,t){var i="_"+n;this[i]&&(this[i].canExport=t?t:!0)},exportValues:function(){var t={},n,i;for(n in this)n.startsWith("_")||(i=this[n],fo.utils.isObject(i)||(t[n]=this[n]));return t},getSpec:function(i){var r=this.myType?{myType:this.myType}:{};return this.myName&&(r.myName=this.myName),this.Properties.forEach(function(u){var o="given".matches(u.status)?!1:u.formula!==t,f,e;(!o||u.canExport)&&(r=r||{},f=u.value,(n.utils.isaComponent(f)||n.utils.isaCollection(f))&&(f=f.getSpec(i)),e=u.myName,f!==t?r[e]=f:u.canExport&&(r[e]=u.getValue()))}),i&&this.Members&&this.Members.forEach(function(t){if(t.count!=0){r=r||{};var u=t;(n.utils.isaComponent(u)||n.utils.isaCollection(u))&&(u=u.getSpec(i));u&&(r[t.myName]=u)}}),r},doCommand:function(t,i){if(n.utils.isFunction(t))return n.runWithUIRefreshLock(t);var r=this.getProperty(t,!0),u=i?i:this;return r&&r.doCommand(u)},redefine:function(n,t){var i="_"+n;this[i]?this[i].redefine(t):(property=this.createProperty.call(this,n,t),this.Properties.push(property))},createView:function(n){return this.Properties.map(function(t){return t.createView(n)})},extendUi:function(n){var i=this;for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return this},extendWith:function(n){for(var t in n)n.hasOwnProperty(t)&&this.redefine(t,n[t]);return this},extendProperties:function(t){var u=[],i,r,f;for(i in t)t.hasOwnProperty(i)&&(r=this.getProperty(i),r&&(f=n.utils.asArray(t[i]),f.forEach(function(n){r.extendWith(n)}),u.push(r)));return u},subscribeToCommands:function(){var n=this,t=Object.keys(n);t.forEach(function(t){(t.startsWith("do")||t.startsWith("goto"))&&fo.subscribe(t,function(){n[t]})})},definePropertyViews:function(t){var i,r,u;for(i in t)t.hasOwnProperty(i)&&(r=this.getProperty(i),r&&(u=n.utils.asArray(t[i]),u.forEach(function(n){for(var t in n)n.hasOwnProperty(t)&&r.extendUi(n[t],t)})));return[]},establishManagedProperty:function(n,t){var i=this.getProperty(n);return i?(i.redefine(t),i):this.replaceManagedProperty(n,t)},replaceManagedProperty:function(n,t){this.deleteProperty(n);var i=this.createProperty(n,t);return this.Properties&&this.Properties.push(i),i},establishManagedProperties:function(n){var t=this.createParameters(n);return this.establishCollection("Properties",t)},doSubcomponentRefresh:function(n){var t=this.Subcomponents.getProperty("count");t.updateBindings();n&&this.Subcomponents.forEach(function(n){n.doSubcomponentRefresh()})},onPropertyRefresh:function(n,t){var i=this.getProperty(n);return i&&(i.onRefreshUi=t),i},onPropertySmash:function(n,t){var i=this.getProperty(n);i&&(i.onValueSmash=t)},onPropertyValueSet:function(n,t){var i=this.getProperty(n);i&&(i.onValueSet=t)},addOnRefresh:function(t,i){var r=this.onPropertyRefresh(t,i);return r&&n.markForRefresh(r),r},addPropertyConstraint:function(n){function i(n,i,r){var f,u;if(n){f=this;for(u in t)f.myName.matches(u)||(r[u]=!1)}}var t=n;for(var r in t)this.onPropertyValueSet(r,i)},addBinding:function(n,t){var i=this.getProperty(n),r=i.uiBindings?i.uiBindings.length:0;return i?i.addBinding(t,!0):i},applyToSelfAndParents:function(n){var i=n.call(this,this),t=this.myParent;return t&&t.applyToSelfAndParents(n),i},applyToSelfAndChildren:function(n,t){var i=n.call(this,this);return this.applyToChildren(n,t),i},applyToChildren:function(n,t){this.Subcomponents.forEach(function(i){n.call(i,i);t&&i.applyToChildren(n,t)})},applyToSiblings:function(n,t){var i=this,r=this.myParent;return r.Subcomponents.forEach(function(r){i!=r&&(n.call(r,r),t&&r.applyToChildren(n,t))}),result},applyToSelfAndSiblings:function(n,t){var i=this.myParent;i.Subcomponents.forEach(function(i){n.call(i,i);t&&i.applyToChildren(n,t)})},capture:function(n,t,i){return this.captureSubcomponent(n,t,i)},canCaptureSubcomponent:function(t){return n.utils.isaComponent(t)?!0:!1},captureSubcomponent:function(t,i,r){var f=this,u=t.myParent;if(f.canCaptureSubcomponent(t))return n.runWithUIRefreshLock(function(){i&&(t.myName=i,r&&(f[i]=t));u&&(u.removeSubcomponent(t),r&&delete u[i]);f.addSubcomponent(t)}),u},pushSubcomponent:function(n,t){return n.myParent=this,t&&(n.myName=t),this.Subcomponents.push(n),n},addSubcomponent:function(t,i,r){if(n.utils.isaComponent(t))return t.myParent=this,i&&(t.myName=i),r?this.Subcomponents.prependNoDupe(t):this.Subcomponents.addNoDupe(t),t},insertSubcomponent:function(t,i,r){if(n.utils.isaComponent(i))return i.myParent=this,r&&(i.myName=r),this.Subcomponents.insertNoDupe(t,i),i},captureInsertSubcomponent:function(t,i,r){var f=this,u=i.myParent;if(f.canCaptureSubcomponent(i))return n.runWithUIRefreshLock(function(){r&&(i.myName=r);u&&u.removeSubcomponent(i);f.insertSubcomponent(t,i)}),u},removeSubcomponent:function(i){if(n.utils.isaComponent(i))return i.myParent===this&&(i.myParent=t),this.Subcomponents.remove(i),i},removeAllSubcomponents:function(){if(this.Subcomponents.count!=0){var n=this.Subcomponents.elements.duplicate();return n.forEach(function(n){n.myParent===this&&(n.myParent=t)}),this.Subcomponents.clear(),n}},createSubcomponent:function(i,r){var u=n.makeComponent(i,t,this);return u.withDependencies=r?r:this.withDependencies,this.addSubcomponent(u),u},getSubcomponent:function(n,t){var u=this.Subcomponents.findByName(n),i,f,r;if(u||!t||!n)return u;if(n.matches(this.myName))return this;for(i=0;i<this.Subcomponents.count;i++)if(f=this.Subcomponents.item(i),r=f.getSubcomponent(n,t),r)return r},establishSubcomponent:function(i,r){var f=this.getSubcomponent(i),u;return f||(u=n.makeComponent(r,t,this),u.myName||(u.myName=i),u.withDependencies=this.withDependencies,f=this.Subcomponents.addNoDupe(u)),f},forEachSubcomponent:function(n,t){this.Subcomponents.forEach(function(i){(n.call(i,i),t)||i.forEachSubcomponent(n,t)})},selectComponents:function(i,r){var f=r===t?n.makeCollection([],this):r,u,e;if(this.Subcomponents.count>0)for(this.Subcomponents.copyWhere(i,f),u=0;u<this.Subcomponents.count;u++)e=this.Subcomponents.item(u),e.selectComponents(i,f);return f},membersWhere:function(n,t){return this.Subcomponents.membersWhere(n,t)},appendTo:function(i,r){var u=this.establishCollection(i),f=this,e=n.utils.asArray(r).map(function(i){var r=i;return n.utils.isaComponent(r)?r.myParent=r.myParent?r.myParent:f:r=n.makeComponent(i,t,f),r});return u.addList(e),u},makeMembers:function(i,r){var u=this.establishCollection(i),f,e;return this.establishCollection("Members").addNoDupe(u),f=this,e=n.utils.asArray(r).map(function(i){var r=i,o,u,e;if(!n.utils.isaComponent(r)){o=n.utils.extractSlots(i,function(t){return!n.utils.isArray(t)});r=n.makeComponent(o,t,f);u=n.utils.extractSlots(i,function(t){return n.utils.isArray(t)});for(e in u)r.makeMembers(e,u[e])}return r.myParent=r.myParent?r.myParent:f,r}),u.addList(e),u},myIndex:function(){if(this.mySiblingTotal()<0)return-1;return this.myParent.Subcomponents.indexOf(this)},mySiblingTotal:function(){if(!this.myParent)return-1;return this.myParent.Subcomponents.count},mySiblingPrevious:function(){var n=this.myIndex();return n<0?t:(n-=1,this.myParent.Subcomponents.itemByIndex(n))},mySiblingNext:function(){var n=this.myIndex();return n<0?t:(n+=1,n>this.mySiblingTotal)?t:this.myParent.Subcomponents.itemByIndex(n)},mySiblingsBefore:function(){var t=this.myIndex(),r=n.makeCollection([],this.myParent),u,i;if(t<0)return r;if(u=this.myParent.Subcomponents.elements,t>=0&&t<u.length)for(i=0;i<t;i++)r.push(u[i]);return r},mySiblingsAfter:function(){var t=this.myIndex(),u=n.makeCollection([],this.myParent),i,r;if(t<0)return u;if(i=this.myParent.Subcomponents.elements,t>=0&&t<i.length)for(r=t+1;r<i.length;r++)u.push(i[r]);return u},mySiblings:function(){var u=this.myIndex(),i=n.makeCollection([],this.myParent),r,t;if(u<0)return i;for(r=this.myParent.Subcomponents.elements,t=0;t<r.length;t++)t!=u&&i.push(r[t]);return i},mySiblingsMaxValue:function(n,t,i){var f=this.myIndex(),r,u;return f<0?t:(r=this.myParent.Subcomponents.filter(i),u=r.maxAll(n,t),u)}};n.isDialogOpen=!1;n.Component=o;n.fromParent=function(n){var i=this.myParent,r;if(!i)throw new Error("the property "+n+" does not have a parent");if(i&&i.resolveSuperior?r=i.resolveSuperior(n):i&&(r=i[n]),r===t)throw new Error("the property "+n+" does not exist on the parent");return r};n.makeComponent=function(t,i,r){return new n.Component(t,i,r)};n.makeModel=function(t,i){var r=n.makeComponent(t.spec,t.Subcomponents,i);return r.myName=t.myName,r};n.makeCollection=function(t,i,r){return new n.Collection(t,i,r)};n.makeOrderedCollection=function(t,i,r){return new n.OrderedCollection(t,i,r)};n.makeCollectionSpec=function(t,i,r){return new n.CollectionSpec(t,i,r)};n.doCommand=function(t,i,r){if(i)return n.runWithUIRefreshLock(function(){i.doCommand(t);r&&r()}),!0};n.stringifyPayload=function(n){return JSON.stringify(n)};n.parsePayload=function(n){return JSON.parse(n)};i={};n.publishNoLock=function(r,u){if(i[r]===t)return!1;var f=!0;return i[r].forEach(function(t){try{t.apply(r,u||[])}catch(i){n.trace&&n.trace.log(i);f=!1}}),f};n.publish=function(t,i){n.runWithUIRefreshLock(function(){n.publishNoLock(u(t),i);n.publishNoLock(t,i);n.publishNoLock(f(t),i)})};n.subscribe=function(n,t){return i[n]||(i[n]=[]),i[n].push(t),[n,t]};n.subscribeBegin=function(t,i){n.subscribe(u(t),i)};n.subscribeComplete=function(t,i){n.subscribe(f(t),i)};n.unsubscribe=function(n){var t=n[0];i[t]&&i[t].forEach(function(r){this==n[1]&&i[t].splice(r,1)})};n.unsubscribeBegin=function(t,i){n.unsubscribe(u(t),i)};n.unsubscribeComplete=function(t,i){n.unsubscribe(f(t),i)};n.flushPubSubCache=function(n){delete i[u(n)];delete i[n];delete i[f(n)]};n.uiRefreshLock=0;n.globalUIRefreshLock=function(t){return n.uiRefreshLock=n.uiRefreshLock+t,n.uiRefreshLock==0,n.uiRefreshLock};r=[];n.markForRefresh=function(t){n.uiRefreshLock>0?r.addNoDupe(t):t.refreshUi()};n.globalUIReleaseAndRefresh=function(i){var f=n.globalUIRefreshLock(0),u,e;f==0&&r.length>0&&(u=r,r=[],e=this,n.globalUIRefreshLock(1),u.forEach(function(n){n.refreshUi()}),u=t,n.globalUIRefreshLock(-1));r.length==0&&i&&i()};n.runWithUIRefreshLock=function(t,i){var f=n.globalUIRefreshLock(1),r=t(),u=n.globalUIRefreshLock(-1);return u==0&&n.globalUIReleaseAndRefresh(i),r};n.UIRefreshLock=function(t,i){return function(){return n.runWithUIRefreshLock(function(){t[i]}),t[i]}};n.writeBlobFile=function(n,t,i){var r=t+i;saveAs(n,r)};n.writeTextFileAsync=function(n,t,i,r){if(s(n,t,i),r){r(n,t,i);return}fo.publish("textFileSaved",[n,t,i])};fo.readTextFileAsync=function(n,t,i){var r=new FileReader;r.onload=function(r){var e=n.name,u=e.replace(t,""),f=r.target.result;if(i){i(f,u,t);return}fo.publish("textFileDropped",[f,u,t])};r.readAsText(n)};fo.readImageFileAsync=function(n,t,i){var r=new FileReader;r.onload=function(r){var e=n.name,u=e.replace(t,""),f=r.target.result;if(i){i(f,u,t);return}fo.publish("imageFileDropped",[f,u,t])};r.readAsDataURL(n)};n.enableFileDragAndDrop=function(t){function r(n){n.stopPropagation();n.preventDefault()}function u(n){var s;n.stopPropagation();n.preventDefault();var r=n.dataTransfer,f=r.getData("Text"),u=r.getData("URL"),e=r.files,o=e.length,t=o>0&&e[0],i=t?t.name.match(/\.[0-9a-z]+$/i):[""];i=i[0];s=t&&t.name.replace(i,"");t&&t.type.startsWith("image")?fo.readImageFileAsync(t,i):t&&(i.matches(".knt")||i.matches(".csv")||i.matches(".json")||i.matches(".txt"))?fo.readTextFileAsync(t,i):u&&u.startsWith("http")?fo.publish("urlDropped",[u]):f&&fo.publish("textDropped",[f])}var i=n.utils.isString(t)?document.getElementById(t):t;return i.addEventListener("dragenter",r,!1),i.addEventListener("dragexit",r,!1),i.addEventListener("dragover",r,!1),i.addEventListener("drop",u,!1),i}}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n){var t=function(t,i){this.base=n.Collection;var r=n.utils.isaCollection(t)?t.elements:t;return this.base(r,i),this};t.prototype=function(){var i=function(){this.constructor=t};return i.prototype=n.Collection.prototype,new i}();n.Relationship=t;n.makeRelationship=function(t,i,r){return new n.Relationship(t,i,r)};n.Component.prototype.establishRelationship=function(t,i,r){var u=this[t];return n.utils.isaRelationship(u)||(u=n.makeRelationship(i,this,r),u.withDependencies=this.withDependencies,u.myName=t,this[t]=u),u};n.makeRelation=function(n,t){if(n&&t){var r=this,i=n.establishRelationship(r.myName);return i.addNoDupe(t),i}};n.unmakeRelation=function(n,t){var i,r;if(n&&t)return(i=this,!n[i.myName])?void 0:(r=n.establishRelationship(i.myName),r.remove(t),r.isEmpty()&&delete n[i.myName],r)}}(Foundry);
/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
(function(n){if(typeof bootstrap=="function")bootstrap("promise",n);else if(typeof exports=="object")module.exports=n();else if(typeof define=="function"&&define.amd)define(n);else if(typeof ses!="undefined")if(ses.ok())ses.makeQ=n;else return;else Q=n()})(function(){"use strict";function h(n){return function(){return kt.apply(n,arguments)}}function ut(n){return n===Object(n)}function ii(n){return ti(n)==="[object StopIteration]"||n instanceof b}function ft(n,t){var r,i,u;if(a&&t.stack&&typeof n=="object"&&n!==null&&n.stack&&n.stack.indexOf(d)===-1){for(r=[],i=t;!!i;i=i.source)i.stack&&r.unshift(i.stack);r.unshift(n.stack);u=r.join("\n"+d+"\n");n.stack=ri(u)}}function ri(n){for(var t,r=n.split("\n"),u=[],i=0;i<r.length;++i)t=r[i],fi(t)||ui(t)||!t||u.push(t);return u.join("\n")}function ui(n){return n.indexOf("(module.js:")!==-1||n.indexOf("(node.js:")!==-1}function et(n){var r=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(n),t,i;return r?[r[1],Number(r[2])]:(t=/at ([^ ]+):(\d+):(?:\d+)$/.exec(n),t)?[t[1],Number(t[2])]:(i=/.*@(.+):(\d+)$/.exec(n),i?[i[1],Number(i[2])]:void 0)}function fi(n){var t=et(n),r,i;return t?(r=t[0],i=t[1],r===it&&i>=bt&&i<=pt):!1}function ot(){if(a)try{throw new Error;}catch(i){var n=i.stack.split("\n"),r=n[0].indexOf("@")>0?n[1]:n[2],t=et(r);return t?(it=t[0],t[1]):void 0}}function ei(n,t,i){return function(){return typeof console!="undefined"&&typeof console.warn=="function"&&console.warn(t+" is deprecated, use "+i+" instead.",new Error("").stack),n.apply(n,arguments)}}function n(n){return o(n)?n:ct(n)?yi(n):tt(n)}function r(){function y(n){e=n;s.source=n;v(c,function(t,i){u(function(){n.promiseDispatch.apply(n,i)})},void 0);c=void 0;l=void 0}var c=[],l=[],e,h=w(r.prototype),s=w(t.prototype);if(s.promiseDispatch=function(n,t,r){var f=i(arguments);c?(c.push(f),t==="when"&&r[1]&&l.push(r[1])):u(function(){e.promiseDispatch.apply(e,f)})},s.valueOf=function(){if(c)return s;var n=ht(e);return o(n)&&(e=n),n},s.inspect=function(){return e?e.inspect():{state:"pending"}},n.longStackSupport&&a)try{throw new Error;}catch(p){s.stack=p.stack.substring(p.stack.indexOf("\n")+1)}return h.promise=s,h.resolve=function(t){e||y(n(t))},h.fulfill=function(n){e||y(tt(n))},h.reject=function(n){e||y(f(n))},h.notify=function(n){e||v(l,function(t,i){u(function(){i(n)})},void 0)},h}function st(n){if(typeof n!="function")throw new TypeError("resolver must be a function.");var t=r();try{n(t.resolve,t.reject,t.notify)}catch(i){t.reject(i)}return t.promise}function oi(t){return st(function(i,r){for(var u=0,f=t.length;u<f;u++)n(t[u]).then(i,r)})}function t(n,i,r){var u,e;return i===void 0&&(i=function(n){return f(new Error("Promise does not support operation: "+n))}),r===void 0&&(r=function(){return{state:"unknown"}}),u=w(t.prototype),u.promiseDispatch=function(t,r,e){var o;try{o=n[r]?n[r].apply(u,e):i.call(u,r,e)}catch(s){o=f(s)}t&&t(o)},u.inspect=r,r&&(e=r(),e.state==="rejected"&&(u.exception=e.reason),u.valueOf=function(){var n=r();return n.state==="pending"||n.state==="rejected"?u:n.value}),u}function e(t,i,r,u){return n(t).then(i,r,u)}function ht(n){if(o(n)){var t=n.inspect();if(t.state==="fulfilled")return t.value}return n}function o(n){return ut(n)&&typeof n.promiseDispatch=="function"&&typeof n.inspect=="function"}function ct(n){return ut(n)&&typeof n.then=="function"}function si(n){return o(n)&&n.inspect().state==="pending"}function hi(n){return!o(n)||n.inspect().state==="fulfilled"}function ci(n){return o(n)&&n.inspect().state==="rejected"}function li(){!g&&typeof window!="undefined"&&window.console&&console.warn("[Q] Unhandled rejection reasons (should be empty):",s);g=!0}function lt(){for(var t,n=0;n<s.length;n++)t=s[n],console.warn("Unhandled rejection reason:",t)}function nt(){if(s.length=0,y.length=0,g=!1,!c&&(c=!0,typeof process!="undefined"&&process.on))process.on("exit",lt)}function ai(n,t){c&&(y.push(n),t&&typeof t.stack!="undefined"?s.push(t.stack):s.push("(no stack) "+t),li())}function vi(n){if(c){var t=dt(y,n);t!==-1&&(y.splice(t,1),s.splice(t,1))}}function f(n){var i=t({when:function(t){return t&&vi(this),t?t(n):this}},function(){return this},function(){return{state:"rejected",reason:n}});return ai(i,n),i}function tt(n){return t({when:function(){return n},get:function(t){return n[t]},set:function(t,i){n[t]=i},"delete":function(t){delete n[t]},post:function(t,i){return t===null||t===void 0?n.apply(void 0,i):n[t].apply(n,i)},apply:function(t,i){return n.apply(t,i)},keys:function(){return ni(n)}},void 0,function(){return{state:"fulfilled",value:n}})}function yi(n){var t=r();return u(function(){try{n.then(t.resolve,t.reject,t.notify)}catch(i){t.reject(i)}}),t.promise}function pi(i){return t({isDef:function(){}},function(n,t){return vt(i,n,t)},function(){return n(i).inspect()})}function at(t,i,r){return n(t).spread(i,r)}function wi(n){return function(){function t(n,t){var o;if(k){try{o=r[n](t)}catch(s){return f(s)}return o.done?o.value:e(o.value,i,u)}try{o=r[n](t)}catch(s){return ii(s)?s.value:f(s)}return e(o,i,u)}var r=n.apply(this,arguments),i=t.bind(t,"next"),u=t.bind(t,"throw");return i()}}function bi(t){n.done(n.async(t)())}function ki(n){throw new b(n);}function di(n){return function(){return at([this,l(arguments)],function(t,i){return n.apply(t,i)})}}function vt(t,i,r){return n(t).dispatch(i,r)}function l(n){return e(n,function(n){var i=0,t=r();return v(n,function(r,u,f){var s;o(u)&&(s=u.inspect()).state==="fulfilled"?n[f]=s.value:(++i,e(u,function(r){n[f]=r;--i==0&&t.resolve(n)},t.reject,function(n){t.notify({index:f,value:n})}))},void 0),i===0&&t.resolve(n),t.promise})}function yt(t){return e(t,function(t){return t=p(t,n),e(l(p(t,function(n){return e(n,rt,rt)})),function(){return t})})}function gi(t){return n(t).allSettled()}function nr(t,i){return n(t).then(void 0,void 0,i)}function tr(t,i){return n(t).nodeify(i)}var a=!1,b,k,d,pt;try{throw new Error;}catch(wt){a=!!wt.stack}var bt=ot(),it,rt=function(){},u=function(){function t(){for(var r,i;n.next;){n=n.next;r=n.task;n.task=void 0;i=n.domain;i&&(n.domain=void 0,i.enter());try{r()}catch(u){if(e){i&&i.exit();setTimeout(t,0);i&&i.enter();throw u;}else setTimeout(function(){throw u;},0)}i&&i.exit()}f=!1}var n={task:void 0,next:null},s=n,f=!1,i=void 0,e=!1,r,o;return u=function(n){s=s.next={task:n,domain:e&&process.domain,next:null};f||(f=!0,i())},typeof process!="undefined"&&process.nextTick?(e=!0,i=function(){process.nextTick(t)}):typeof setImmediate=="function"?i=typeof window!="undefined"?setImmediate.bind(window,t):function(){setImmediate(t)}:typeof MessageChannel!="undefined"?(r=new MessageChannel,r.port1.onmessage=function(){i=o;r.port1.onmessage=t;t()},o=function(){r.port2.postMessage(0)},i=function(){setTimeout(t,0);o()}):i=function(){setTimeout(t,0)},u}(),kt=Function.call;var i=h(Array.prototype.slice),v=h(Array.prototype.reduce||function(n,t){var i=0,r=this.length;if(arguments.length===1)do{if(i in this){t=this[i++];break}if(++i>=r)throw new TypeError;}while(1);for(;i<r;i++)i in this&&(t=n(t,this[i],i));return t}),dt=h(Array.prototype.indexOf||function(n){for(var t=0;t<this.length;t++)if(this[t]===n)return t;return-1}),p=h(Array.prototype.map||function(n,t){var i=this,r=[];return v(i,function(u,f,e){r.push(n.call(t,f,e,i))},void 0),r}),w=Object.create||function(n){function t(){}return t.prototype=n,new t},gt=h(Object.prototype.hasOwnProperty),ni=Object.keys||function(n){var t=[];for(var i in n)gt(n,i)&&t.push(i);return t},ti=h(Object.prototype.toString);b=typeof ReturnValue!="undefined"?ReturnValue:function(n){this.value=n};try{new Function("(function* (){ yield 1; })");k=!0}catch(wt){k=!1}d="From previous event:";n.resolve=n;n.nextTick=u;n.longStackSupport=!1;n.defer=r;r.prototype.makeNodeResolver=function(){var n=this;return function(t,r){t?n.reject(t):arguments.length>2?n.resolve(i(arguments,1)):n.resolve(r)}};n.promise=st;n.passByCopy=function(n){return n};t.prototype.passByCopy=function(){return this};n.join=function(t,i){return n(t).join(i)};t.prototype.join=function(t){return n([this,t]).spread(function(n,t){if(n===t)return n;throw new Error("Can't join: not the same: "+n+" "+t);})};n.race=oi;t.prototype.race=function(){return this.then(n.race)};n.makePromise=t;t.prototype.toString=function(){return"[object Promise]"};t.prototype.then=function(t,i,e){function c(n){try{return typeof t=="function"?t(n):n}catch(i){return f(i)}}function l(n){if(typeof i=="function"){ft(n,h);try{return i(n)}catch(t){return f(t)}}return f(n)}function a(n){return typeof e=="function"?e(n):n}var h=this,o=r(),s=!1;return u(function(){h.promiseDispatch(function(n){s||(s=!0,o.resolve(c(n)))},"when",[function(n){s||(s=!0,o.resolve(l(n)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(t){var i,r=!1;try{i=a(t)}catch(u){if(r=!0,n.onerror)n.onerror(u);else throw u;}r||o.notify(i)}]),o.promise};n.when=e;t.prototype.thenResolve=function(n){return this.then(function(){return n})};n.thenResolve=function(t,i){return n(t).thenResolve(i)};t.prototype.thenReject=function(n){return this.then(function(){throw n;})};n.thenReject=function(t,i){return n(t).thenReject(i)};n.nearer=ht;n.isPromise=o;n.isPromiseAlike=ct;n.isPending=si;t.prototype.isPending=function(){return this.inspect().state==="pending"};n.isFulfilled=hi;t.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled"};n.isRejected=ci;t.prototype.isRejected=function(){return this.inspect().state==="rejected"};var s=[],y=[],g=!1,c=!0;return n.resetUnhandledRejections=nt,n.getUnhandledReasons=function(){return s.slice()},n.stopUnhandledRejectionTracking=function(){nt();typeof process!="undefined"&&process.on&&process.removeListener("exit",lt);c=!1},nt(),n.reject=f,n.fulfill=tt,n.master=pi,n.spread=at,t.prototype.spread=function(n,t){return this.all().then(function(t){return n.apply(void 0,t)},t)},n.async=wi,n.spawn=bi,n["return"]=ki,n.promised=di,n.dispatch=vt,t.prototype.dispatch=function(n,t){var f=this,i=r();return u(function(){f.promiseDispatch(i.resolve,n,t)}),i.promise},n.get=function(t,i){return n(t).dispatch("get",[i])},t.prototype.get=function(n){return this.dispatch("get",[n])},n.set=function(t,i,r){return n(t).dispatch("set",[i,r])},t.prototype.set=function(n,t){return this.dispatch("set",[n,t])},n.del=n["delete"]=function(t,i){return n(t).dispatch("delete",[i])},t.prototype.del=t.prototype["delete"]=function(n){return this.dispatch("delete",[n])},n.mapply=n.post=function(t,i,r){return n(t).dispatch("post",[i,r])},t.prototype.mapply=t.prototype.post=function(n,t){return this.dispatch("post",[n,t])},n.send=n.mcall=n.invoke=function(t,r){return n(t).dispatch("post",[r,i(arguments,2)])},t.prototype.send=t.prototype.mcall=t.prototype.invoke=function(n){return this.dispatch("post",[n,i(arguments,1)])},n.fapply=function(t,i){return n(t).dispatch("apply",[void 0,i])},t.prototype.fapply=function(n){return this.dispatch("apply",[void 0,n])},n["try"]=n.fcall=function(t){return n(t).dispatch("apply",[void 0,i(arguments,1)])},t.prototype.fcall=function(){return this.dispatch("apply",[void 0,i(arguments)])},n.fbind=function(t){var r=n(t),u=i(arguments,1);return function(){return r.dispatch("apply",[this,u.concat(i(arguments))])}},t.prototype.fbind=function(){var n=this,t=i(arguments);return function(){return n.dispatch("apply",[this,t.concat(i(arguments))])}},n.keys=function(t){return n(t).dispatch("keys",[])},t.prototype.keys=function(){return this.dispatch("keys",[])},n.all=l,t.prototype.all=function(){return l(this)},n.allResolved=ei(yt,"allResolved","allSettled"),t.prototype.allResolved=function(){return yt(this)},n.allSettled=gi,t.prototype.allSettled=function(){return this.then(function(t){return l(p(t,function(t){function i(){return t.inspect()}return t=n(t),t.then(i,i)}))})},n.fail=n["catch"]=function(t,i){return n(t).then(void 0,i)},t.prototype.fail=t.prototype["catch"]=function(n){return this.then(void 0,n)},n.progress=nr,t.prototype.progress=function(n){return this.then(void 0,void 0,n)},n.fin=n["finally"]=function(t,i){return n(t)["finally"](i)},t.prototype.fin=t.prototype["finally"]=function(t){return t=n(t),this.then(function(n){return t.fcall().then(function(){return n})},function(n){return t.fcall().then(function(){throw n;})})},n.done=function(t,i,r,u){return n(t).done(i,r,u)},t.prototype.done=function(t,i,r){var f=function(t){u(function(){if(ft(t,e),n.onerror)n.onerror(t);else throw t;})},e=t||i||r?this.then(t,i,r):this;typeof process=="object"&&process&&process.domain&&(f=process.domain.bind(f));e.then(void 0,f)},n.timeout=function(t,i,r){return n(t).timeout(i,r)},t.prototype.timeout=function(n,t){var i=r(),u=setTimeout(function(){i.reject(new Error(t||"Timed out after "+n+" ms"))},n);return this.then(function(n){clearTimeout(u);i.resolve(n)},function(n){clearTimeout(u);i.reject(n)},i.notify),i.promise},n.delay=function(t,i){return i===void 0&&(i=t,t=void 0),n(t).delay(i)},t.prototype.delay=function(n){return this.then(function(t){var i=r();return setTimeout(function(){i.resolve(t)},n),i.promise})},n.nfapply=function(t,i){return n(t).nfapply(i)},t.prototype.nfapply=function(n){var t=r(),u=i(n);return u.push(t.makeNodeResolver()),this.fapply(u).fail(t.reject),t.promise},n.nfcall=function(t){var r=i(arguments,1);return n(t).nfapply(r)},t.prototype.nfcall=function(){var t=i(arguments),n=r();return t.push(n.makeNodeResolver()),this.fapply(t).fail(n.reject),n.promise},n.nfbind=n.denodeify=function(t){var u=i(arguments,1);return function(){var e=u.concat(i(arguments)),f=r();return e.push(f.makeNodeResolver()),n(t).fapply(e).fail(f.reject),f.promise}},t.prototype.nfbind=t.prototype.denodeify=function(){var t=i(arguments);return t.unshift(this),n.denodeify.apply(void 0,t)},n.nbind=function(t,u){var f=i(arguments,2);return function(){function s(){return t.apply(u,arguments)}var o=f.concat(i(arguments)),e=r();return o.push(e.makeNodeResolver()),n(s).fapply(o).fail(e.reject),e.promise}},t.prototype.nbind=function(){var t=i(arguments,0);return t.unshift(this),n.nbind.apply(void 0,t)},n.nmapply=n.npost=function(t,i,r){return n(t).npost(i,r)},t.prototype.nmapply=t.prototype.npost=function(n,t){var f=i(t||[]),u=r();return f.push(u.makeNodeResolver()),this.dispatch("post",[n,f]).fail(u.reject),u.promise},n.nsend=n.nmcall=n.ninvoke=function(t,u){var e=i(arguments,2),f=r();return e.push(f.makeNodeResolver()),n(t).dispatch("post",[u,e]).fail(f.reject),f.promise},t.prototype.nsend=t.prototype.nmcall=t.prototype.ninvoke=function(n){var u=i(arguments,1),t=r();return u.push(t.makeNodeResolver()),this.dispatch("post",[n,u]).fail(t.reject),t.promise},n.nodeify=tr,t.prototype.nodeify=function(n){if(n)this.then(function(t){u(function(){n(null,t)})},function(t){u(function(){n(t)})});else return this},pt=ot(),n});Foundry=Foundry||{};fo=Foundry,function(n,t,i){var r=function(t,r,u,f){var e=t.globalComputeStack();return this.promisedToProperty=e?e.peek():this,this.value=i,this.owner=t,this.myName=r,this.onSuccess=u,this.onFailure=f?f:function(){return n.trace.alert("missing OnFailure")},this.futures=[],this.futureError=function(){return n.trace.alert("Promise was broken")},this};r.prototype={isWaiting:function(){return n.utils.isaProperty(this.promisedToProperty)?!0:n.utils.isArray(this.futures)&&this.futures.length>0},whileWaiting:function(t){return this.isWaiting()&&this.value===i&&n.utils.isFunction(t)&&t(),this},continueWith:function(t){var r=this.value;if(this.isWaiting()||r===i)n.utils.isFunction(t)&&this.futures.push(t);else return this.runFutures(r),n.utils.isFunction(t)&&t(r),this;return this},errorWith:function(n){return this.futureError=n,this},runFutures:function(t){if(n.utils.isArray(this.futures)){for(var r=0,u=this.futures.length>>>0;r<u;r++)this.futures[r](t);this.futures=i;this.futureError=i}},fulfillPromised:function(t){n.utils.isaProperty(this.promisedToProperty)&&(this.value=t,this.promisedToProperty.setValue(t),this.promisedToProperty=i,this.runFutures(t))},breakPromised:function(t){if(this.promisedToProperty=i,this.futures=i,n.utils.isFunction(this.onError))this.onError(t);n.utils.isFunction(this.futureError)&&this.futureError(t)},onComplete:function(t){var i=this;n.runWithUIRefreshLock(function(){i.onSuccess(t)})},onError:function(){var t=this,i=this.arguments;n.runWithUIRefreshLock(function(){t.onFailure(i)})}};n.Component.prototype.createAsyncToken=function(n,t,i){return new r(this,n,t,i)};n.Promise=r}(Foundry,Q);Foundry=Foundry||{};Foundry.factory=Foundry.factory||{};fa=Foundry.factory,function(n,t,i){function o(t,i){var f={myName:t,type:r[t],constructor:u[t]};try{i&&(f.instance=n.newInstance(t),f.computedSpec=n.computedSpec(f.instance),f.spec=f.instance.getSpec())}catch(e){f.ex=e}return f}function s(t){var i=t;return function(t,u,f){var e=r[i];return n.makeInstance(e,t,u,f)}}function l(t){var i=t;return function(t,u,f){var e=r[i],o=n.extractSpec(i,t);return n.makeInstance(e,o,u,f)}}var u,h,r,e,f;n.getNamespaceKey=function(n,t){if(n&&t){if(t.contains("::"))return t;return n+"::"+t}if(n.contains("::"))return n;throw new Error("getNamespaceKey invalid arguments");};n.isValidNamespaceKey=function(n){if(!n)throw new Error("valid NamespaceKey is missing");return!0};u=u||{};h=function(t,i){if(n.isValidNamespaceKey(t))return u[t]=i,i};n.construct=function(t,i,r,f,e){var o,s;if(n.isValidNamespaceKey(t)){if(o=u[t],!o)throw new Error("constructor does not exist for "+t);return s=o&&o.call(f,i||{},r||{},f),e&&e(s,f),s}};r=r||{};e=function(t,i,f){if(n.isValidNamespaceKey(t)){if(r[t])throw new Error("a spec already exist for "+t);if(u[t])throw new Error("a constructor already exist for "+t);return r[t]=i,u[t]=f?f:u.Component,i}};n.registerSpec=function(t,i){var r=t.myType;if(n.isValidNamespaceKey(r))return e(r,t,i)};n.establishSpec=function(t,f){try{return n.registerSpec(t,f)}catch(s){var e=t.myType,o=i.mixin(r[e],t);r[e]=o;f&&(u[e]=f)}return o};n.findSpec=function(t){if(n.isValidNamespaceKey(t))return r[t]};n.extendSpec=function(t,f,e){if(n.isValidNamespaceKey(t)){var o=i.mixin(r[t],f);return r[t]=o,e&&(u[t]=e),o}};n.instanceSpec=function(t){var i=t.getSpec();return t.Properties.forEach(function(t){t.formula&&(i[t.myName]="computed: "+n.utils.cleanFormulaText(t.formula))}),i};function c(t,i){var r=n.utils.cleanFormulaText(t);return r.length>i?r.substring(0,i)+"...":r}n.computedSpec=function(n){var t;return n.Properties.forEach(function(n){n.formula&&(t=t||{},t[n.myName]="computed: "+c(n.formula,100))}),t};n.defineType=function(t,r,u){if(n.isValidNamespaceKey(t)){var f=i.union(r,{myType:t}),o=e(t,f,u);return n.exportType(t),o}};n.establishType=function(t,r,u){if(n.isValidNamespaceKey(t))try{return n.defineType(t,r,u)}catch(e){var f=i.union(r,{myType:t});return n.extendSpec(t,f,u)}};n.extendSpec=function(t,f,e){if(n.isValidNamespaceKey(t)){var o=i.mixin(r[t],f);return r[t]=o,e&&(u[t]=e),o}};n.extendType=function(t,u){if(n.isValidNamespaceKey(t)){var f=i.mixin(r[t]||{},u);return r[t]=f,n.exportType(t),f}};n.createNewType=function(t,u,f){if(n.isValidNamespaceKey(t)){var e={};return u.forEach(function(n){var t=i.isString(n)?r[n]:n;e=i.union(e,t)}),n.establishType(t,e,f),s(t)}};n.getAllTypes=function(n){var t=[],i,u;for(i in r)u=o(i,n),t.push(u);return t};n.newSuper=function(t,f,e,o,s){if(n.isValidNamespaceKey(t)){var l=u[t]||u.Component,h=r[t],a=h?i.union(h,f):f,c=l.call(o,a,e,o);return s&&s(c,o),c}};n.new=function(n,t,i){var f=n.myType?n.myType:"Component",e=u[f]||u.Component,r=e.call(t,n,{},t);return i&&i(r,t),r};n.make=function(t,u,f){var e=t.myType;if(n.isValidNamespaceKey(e)){var o=r[e],s=o?i.union(o,t):t;return n.new(s,u,f)}};n.makeInstance=function(t,u,f,e){var o=i.isString(t)?r[t]:t,s=i.union(o,u);return n.make(s,f,e)};n.newInstance=function(t,i,u,f){if(n.isValidNamespaceKey(t)){var e=r[t];return n.makeInstance(e,i,u,f)}};n.extractSpec=function(t,i){if(n.isValidNamespaceKey(t)){var f=r[t],u={};if(i){for(key in f)i[key]&&(u[key]=i[key]);delete u.myType}return u}};n.newInstanceExtract=function(t,i,u,f){if(n.isValidNamespaceKey(t)){var e=n.extractSpec(t,i),o=r[t];return n.makeInstance(o,e,u,f)}};f={};n.exportType=function(t,i){var u,e;if(n.isValidNamespaceKey(t)&&(u=t.split("::"),!(u.length<2))){var h=u[0],c=u[1],r=f[h]=f[h]||{};return n[h]=r,e=n.utils.capitaliseFirstLetter(c),r["new"+e]=s(t),r["new"+e+"Extract"]=l(t),i&&(r.docs=r.docs||{},r.docs[e]=o(t,i)),f}};n.exportTypes=function(t){for(var i in r)n.exportType(i,t);return f}}(Foundry,Foundry.factory,Foundry.utils),function(n,t,i){function o(n,t){var i={myName:n,relation:u[n],linker:r[n]};try{t&&(i.instance=i.relation,i.spec=i.instance)}catch(f){i.ex=f}return i}var u=u||{},r=r||{},f=function(t){if(n.isValidNamespaceKey(t))return r[t]?r[t]:(r[t]=function(i,f,e){var o=u[t],s=o.linkerFn?o.linkerFn:n.makeRelation,h=s&&s.call(o,i,f);return e&&o.myInverse&&r[o.myInverse](f,i),h},r[t].unDo=function(i,f,e){var o=u[t],s=o.unlinkerFn?o.unlinkerFn:n.unmakeRelation,h=s&&s.call(o,i,f);return e&&o.myInverse&&r[o.myInverse].unDo(f,i),h},r[t])},e=function(t,e,o,s){if(n.isValidNamespaceKey(t)){if(u[t])throw new Error("a relationSpec already exist for "+t);if(r[t])throw new Error("a relationBuild already exist for "+t);var h=t.split("::"),c=h.length==2?h[0]:"",l=h.length==2?h[1]:h[0],a={myType:t,myInverse:e&&e.inverse,myName:l,namespace:c,linkerFn:o?o:u.linksTo.linkerFn,unlinkerFn:s?s:u.linksTo.unlinkerFn},v=i.union(a,e);return u[t]=v,f(t)}};n.establishRelation=function(t,i,r,u){if(n.isValidNamespaceKey(t))try{return e(t,i,r,u)}catch(o){return f(t)}};n.establishRelationship=function(t,i){var r=t.split("|"),u,f;return r.length!=2||i||(t=r[0],i=r[1]),u=n.establishRelation(t,{inverse:i}),f=n.establishRelation(i,{inverse:t}),u};n.getAllRelations=function(n){var t=[],i,r;for(i in u)r=o(i,n),t.push(r);return t}}(Foundry,Foundry.factory,Foundry.utils),function(n){n.establishType&&(n.establishType("Component",{},n.makeComponent),n.establishRelation)&&n.establishRelation("linksTo",{},n.makeRelation,n.unmakeRelation)}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n,t){var i=function(n,i,r){return this.myName=t,this.myParent=r,this.myType="Adaptor",this.createParameters(n),this};i.prototype={makeComputedValue:function(t,i,r){var f=n.utils.isFunction(r),u;return f?(u=r,Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:function(){return f?result=u.call(t,t):u},set:function(t){f=n.utils.isFunction(t);u=t}})):t[i]=r,t},createProperty:function(n,t){return this.makeComputedValue(this,n,t)},createParameters:function(n){var i,r;if(n!==t)for(i in n)n.hasOwnProperty(i)&&(r=n[i],this.createProperty.call(this,i,r))},subscribeToCommands:function(){var n=this,t=Object.keys(n);t.forEach(function(t){(t.startsWith("do")||t.startsWith("goto"))&&fo.subscribe(t,function(){n[t]})})}};n.Adaptor=i;n.makeAdaptor=function(t,i,r){return new n.Adaptor(t,i,r)};n.Component.prototype.createAdaptor=function(i){var r=new n.Adaptor(i,t,this);return this.Subcomponents.push(r),r}}(Foundry),function(n,t){function i(n,t,i){Object.defineProperty(n,t,{enumerable:!0,configurable:!0,get:function(){return i[t]},set:function(n){i[t]=n}})}n.attachComponent=function(n,r){var u,f,e;if(r!==t)for(u in r)u.startsWith("_")&&(f=r[u],e=f.myName,i(n,e,r));return n}}(Foundry);Foundry=Foundry||{};Foundry.hub=Foundry.hub||{},function(n,t,i){function o(n){t.trace&&t.trace.log(n)}function y(n,t){var i=f[n];return i?(i(t),!0):(i=u[n],i?(i(t),!0):void 0)}function l(t){e=t;n.receiveCrossDomainMessage=function(n){var t,i;try{o("Received message from "+n.origin+": "+n.data);t=JSON.parse(n.data);t&&(i=t.json?JSON.parse(t.payload):t.payload,c(t.command,i))}catch(r){o("Invalid message received")}};e?window.addEventListener("message",n.receiveCrossDomainMessage,!1):window.removeEventListener("message",n.receiveCrossDomainMessage);n.sendCrossDomainMessage=function(n,t,i){if(!n||n.closed)return o("No window or window closed"),!1;try{var r=JSON.stringify({command:t,payload:i,json:typeof i=="string"?!1:!0});o("Sending message: "+r);n.postMessage(r,"*")}catch(u){o("Unable to send message")}}}function h(){var n=r;p();n&&n.receiveMessage&&n.receiveMessage("windowClosed",{isMainWindow:s});r=i}function p(){r=i;f=i;delete window.receiveMessage}function c(n,i,r){var u=t.utils.isString(n);return u&&y(n,i)?!0:u&&!r?(alert(n+" WAS NOT PROCESSED "+window.location.pathname),!1):void 0}var u,f,s,r,e,a,v;n.subscribe=function(n,i){t.subscribe(n,i)};n.unsubscribe=function(n,i){t.unsubscribe([n,i])};n.publish=function(n,i){t.publish(n,i)};u={};n.registerCommand=function(n){return u=u?u:{},t.utils.extend(u,n)};f={};n.registerCommandResponse=function(n){return f=f?f:{},t.utils.extend(f,n)};n.sendCommand=function(t,i,r){n.sendMessage(t,i,r)};s=!1;r=window.opener;n.isWindowOpen=function(){return r?!0:!1};n.isMainWindow=function(){return s};e=!1;n.isCrossDomain=function(){return e};n.setCrossDomain=function(n){n!=e&&l(n)};l(e);n.sendMessage=function(t,i,u){var f=u?u:0;window.setTimeout(function(){e?n.sendCrossDomainMessage(r,t,i):r&&r.receiveMessage&&r.receiveMessage(t,i)},f)};n.getHttpContext=function(){return location.protocol+"//"+location.host+location.pathname.slice(0,location.pathname.indexOf("/",1))};n.doCommand=function(n,t,i){var r=u[n],f;if(r)return r(t),!0;f=i?i:0;window.setTimeout(function(){c(n,t,!0)},f)};r&&(window.onbeforeunload=function(){h()},n.registerCommandResponse({windowClosed:function(){h();window.close()}}),window.receiveMessage=function(n,t){c(n,t)});n.openWindow=function(t,u){return r?r:(s=!0,r=window.open(t,"_blank"),window.onbeforeunload=function(){h()},n.registerCommandResponse({windowClosed:function(n){n&&!n.isMainWindow&&(u&&u(r),r=i)}}),window.receiveMessage=function(n,t){c(n,t)},r)};n.closeWindow=function(){r&&h()};n.openIFrameWindow=function(t,u,f){if(r)return r;s=!0;l(!0);r=window.open(t,"_blank");var e=r.document,o=e.getElementById("iframe");return r=o,window.onbeforeunload=function(){h()},n.registerCommandResponse({windowClosed:function(n){n&&!n.isMainWindow&&(f&&f(r),r=i)}}),window.receiveMessage=function(n,t){c(n,t)},r};a="IUCommand";n.broadcastUICommand=function(t,i){n.publish(a,[t,i])};n.subscribeUICommand=function(t){n.subscribe(a,t)};v="DataQueryCommand";n.broadcastDataQuery=function(t,i){n.publish(v,[t,i])};n.subscribeDataQuery=function(t){n.subscribe(v,t)}}(Foundry.hub,Foundry);
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
saveAs=saveAs||navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(n){"use strict";var o=n.document,l=function(){return n.URL||n.webkitURL||n},a=n.URL||n.webkitURL||n,r=o.createElementNS("http://www.w3.org/1999/xhtml","a"),v=!n.externalHost&&"download"in r,y=function(t){var i=o.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,n,0,0,0,0,0,!1,!1,!1,!1,0,null);t.dispatchEvent(i)},u=n.webkitRequestFileSystem,s=n.requestFileSystem||u||n.mozRequestFileSystem,p=function(t){(n.setImmediate||n.setTimeout)(function(){throw t;},0)},f="application/octet-stream",h=0,i=[],w=function(){for(var t=i.length,n;t--;)n=i[t],typeof n=="string"?a.revokeObjectURL(n):n.remove();i.length=0},e=function(n,t,i){var r,u;for(t=[].concat(t),r=t.length;r--;)if(u=n["on"+t[r]],typeof u=="function")try{u.call(n,i||n)}catch(f){p(f)}},c=function(t,o){var c=this,k=t.type,d=!1,p,b,g=function(){var n=l().createObjectURL(t);return i.push(n),n},nt=function(){e(c,"writestart progress write writeend".split(" "))},a=function(){(d||!p)&&(p=g(t));b?b.location.href=p:window.open(p,"_blank");c.readyState=c.DONE;nt()},w=function(n){return function(){if(c.readyState!==c.DONE)return n.apply(this,arguments)}},tt={create:!0,exclusive:!1},it;if(c.readyState=c.INIT,o||(o="download"),v){p=g(t);r.href=p;r.download=o;y(r);c.readyState=c.DONE;nt();return}if(n.chrome&&k&&k!==f&&(it=t.slice||t.webkitSlice,t=it.call(t,0,t.size,f),d=!0),u&&o!=="download"&&(o+=".download"),(k===f||u)&&(b=n),!s){a();return}h+=t.size;s(n.TEMPORARY,h,w(function(n){n.root.getDirectory("saved",tt,w(function(n){var r=function(){n.getFile(o,tt,w(function(n){n.createWriter(w(function(r){r.onwriteend=function(t){b.location.href=n.toURL();i.push(n);c.readyState=c.DONE;e(c,"writeend",t)};r.onerror=function(){var n=r.error;n.code!==n.ABORT_ERR&&a()};"writestart progress write abort".split(" ").forEach(function(n){r["on"+n]=c["on"+n]});r.write(t);c.abort=function(){r.abort();c.readyState=c.DONE};c.readyState=c.WRITING}),a)}),a)};n.getFile(o,{create:!1},w(function(n){n.remove();r()}),w(function(n){n.code===n.NOT_FOUND_ERR?r():a()}))}),a)}),a)},t=c.prototype,b=function(n,t){return new c(n,t)};return t.abort=function(){var n=this;n.readyState=n.DONE;e(n,"abort")},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,n.addEventListener("unload",w,!1),b}(self);
/*! @source http://purl.eligrey.com/github/canvas-toBlob.js/blob/master/canvas-toBlob.js */
(function(n){"use strict";var t=n.Uint8Array,i=n.HTMLCanvasElement,u=/\s*;\s*base64\s*(?:;|$)/i,r,f=function(n){for(var c=n.length,f=new t(c/4*3|0),l=0,o=0,i=[0,0],s=0,u=0,e,h,a;c--;)h=n.charCodeAt(l++),e=r[h-43],e!==255&&e!==a&&(i[1]=i[0],i[0]=h,u=u<<6|e,s++,s===4&&(f[o++]=u>>>16,i[1]!==61&&(f[o++]=u>>>8),i[0]!==61&&(f[o++]=u),s=0));return f};t&&(r=new t([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51]));i&&!i.prototype.toBlob&&(i.prototype.toBlob=function(n,i){if(i||(i="image/png"),this.mozGetAsFile){n(this.mozGetAsFile("canvas",i));return}var c=Array.prototype.slice.call(arguments,1),o=this.toDataURL.apply(this,c),s=o.indexOf(","),e=o.substring(s+1),h=u.test(o.substring(0,s)),r;Blob.fake?(r=new Blob,r.encoding=h?"base64":"URI",r.data=e,r.size=e.length):t&&(r=h?new Blob([f(e)],{type:i}):new Blob([decodeURIComponent(e)],{type:i}));n(r)})})(self),function(){function i(t){var i,r,e,u,f,o;for(e=t.length,r=0,i="";r<e;){if(u=t.charCodeAt(r++)&255,r==e){i+=n.charAt(u>>2);i+=n.charAt((u&3)<<4);i+="==";break}if(f=t.charCodeAt(r++),r==e){i+=n.charAt(u>>2);i+=n.charAt((u&3)<<4|(f&240)>>4);i+=n.charAt((f&15)<<2);i+="=";break}o=t.charCodeAt(r++);i+=n.charAt(u>>2);i+=n.charAt((u&3)<<4|(f&240)>>4);i+=n.charAt((f&15)<<2|(o&192)>>6);i+=n.charAt(o&63)}return i}function r(n){var s,o,r,u,i,e,f;for(e=n.length,i=0,f="";i<e;){do s=t[n.charCodeAt(i++)&255];while(i<e&&s==-1);if(s==-1)break;do o=t[n.charCodeAt(i++)&255];while(i<e&&o==-1);if(o==-1)break;f+=String.fromCharCode(s<<2|(o&48)>>4);do{if(r=n.charCodeAt(i++)&255,r==61)return f;r=t[r]}while(i<e&&r==-1);if(r==-1)break;f+=String.fromCharCode((o&15)<<4|(r&60)>>2);do{if(u=n.charCodeAt(i++)&255,u==61)return f;u=t[u]}while(i<e&&u==-1);if(u==-1)break;f+=String.fromCharCode((r&3)<<6|u)}return f}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];window.btoa||(window.btoa=i);window.atob||(window.atob=r)}();Foundry=Foundry||{};Foundry.canvas=Foundry.canvas||{};Foundry.workspace=Foundry.workspace||{};Foundry.ws=Foundry.workspace,function(n,t,i,r){function o(n,t,i){if(n&&t){for(var r in i)i[r]&&(t[r]=n[r]);return t}}var s=t.utils,h={isVisible:!0,rootModel:function(){},rootPage:function(){},localStorageKey:"FoundryLocal",userNickName:function(){return"Anonymous"},userId:function(){return"unknown"},hasUserId:function(){return!this.userId.matches("unknown")},sessionKey:function(){return"NO_SESSION"},hasSessionKey:function(){var n=this.sessionKey;return!n||n.length==0?(this._sessionKey.smash(),!1):!n.matches("NO_SESSION")},sessionUrl:"",sessionTitle:"",documentName:"",documentExt:"",isDocumentSaved:!1,documentTitle:function(){var n=this.documentName+this.documentExt;return n&&!this.isDocumentSaved&&(n+="*"),n},title:function(){return this.rootModel?this.rootModel.title:r},subTitle:function(){return this.rootModel?this.rootModel.subTitle:r},clientCount:"#",traffic:"0"},u=function(n,i,r){return t.exportTypes(),this.base=t.Component,this.base(s.union(h,n),i,r),this.myType=n&&n.myType||"Workspace",this},f,e;u.prototype=function(){var n=function(){this.constructor=u};return n.prototype=t.Component.prototype,new n}();n.Workspace=u;s.isaWorkspace=function(n){return n instanceof u?!0:!1};t.myWorkspace=function(n){var i=n&&n.myType;return s.isaWorkspace(n)?n:n&&n.myParent?t.myWorkspace(n.myParent):void 0};f={documentName:!0,documentExt:!0,isDocumentSaved:!0};e={sessionKey:!0,sessionUrl:!0,userNickName:!0,userId:!0};u.prototype.currentSessionSpec=function(){var n={};return o(this,n,e),n};u.prototype.currentDocumentSpec=function(){var n={};return o(this,n,f),n};u.prototype.attachDocumentDetails=function(n){var i=t.utils.union({version:t.version,title:this.title,subTitle:this.subTitle,lastModified:new Date},n);return this.copyDocumentSpecTo(i),i};u.prototype.defaultNS=function(n){return t.getNamespaceKey(this.myName,n)};u.prototype.stencilNS=function(n){return t.getNamespaceKey(this.myName,n)};u.prototype.copyDocumentSpecTo=function(n){return o(this,n,f)};u.prototype.copyDocumentSpecFrom=function(n){return o(n,this,f)};u.prototype.clearDocumentSpec=function(){for(var n in f)f[n]&&(this[n]="");return this};u.prototype.copySessionSpecTo=function(n){return o(this,n,e)};u.prototype.copySessionSpecFrom=function(n){return o(n,this,e)};u.prototype.clearSessionSpec=function(){for(var n in e)e[n]&&(this[n]="");return this};u.prototype.clear=function(){var n=this;n.rootModel.removeAllSubcomponents();n.rootPage&&(n.rootPage.selectShape(r,!0),n.rootPage.removeAllSubcomponents(),n.rootPage.updateStage(!0));delete n.localData;t.publish("WorkspaceClear",[n])};u.prototype.payloadSaveAs=function(n,i,r,u){if(!saveAs&&n)return!1;var f=s.isString(n)?n:t.stringifyPayload(n);return t.writeTextFileAsync(f,i,r,u),!0};u.prototype.userSaveFileDialog=function(){t.publish("info",["Workspace.userSaveFileDialog","method missing"])};u.prototype.userOpenImageDialog=function(n){return this.userOpenFileDialog(n,"image/*")};u.prototype.userOpenFileDialog=function(n,i,r){var s=i||".knt,.csv",u=document.createElement("input");u.setAttribute("type","file");u.setAttribute("accept",s);u.setAttribute("value",r);u.setAttribute("style","visibility: hidden; width: 0px; height: 0px");document.body.appendChild(u);u.click();var o=u.files,h=o.length,e=h>0&&o[0],f=e?e.name.match(/\.[0-9a-z]+$/i):[""];f=f[0];document.body.removeChild(u);e&&e.type.startsWith("image")?t.readImageFileAsync(e,f,n):e&&(f.matches(".knt")||f.matches(".csv")||f.matches(".json")||f.matches(".txt"))&&t.readTextFileAsync(e,f,n)};u.prototype.matchesSession=function(n){return this.hasSessionKey&&this.sessionKey.matches(n)};u.prototype.matchesUser=function(n){return this.hasUserId&&this.userId.matches(n)};u.prototype.digestLock=function(n,i){var r=this.rootPage;t.digestLock(r,n,i)};u.prototype.specToModelSync=function(n,i,r){if(n){this.localData=t.utils.mixin(this.localData,n.localData);var e=this.rootModel,f=this.rootPage,u=this;u.modelDictionary=u.modelDictionary||{};u.pageDictionary=u.pageDictionary||{};t.modelDictionary=u.modelDictionary;t.pageDictionary=u.pageDictionary;try{t.runWithUIRefreshLock(function(){n.document&&u.copyDocumentSpecFrom(n.document);e.rehydrate(e,n.model,u.modelDictionary,i);f&&f.rehydrate(f,n.drawing,u.pageDictionary,r)})}catch(o){throw new Error("specToModelSync: "+o.message);}return{command:n.command,document:n.document}}};u.prototype.saveSession=function(n,i,r){var f=this,u;f.sessionStorageDate=Date.now();u=f.documentName||i||this.localStorageKey;localStorage&&(localStorage.setItem("currentSession",u),localStorage.setItem(u,u?n:""));localStorage&&localStorage.setItem(i||this.localStorageKey,n);r&&r();t.publish("workspaceSessionSaved",[f])};u.prototype.restoreSession=function(n,i){var o=this,u,e,f;if(sessionStorage){localStorage&&(e=localStorage.getItem("currentSession"),u=e?localStorage.getItem(e):r);localStorage&&!u&&(u=localStorage.getItem(n||this.localStorageKey));try{f=i&&i(u);f&&f.document&&(space.copyDocumentSpecFrom(f.document),o.sessionStorageDate=f.document.sessionStorageDate)}catch(s){localStorage.setItem("currentSession","")}t.publish("workspaceSessionRestored",[o])}return u};u.prototype.payloadToCurrentModel=function(n){if(n){var i=t.parsePayload(n);return this.specToModelSync(i)}};u.prototype.currentModelToPayload=function(n,i,r){var u=this.modelToSpec(n,i,r);return u.localData=this.localData||{},t.stringifyPayload(u)};u.prototype.currentModelTarget=function(){var n=this.rootPage&&this.rootPage.selectedContext();return n?n:this.rootModel};u.prototype.currentViewTarget=function(){var n=this.rootPage&&this.rootPage.selectedShape();return n?n:this.rootPage};n.makeWorkspace=function(n,t,i){return new u(n,t,i)};n.makeModelWorkspace=function(n,i,r){var e={myName:n,spec:r,Subcomponents:{}},f=new u(i);return f.myName=n+"Session",f.rootModel||(f.rootModel=t.makeModel(e,f)),f.modelToSpec=function(n,t){var r=this.rootModel?this.rootModel.Subcomponents.map(function(n){return n.dehydrate(!0)}):[],i={command:n,model:r,localData:this.localData};return t&&(i.document=f.attachDocumentDetails()),i},f};n.makeNoteWorkspace=function(u,f,e,o){var l={localStorageKey:u+"Session"},c=f&&f.canvasId,a=f&&f.panZoomCanvasId,v=f&&f.pipId,h=n.makeModelWorkspace(u,s.union(l,f),e);return o&&t.enableFileDragAndDrop(c),h.drawing=i.makeDrawing(c,a,v,f),h.drawing.myParent=h,h.rootPage=h.drawing.page,h.rootPage.setAnimationsOn(!0),h.rootPage.updateStage(),h.saveCanvasAsBlob=function(n,i){var r=h.rootPage.canvas;r.toBlob(function(r){t.writeBlobFile(r,n,i)})},h.doSessionSave=function(){var n=this,t=n.currentModelToPayload({},!0,!0);n.saveSession(t,n.localStorageKey,function(){})},h.doSessionRestore=function(){var n=this;n.restoreSession(n.localStorageKey,function(t){n.clear();n.digestLock(function(){n.payloadToCurrentModel(t)})})},h.payloadToLocalData=function(n,i){var r,f,u;if(i)return r=this,r.localData=r.localData||{},f=t.convert.csvToJson(i),u=t.parsePayload(f),r.localData[n]=u,u},h.modelToSpec=function(n,t,i){this.rootPage&&!i&&(this.rootPage.selectShape(r,!0),this.rootPage.selectDropTarget(r,!0));var f=this.rootModel?this.rootModel.Subcomponents.map(function(n){return n.dehydrate(!0)}):[],e=this.rootPage?this.rootPage.Subcomponents.map(function(n){return n.dehydrate(!0,{isSelected:!1,isActiveTarget:!1})}):[],u={command:n,model:f,drawing:e,localData:this.localData};return t&&(u.document=h.attachDocumentDetails()),u},h}}(Foundry.workspace,Foundry,Foundry.canvas);Foundry=Foundry||{};Foundry.undo=Foundry.undo||{},function(n,t){var s=0,r=!1,u=!1,i=[];n.clear=function(){i=[]};n.canUndo=function(){return i.length?!0:!1};n.isUndoing=function(){return u};n.isDoing=function(){return r};var f={},e={},o={};n.do=function(n,u){r=!0;var o=f[n],e={action:n,payload:u,undoID:s++};return i.push(e),e.payload=o?o.call(e,u):u,r=!1,t.publish("undoAdded",[e]),e};n.unDo=function(r){var f,o;if(n.canUndo()){u=!0;f=r;f?i.removeItem(r):(o=i.length-1,f=i.splice(o,1)[0]);var s=f.payload,h=e[f.action],c=h?h.call(f,s):s;return u=!1,t.publish("undoRemoved",[f]),c}};n.verifyKeep=function(n,t){if(!n)return!0;var f=n.action,r=o[f],u=r?r.call(n,t,n.payload):!0;return u||i.removeItem(n),u};n.registerActions=function(n,t,i,r){f[n]=t?t:function(n){return n};e[n]=i?i:function(n){return n};o[n]=r?r:function(){return!0}}}(Foundry.undo,Foundry);
//! moment.js
//! version : 2.5.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
(function(n){function nt(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function dt(n,t){return function(i){return u(n.call(this,i),t)}}function tr(n,t){return function(i){return this.lang().ordinal(n.call(this,i),t)}}function gt(){}function tt(n){fi(n);s(this,n)}function it(n){var t=ti(n),i=t.year||0,r=t.month||0,u=t.week||0,f=t.day||0,e=t.hour||0,o=t.minute||0,s=t.second||0,h=t.millisecond||0;this._milliseconds=+h+1e3*s+6e4*o+36e5*e;this._days=+f+7*u;this._months=+r+12*i;this._data={};this._bubble()}function s(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return t.hasOwnProperty("toString")&&(n.toString=t.toString),t.hasOwnProperty("valueOf")&&(n.valueOf=t.valueOf),n}function ir(n){var t,i={};for(t in n)n.hasOwnProperty(t)&&tu.hasOwnProperty(t)&&(i[t]=n[t]);return i}function a(n){return 0>n?Math.ceil(n):Math.floor(n)}function u(n,t,i){for(var r=""+Math.abs(n),u=n>=0;r.length<t;)r="0"+r;return(u?i?"+":"":"-")+r}function rt(n,i,r,u){var s,h,o=i._milliseconds,f=i._days,e=i._months;o&&n._d.setTime(+n._d+o*r);(f||e)&&(s=n.minute(),h=n.hour());f&&n.date(n.date()+f*r);e&&n.month(n.month()+e*r);o&&!u&&t.updateOffset(n);(f||e)&&(n.minute(s),n.hour(h))}function ut(n){return"[object Array]"===Object.prototype.toString.call(n)}function rr(n){return"[object Date]"===Object.prototype.toString.call(n)||n instanceof Date}function ni(n,t,r){for(var e=Math.min(n.length,t.length),o=Math.abs(n.length-t.length),f=0,u=0;e>u;u++)(r&&n[u]!==t[u]||!r&&i(n[u])!==i(t[u]))&&f++;return f+o}function h(n){if(n){var t=n.toLowerCase().replace(/(.)s$/,"$1");n=ku[n]||du[t]||t}return n}function ti(n){var i,t,r={};for(t in n)n.hasOwnProperty(t)&&(i=h(t),i&&(r[i]=n[t]));return r}function ur(i){var r,u;if(0===i.indexOf("week"))r=7,u="day";else{if(0!==i.indexOf("month"))return;r=12;u="month"}t[i]=function(f,e){var o,s,c=t.fn._lang[i],h=[];if("number"==typeof f&&(e=f,f=n),s=function(n){var i=t().utc().set(u,n);return c.call(t.fn._lang,i,f||"")},null!=e)return s(e);for(o=0;r>o;o++)h.push(s(o));return h}}function i(n){var t=+n,i=0;return 0!==t&&isFinite(t)&&(i=t>=0?Math.floor(t):Math.ceil(t)),i}function ii(n,t){return new Date(Date.UTC(n,t+1,0)).getUTCDate()}function ri(n){return ui(n)?366:365}function ui(n){return n%4==0&&n%100!=0||n%400==0}function fi(n){var t;n._a&&-2===n._pf.overflow&&(t=n._a[v]<0||n._a[v]>11?v:n._a[c]<1||n._a[c]>ii(n._a[e],n._a[v])?c:n._a[o]<0||n._a[o]>23?o:n._a[w]<0||n._a[w]>59?w:n._a[b]<0||n._a[b]>59?b:n._a[k]<0||n._a[k]>999?k:-1,n._pf._overflowDayOfYear&&(e>t||t>c)&&(t=c),n._pf.overflow=t)}function ei(n){return null==n._isValid&&(n._isValid=!isNaN(n._d.getTime())&&n._pf.overflow<0&&!n._pf.empty&&!n._pf.invalidMonth&&!n._pf.nullInput&&!n._pf.invalidFormat&&!n._pf.userInvalidated,n._strict&&(n._isValid=n._isValid&&0===n._pf.charsLeftOver&&0===n._pf.unusedTokens.length)),n._isValid}function ft(n){return n?n.toLowerCase().replace("_","-"):n}function et(n,i){return i._isUTC?t(n).zone(i._offset||0):t(n).local()}function fr(n,t){return t.abbr=n,y[n]||(y[n]=new gt),y[n].set(t),y[n]}function er(n){delete y[n]}function f(n){var r,u,i,f,e=0,o=function(n){if(!y[n]&&yi)try{require("./lang/"+n)}catch(t){}return y[n]};if(!n)return t.fn._lang;if(!ut(n)){if(u=o(n))return u;n=[n]}for(;e<n.length;){for(f=ft(n[e]).split("-"),r=f.length,i=ft(n[e+1]),i=i?i.split("-"):null;r>0;){if(u=o(f.slice(0,r).join("-")))return u;if(i&&i.length>=r&&ni(f,i,!0)>=r-1)break;r--}e++}return t.fn._lang}function or(n){return n.match(/\[[\s\S]/)?n.replace(/^\[|\]$/g,""):n.replace(/\\/g,"")}function sr(n){for(var i=n.match(pi),t=0,r=i.length;r>t;t++)i[t]=l[i[t]]?l[i[t]]:or(i[t]);return function(u){var f="";for(t=0;r>t;t++)f+=i[t]instanceof Function?i[t].call(u,n):i[t];return f}}function ot(n,t){return n.isValid()?(t=oi(t,n.lang()),kt[t]||(kt[t]=sr(t)),kt[t](n)):n.lang().invalidDate()}function oi(n,t){function r(n){return t.longDateFormat(n)||n}var i=5;for(g.lastIndex=0;i>=0&&g.test(n);)n=n.replace(g,r),g.lastIndex=0,i-=1;return n}function hr(n,t){var i=t._strict;switch(n){case"DDDD":return ki;case"YYYY":case"GGGG":case"gggg":return i?vu:eu;case"Y":case"G":case"g":return pu;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return i?yu:ou;case"S":if(i)return au;case"SS":if(i)return bi;case"SSS":if(i)return ki;case"DDD":return fu;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return hu;case"a":case"A":return f(t._l)._meridiemParse;case"X":return lu;case"Z":case"ZZ":return vt;case"T":return cu;case"SSSS":return su;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return i?bi:wi;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return wi;default:return new RegExp(yr(vr(n.replace("\\","")),"i"))}}function si(n){n=n||"";var r=n.match(vt)||[],f=r[r.length-1]||[],t=(f+"").match(bu)||["-",0,0],u=+(60*t[1])+i(t[2]);return"+"===t[0]?-u:u}function cr(n,t,r){var s,u=r._a;switch(n){case"M":case"MM":null!=t&&(u[v]=i(t)-1);break;case"MMM":case"MMMM":s=f(r._l).monthsParse(t);null!=s?u[v]=s:r._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(u[c]=i(t));break;case"DDD":case"DDDD":null!=t&&(r._dayOfYear=i(t));break;case"YY":u[e]=i(t)+(i(t)>68?1900:2e3);break;case"YYYY":case"YYYYY":case"YYYYYY":u[e]=i(t);break;case"a":case"A":r._isPm=f(r._l).isPM(t);break;case"H":case"HH":case"h":case"hh":u[o]=i(t);break;case"m":case"mm":u[w]=i(t);break;case"s":case"ss":u[b]=i(t);break;case"S":case"SS":case"SSS":case"SSSS":u[k]=i(1e3*("0."+t));break;case"X":r._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":r._useUTC=!0;r._tzm=si(t);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":n=n.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":n=n.substr(0,2);t&&(r._w=r._w||{},r._w[n]=t)}}function st(n){var r,a,y,p,b,u,l,s,k,d,h=[];if(!n._d){for(y=ar(n),n._w&&null==n._a[c]&&null==n._a[v]&&(b=function(i){var r=parseInt(i,10);return i?i.length<3?r>68?1900+r:2e3+r:r:null==n._a[e]?t().weekYear():n._a[e]},u=n._w,null!=u.GG||null!=u.W||null!=u.E?l=ci(b(u.GG),u.W||1,u.E,4,1):(s=f(n._l),k=null!=u.d?hi(u.d,s):null!=u.e?parseInt(u.e,10)+s._week.dow:0,d=parseInt(u.w,10)||1,null!=u.d&&k<s._week.dow&&d++,l=ci(b(u.gg),d,k,s._week.doy,s._week.dow)),n._a[e]=l.year,n._dayOfYear=l.dayOfYear),n._dayOfYear&&(p=null==n._a[e]?y[e]:n._a[e],n._dayOfYear>ri(p)&&(n._pf._overflowDayOfYear=!0),a=ct(p,0,n._dayOfYear),n._a[v]=a.getUTCMonth(),n._a[c]=a.getUTCDate()),r=0;3>r&&null==n._a[r];++r)n._a[r]=h[r]=y[r];for(;7>r;r++)n._a[r]=h[r]=null==n._a[r]?2===r?1:0:n._a[r];h[o]+=i((n._tzm||0)/60);h[w]+=i((n._tzm||0)%60);n._d=(n._useUTC?ct:kr).apply(null,h)}}function lr(n){var t;n._d||(t=ti(n._i),n._a=[t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond],st(n))}function ar(n){var t=new Date;return n._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function ht(n){n._a=[];n._pf.empty=!0;for(var t,r,s,c=f(n._l),i=""+n._i,a=i.length,h=0,e=oi(n._f,c).match(pi)||[],u=0;u<e.length;u++)r=e[u],t=(i.match(hr(r,n))||[])[0],t&&(s=i.substr(0,i.indexOf(t)),s.length>0&&n._pf.unusedInput.push(s),i=i.slice(i.indexOf(t)+t.length),h+=t.length),l[r]?(t?n._pf.empty=!1:n._pf.unusedTokens.push(r),cr(r,t,n)):n._strict&&!t&&n._pf.unusedTokens.push(r);n._pf.charsLeftOver=a-h;i.length>0&&n._pf.unusedInput.push(i);n._isPm&&n._a[o]<12&&(n._a[o]+=12);n._isPm===!1&&12===n._a[o]&&(n._a[o]=0);st(n);fi(n)}function vr(n){return n.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(n,t,i,r,u){return t||i||r||u})}function yr(n){return n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function pr(n){var t,f,u,r,i;if(0===n._f.length)return n._pf.invalidFormat=!0,n._d=new Date(NaN),void 0;for(r=0;r<n._f.length;r++)i=0,t=s({},n),t._pf=nt(),t._f=n._f[r],ht(t),ei(t)&&(i+=t._pf.charsLeftOver,i+=10*t._pf.unusedTokens.length,t._pf.score=i,(null==u||u>i)&&(u=i,f=t));s(n,f||t)}function wr(n){var t,r,i=n._i,u=wu.exec(i);if(u){for(n._pf.iso=!0,t=0,r=yt.length;r>t;t++)if(yt[t][1].exec(i)){n._f=yt[t][0]+(u[6]||" ");break}for(t=0,r=pt.length;r>t;t++)if(pt[t][1].exec(i)){n._f+=pt[t][0];break}i.match(vt)&&(n._f+="Z");ht(n)}else n._d=new Date(i)}function br(t){var i=t._i,r=iu.exec(i);i===n?t._d=new Date:r?t._d=new Date(+r[1]):"string"==typeof i?wr(t):ut(i)?(t._a=i.slice(0),st(t)):rr(i)?t._d=new Date(+i):"object"==typeof i?lr(t):t._d=new Date(i)}function kr(n,t,i,r,u,f,e){var o=new Date(n,t,i,r,u,f,e);return 1970>n&&o.setFullYear(n),o}function ct(n){var t=new Date(Date.UTC.apply(null,arguments));return 1970>n&&t.setUTCFullYear(n),t}function hi(n,t){if("string"==typeof n)if(isNaN(n)){if(n=t.weekdaysParse(n),"number"!=typeof n)return null}else n=parseInt(n,10);return n}function dr(n,t,i,r,u){return u.relativeTime(t||1,!!i,n,r)}function gr(n,t,i){var o=p(Math.abs(n)/1e3),u=p(o/60),f=p(u/60),r=p(f/24),s=p(r/365),e=45>o&&["s",o]||1===u&&["m"]||45>u&&["mm",u]||1===f&&["h"]||22>f&&["hh",f]||1===r&&["d"]||25>=r&&["dd",r]||45>=r&&["M"]||345>r&&["MM",p(r/30)]||1===s&&["y"]||["yy",s];return e[2]=t,e[3]=n>0,e[4]=i,dr.apply({},e)}function d(n,i,r){var f,e=r-i,u=r-n.day();return u>e&&(u-=7),e-7>u&&(u+=7),f=t(n).add("d",u),{week:Math.ceil(f.dayOfYear()/7),year:f.year()}}function ci(n,t,i,r,u){var o,f,e=ct(n,0,1).getUTCDay();return i=null!=i?i:u,o=u-e+(e>r?7:0)-(u>e?7:0),f=7*(t-1)+(i-u)+o+1,{year:f>0?n:n-1,dayOfYear:f>0?f:ri(n-1)+f}}function li(n){var i=n._i,r=n._f;return null===i?t.invalid({nullInput:!0}):("string"==typeof i&&(n._i=i=f().preparse(i)),t.isMoment(i)?(n=ir(i),n._d=new Date(+i._d)):r?ut(r)?pr(n):ht(n):br(n),new tt(n))}function ai(n,i){t.fn[n]=t.fn[n+"s"]=function(n){var r=this._isUTC?"UTC":"";return null!=n?(this._d["set"+r+i](n),t.updateOffset(this),this):this._d["get"+r+i]()}}function nu(n){t.duration.fn[n]=function(){return this._data[n]}}function vi(n,i){t.duration.fn["as"+n]=function(){return+this/i}}function lt(n){var i=!1,r=t;"undefined"==typeof ender&&(n?(at.moment=function(){return!i&&console&&console.warn&&(i=!0,console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),r.apply(null,arguments)},s(at.moment,r)):at.moment=t)}for(var t,r,at=this,p=Math.round,e=0,v=1,c=2,o=3,w=4,b=5,k=6,y={},tu={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_isUTC:null,_offset:null,_pf:null,_lang:null},yi="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require,iu=/^\/?Date\((\-?\d+)/i,ru=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,uu=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,pi=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,g=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,wi=/\d\d?/,fu=/\d{1,3}/,eu=/\d{1,4}/,ou=/[+\-]?\d{1,6}/,su=/\d+/,hu=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,vt=/Z|[\+\-]\d\d:?\d\d/gi,cu=/T/i,lu=/[\+\-]?\d+(\.\d{1,3})?/,au=/\d/,bi=/\d\d/,ki=/\d{3}/,vu=/\d{4}/,yu=/[+-]?\d{6}/,pu=/[+-]?\d+/,wu=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,yt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],pt=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],bu=/([\+\-]|\d\d)/gi,wt="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),bt={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},ku={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},du={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},kt={},di="DDD w W M D d".split(" "),gi="M D H h m s w W".split(" "),l={M:function(){return this.month()+1},MMM:function(n){return this.lang().monthsShort(this,n)},MMMM:function(n){return this.lang().months(this,n)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(n){return this.lang().weekdaysMin(this,n)},ddd:function(n){return this.lang().weekdaysShort(this,n)},dddd:function(n){return this.lang().weekdays(this,n)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return u(this.year()%100,2)},YYYY:function(){return u(this.year(),4)},YYYYY:function(){return u(this.year(),5)},YYYYYY:function(){var n=this.year(),t=n>=0?"+":"-";return t+u(Math.abs(n),6)},gg:function(){return u(this.weekYear()%100,2)},gggg:function(){return u(this.weekYear(),4)},ggggg:function(){return u(this.weekYear(),5)},GG:function(){return u(this.isoWeekYear()%100,2)},GGGG:function(){return u(this.isoWeekYear(),4)},GGGGG:function(){return u(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return i(this.milliseconds()/100)},SS:function(){return u(i(this.milliseconds()/10),2)},SSS:function(){return u(this.milliseconds(),3)},SSSS:function(){return u(this.milliseconds(),3)},Z:function(){var n=-this.zone(),t="+";return 0>n&&(n=-n,t="-"),t+u(i(n/60),2)+":"+u(i(n)%60,2)},ZZ:function(){var n=-this.zone(),t="+";return 0>n&&(n=-n,t="-"),t+u(i(n/60),2)+u(i(n)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},nr=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];di.length;)r=di.pop(),l[r+"o"]=tr(l[r],r);for(;gi.length;)r=gi.pop(),l[r+r]=dt(l[r],2);for(l.DDDD=dt(l.DDD,3),s(gt.prototype,{set:function(n){var t;for(var i in n)t=n[i],"function"==typeof t?this[i]=t:this["_"+i]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(n){return this._months[n.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(n){return this._monthsShort[n.month()]},monthsParse:function(n){var i,r,u;for(this._monthsParse||(this._monthsParse=[]),i=0;12>i;i++)if(this._monthsParse[i]||(r=t.utc([2e3,i]),u="^"+this.months(r,"")+"|^"+this.monthsShort(r,""),this._monthsParse[i]=new RegExp(u.replace(".",""),"i")),this._monthsParse[i].test(n))return i},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(n){return this._weekdays[n.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(n){return this._weekdaysShort[n.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(n){return this._weekdaysMin[n.day()]},weekdaysParse:function(n){var i,r,u;for(this._weekdaysParse||(this._weekdaysParse=[]),i=0;7>i;i++)if(this._weekdaysParse[i]||(r=t([2e3,1]).day(i),u="^"+this.weekdays(r,"")+"|^"+this.weekdaysShort(r,"")+"|^"+this.weekdaysMin(r,""),this._weekdaysParse[i]=new RegExp(u.replace(".",""),"i")),this._weekdaysParse[i].test(n))return i},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(n){var t=this._longDateFormat[n];return!t&&this._longDateFormat[n.toUpperCase()]&&(t=this._longDateFormat[n.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(n){return n.slice(1)}),this._longDateFormat[n]=t),t},isPM:function(n){return"p"===(n+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(n,t,i){return n>11?i?"pm":"PM":i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(n,t){var i=this._calendar[n];return"function"==typeof i?i.apply(t):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(n,t,i,r){var u=this._relativeTime[i];return"function"==typeof u?u(n,t,i,r):u.replace(/%d/i,n)},pastFuture:function(n,t){var i=this._relativeTime[n>0?"future":"past"];return"function"==typeof i?i(t):i.replace(/%s/i,t)},ordinal:function(n){return this._ordinal.replace("%d",n)},_ordinal:"%d",preparse:function(n){return n},postformat:function(n){return n},week:function(n){return d(n,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),t=function(t,i,r,u){var f;return"boolean"==typeof r&&(u=r,r=n),f={},f._isAMomentObject=!0,f._i=t,f._f=i,f._l=r,f._strict=u,f._isUTC=!1,f._pf=nt(),li(f)},t.utc=function(t,i,r,u){var f;return"boolean"==typeof r&&(u=r,r=n),f={},f._isAMomentObject=!0,f._useUTC=!0,f._isUTC=!0,f._l=r,f._i=t,f._f=i,f._strict=u,f._pf=nt(),li(f).utc()},t.unix=function(n){return t(1e3*n)},t.duration=function(n,r){var f,h,e,s=n,u=null;return t.isDuration(n)?s={ms:n._milliseconds,d:n._days,M:n._months}:"number"==typeof n?(s={},r?s[r]=n:s.milliseconds=n):(u=ru.exec(n))?(f="-"===u[1]?-1:1,s={y:0,d:i(u[c])*f,h:i(u[o])*f,m:i(u[w])*f,s:i(u[b])*f,ms:i(u[k])*f}):(u=uu.exec(n))&&(f="-"===u[1]?-1:1,e=function(n){var t=n&&parseFloat(n.replace(",","."));return(isNaN(t)?0:t)*f},s={y:e(u[2]),M:e(u[3]),d:e(u[4]),h:e(u[5]),m:e(u[6]),s:e(u[7]),w:e(u[8])}),h=new it(s),t.isDuration(n)&&n.hasOwnProperty("_lang")&&(h._lang=n._lang),h},t.version="2.5.1",t.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",t.updateOffset=function(){},t.lang=function(n,i){var r;return n?(i?fr(ft(n),i):null===i?(er(n),n="en"):y[n]||f(n),r=t.duration.fn._lang=t.fn._lang=f(n),r._abbr):t.fn._lang._abbr},t.langData=function(n){return n&&n._lang&&n._lang._abbr&&(n=n._lang._abbr),f(n)},t.isMoment=function(n){return n instanceof tt||null!=n&&n.hasOwnProperty("_isAMomentObject")},t.isDuration=function(n){return n instanceof it},r=nr.length-1;r>=0;--r)ur(nr[r]);for(t.normalizeUnits=function(n){return h(n)},t.invalid=function(n){var i=t.utc(NaN);return null!=n?s(i._pf,n):i._pf.userInvalidated=!0,i},t.parseZone=function(n){return t(n).parseZone()},s(t.fn=tt.prototype,{clone:function(){return t(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var n=t(this).utc();return 0<n.year()&&n.year()<=9999?ot(n,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):ot(n,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var n=this;return[n.year(),n.month(),n.date(),n.hours(),n.minutes(),n.seconds(),n.milliseconds()]},isValid:function(){return ei(this)},isDSTShifted:function(){return this._a?this.isValid()&&ni(this._a,(this._isUTC?t.utc(this._a):t(this._a)).toArray())>0:!1},parsingFlags:function(){return s({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(n){var i=ot(this,n||t.defaultFormat);return this.lang().postformat(i)},add:function(n,i){var r;return r="string"==typeof n?t.duration(+i,n):t.duration(n,i),rt(this,r,1),this},subtract:function(n,i){var r;return r="string"==typeof n?t.duration(+i,n):t.duration(n,i),rt(this,r,-1),this},diff:function(n,i,r){var u,e,f=et(n,this),o=6e4*(this.zone()-f.zone());return i=h(i),"year"===i||"month"===i?(u=432e5*(this.daysInMonth()+f.daysInMonth()),e=12*(this.year()-f.year())+(this.month()-f.month()),e+=(this-t(this).startOf("month")-(f-t(f).startOf("month")))/u,e-=6e4*(this.zone()-t(this).startOf("month").zone()-(f.zone()-t(f).startOf("month").zone()))/u,"year"===i&&(e/=12)):(u=this-f,e="second"===i?u/1e3:"minute"===i?u/6e4:"hour"===i?u/36e5:"day"===i?(u-o)/864e5:"week"===i?(u-o)/6048e5:u),r?e:a(e)},from:function(n,i){return t.duration(this.diff(n)).lang(this.lang()._abbr).humanize(!i)},fromNow:function(n){return this.from(t(),n)},calendar:function(){var i=et(t(),this).startOf("day"),n=this.diff(i,"days",!0),r=-6>n?"sameElse":-1>n?"lastWeek":0>n?"lastDay":1>n?"sameDay":2>n?"nextDay":7>n?"nextWeek":"sameElse";return this.format(this.lang().calendar(r,this))},isLeapYear:function(){return ui(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(n){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=n?(n=hi(n,this.lang()),this.add({d:n-t})):t},month:function(n){var i,r=this._isUTC?"UTC":"";return null!=n?"string"==typeof n&&(n=this.lang().monthsParse(n),"number"!=typeof n)?this:(i=this.date(),this.date(1),this._d["set"+r+"Month"](n),this.date(Math.min(i,this.daysInMonth())),t.updateOffset(this),this):this._d["get"+r+"Month"]()},startOf:function(n){switch(n=h(n)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===n?this.weekday(0):"isoWeek"===n&&this.isoWeekday(1),this},endOf:function(n){return n=h(n),this.startOf(n).add("isoWeek"===n?"week":n,1).subtract("ms",1)},isAfter:function(n,i){return i="undefined"!=typeof i?i:"millisecond",+this.clone().startOf(i)>+t(n).startOf(i)},isBefore:function(n,i){return i="undefined"!=typeof i?i:"millisecond",+this.clone().startOf(i)<+t(n).startOf(i)},isSame:function(n,t){return t=t||"ms",+this.clone().startOf(t)==+et(n,this).startOf(t)},min:function(n){return n=t.apply(null,arguments),this>n?this:n},max:function(n){return n=t.apply(null,arguments),n>this?this:n},zone:function(n){var i=this._offset||0;return null==n?this._isUTC?i:this._d.getTimezoneOffset():("string"==typeof n&&(n=si(n)),Math.abs(n)<16&&(n=60*n),this._offset=n,this._isUTC=!0,i!==n&&rt(this,t.duration(i-n,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(n){return n=n?t(n).zone():0,(this.zone()-n)%60==0},daysInMonth:function(){return ii(this.year(),this.month())},dayOfYear:function(n){var i=p((t(this).startOf("day")-t(this).startOf("year"))/864e5)+1;return null==n?i:this.add("d",n-i)},quarter:function(){return Math.ceil((this.month()+1)/3)},weekYear:function(n){var t=d(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==n?t:this.add("y",n-t)},isoWeekYear:function(n){var t=d(this,1,4).year;return null==n?t:this.add("y",n-t)},week:function(n){var t=this.lang().week(this);return null==n?t:this.add("d",7*(n-t))},isoWeek:function(n){var t=d(this,1,4).week;return null==n?t:this.add("d",7*(n-t))},weekday:function(n){var t=(this.day()+7-this.lang()._week.dow)%7;return null==n?t:this.add("d",n-t)},isoWeekday:function(n){return null==n?this.day()||7:this.day(this.day()%7?n:n-7)},get:function(n){return n=h(n),this[n]()},set:function(n,t){return n=h(n),"function"==typeof this[n]&&this[n](t),this},lang:function(t){return t===n?this._lang:(this._lang=f(t),this)}}),r=0;r<wt.length;r++)ai(wt[r].toLowerCase().replace(/s$/,""),wt[r]);ai("year","FullYear");t.fn.days=t.fn.day;t.fn.months=t.fn.month;t.fn.weeks=t.fn.week;t.fn.isoWeeks=t.fn.isoWeek;t.fn.toJSON=t.fn.toISOString;s(t.duration.fn=it.prototype,{_bubble:function(){var t,i,r,e,o=this._milliseconds,u=this._days,f=this._months,n=this._data;n.milliseconds=o%1e3;t=a(o/1e3);n.seconds=t%60;i=a(t/60);n.minutes=i%60;r=a(i/60);n.hours=r%24;u+=a(r/24);n.days=u%30;f+=a(u/30);n.months=f%12;e=a(f/12);n.years=e},weeks:function(){return a(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*i(this._months/12)},humanize:function(n){var i=+this,t=gr(i,!n,this.lang());return n&&(t=this.lang().pastFuture(i,t)),this.lang().postformat(t)},add:function(n,i){var r=t.duration(n,i);return this._milliseconds+=r._milliseconds,this._days+=r._days,this._months+=r._months,this._bubble(),this},subtract:function(n,i){var r=t.duration(n,i);return this._milliseconds-=r._milliseconds,this._days-=r._days,this._months-=r._months,this._bubble(),this},get:function(n){return n=h(n),this[n.toLowerCase()+"s"]()},as:function(n){return n=h(n),this["as"+n.charAt(0).toUpperCase()+n.slice(1)+"s"]()},lang:t.fn.lang,toIsoString:function(){var r=Math.abs(this.years()),u=Math.abs(this.months()),f=Math.abs(this.days()),n=Math.abs(this.hours()),t=Math.abs(this.minutes()),i=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(r?r+"Y":"")+(u?u+"M":"")+(f?f+"D":"")+(n||t||i?"T":"")+(n?n+"H":"")+(t?t+"M":"")+(i?i+"S":""):"P0D"}});for(r in bt)bt.hasOwnProperty(r)&&(vi(r,bt[r]),nu(r.toLowerCase()));vi("Weeks",6048e5);t.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()};t.lang("en",{ordinal:function(n){var t=n%10,r=1===i(n%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return n+r}});yi?(module.exports=t,lt(!0)):"function"==typeof define&&define.amd?define("moment",function(i,r,u){return u.config&&u.config()&&u.config().noGlobal!==!0&&lt(u.config().noGlobal===n),t}):lt()}).call(this);Foundry=Foundry||{};Foundry.filtering=Foundry.filtering||{},function(n,t){function u(n){return n.replace(/^\s+|\s+$/g,"")}function i(n){return n!==null?String(n).split(","):[]}function k(n){return function(t){return t[n]}}function r(n,i){var u=i[n],r;return u===t?(r=s[n],r?r(i):t):u}function h(n,t){var i,e,u,r,f;if(!t)return n;if(e=t[0],u=t.length>1?t.slice(1,t.length):null,Array.isArray(n))i=n.groupBy(e);else{i=n;for(r in i)i.hasOwnProperty(r)&&(f=i[r],Array.isArray(f)&&(i[r]=h(f,t)));return i}return u?h(i,u):i}function l(n,i){var r=i===t?1:i,u=e[n]?e[n]:function(t){return t[n]};return n===t||n===null?function(){return 0}:function(n,t){var i=u(n),f=u(t);if(typeof i=="number"&&typeof f=="number")return r*(i-f);if(moment&&moment.isMoment(i)&&moment.isMoment(f))return r*i.diff(f);var e=i||"",o=f||"";return r*(e<o?-1:e>o?1:0)}}function a(n,i){if(n===null||n.length===0)return t;if(Array.isArray(n)){var r=n[0],u=n.length>1?n.slice(1,n.length):null;return function(n,t){var e=r.dir||i,o=r.field||r,f=l(o,e)(n,t);return f===0&&u!==null?a(u,i)(n,t):f}}return l(n,i)}function v(n,i,u){return function(f){var e=r(n,f);return e===t?!1:i<=e&&e<=u}}function d(n,t,i){return y([n,t],i)}function g(n,f){var e=Array.isArray(n)?n:i(n).map(u),o=i(f).map(u);return function(n){var u=e.filter(function(u){var f=r(u,n),e,s;return f===t?!1:(e=Array.isArray(f)?f:i(f),s=e.matchAnyItem(o),s)});return u.length>0}}function y(n,f){var e=Array.isArray(n)?n:i(n).map(u),o=i(f).map(u);return function(n){var u=e.filter(function(u){var f=r(u,n),e,s;return f===t?!1:(e=Array.isArray(f)?f:i(f),s=e.containsAnyItem(o),s)});return u.length>0}}function nt(n,t){return n?t?function(i,r,u){return n(i,r,u)&&t(i,r,u)}:function(t,i,r){return n(t,i,r)}:function(n,i,r){return t(n,i,r)}}function c(n,f){var e=i(f).map(u);return function(u){var f=r(n,u),o;return f===t?!1:(o=Array.isArray(f)?f:i(f),o.matchAnyItem(e))}}function tt(n,i){return function(u){var f=r(n,u);return f===t?!1:f.contains(i)}}function p(n,t){var r=i(t).map(u);return r.length>1?c(n,t):tt(n,t)}function it(n){var i,r,u;if(n===t||!Array.isArray(n)||n.length===0)return t;for(i=n[0],r=1;r<n.length;r++)u=n[r],i=nt(i,u);return i}function rt(n){return function(){return!n.apply(this,arguments)}}function w(n){return n===t||n.length===0?t:it(n.map(function(n){var l;if(n){var r=n.name,u=n.value,s=u.indexOf(":")>-1,a=n.negate,h=n.bracketStart,t;if(o[r])t=o[r](u);else if(h==="["&&s){var i=u.split(":"),f=i[0]===""||i[0]==="*"?-1e6:parseInt(i[0]),e=i[1]===""||i[1]==="*"?1e6:parseInt(i[1]);f>e&&(l=e,e=f,f=l);t=v(r,f,e)}else h!=="["||s?h!=="("||s||(t=p(r,u)):t=c(r,u);return a&&(t=rt(t)),t}}))}function b(n){if(n===t||n.length===0)return t;return a(n.map(function(n){var t=n.value,i=t.substring(1,t.length-1);return{field:n.name,dir:i.contains("A")||i.contains("a")?1:-1}}))}var s,f,e,o;return String.prototype.matches||(String.prototype.matches=function(n){return n?this.toLocaleLowerCase()===n.toLocaleLowerCase():n===this}),String.prototype.contains||(String.prototype.contains=function(n){return this.toLocaleLowerCase().indexOf(n.toLocaleLowerCase())!==-1}),Number.prototype.matches||(Number.prototype.matches=function(n){return this.valueOf()==new Number(n).valueOf()}),Number.prototype.contains||(Number.prototype.contains=function(n){return this.valueOf()==new Number(n).valueOf()}),Boolean.prototype.matches||(Boolean.prototype.matches=function(n){return this.valueOf()==new Boolean(n).valueOf()}),Boolean.prototype.contains||(Boolean.prototype.contains=function(n){return this.valueOf()==new Boolean(n).valueOf()}),Array.prototype.matchAnyItem||(Array.prototype.matchAnyItem=function(n){for(var u,i,r,t=0;t<n.length;t++)for(u=n[t].trim(),i=0;i<this.length;i++)if(r=this[i].trim(),r.length>0&&r.matches(u))return!0}),Array.prototype.anyMatch||(Array.prototype.anyMatch=function(n){var t=n.split(",");return this.matchAnyItem(t)}),Array.prototype.containsAnyItem||(Array.prototype.containsAnyItem=function(n){for(var u,i,r,t=0;t<n.length;t++)for(u=n[t].trim(),i=0;i<this.length;i++)if(r=this[i].trim(),r.length>0&&r.contains(u))return!0}),Array.prototype.containsMatch||(Array.prototype.containsMatch=function(n){var t=n.split(",");return this.containsAnyItem(t)}),Array.prototype.trimString||(Array.prototype.trimString=function(){var n=String.split(",");return this.matchAnyItem(n)}),Array.prototype.groupBy||(Array.prototype.groupBy=function(n,t){for(var r,u,i=t?t:{},f=0;f<this.length;f++)r=this[f],u=n(r),i[u]?i[u].push(r):i[u]=[r];return i}),s={},n.registerProperty=function(n,t){s[n]=t},f={},n.registerGroup=function(n,t){f[n]=t},e={},n.registerSort=function(n,t){e[n]=t},o={},n.registerFilter=function(n,t){o[n]=t},n.makeFilter=function(n){if(!n)return t;var i=n.split(";").filter(function(n){return n}),r=i.map(function(n){var t=n.trim().match(/^(.+?)(\!?)([\[(])(.*)([\])])$/);return t?{name:t[1].trim(),negate:t[2]?!0:!1,bracketStart:t[3],value:t[4].trim(),bracketEnd:t[5]}:""});return w(r)},n.makeSort=function(n){if(!n)return t;var i=n.split(";").filter(function(n){return n}),r=i.map(function(n){var t=n.split("(");return t.length===2?{name:t[0].trim(),value:"("+t[1].trim()}:""});return b(r)},n.applyFilter=function(t,i){var r=n.makeFilter(i);return i?t.filter(r):t},n.applySort=function(t,i){var r=n.makeSort(i);return i?t.sort(r):t},n.applyFilterAndSort=function(t,i,r){var u=n.applyFilter(t,i);return n.applySort(u,r)},n.makeGrouper=function(n){if(!n)return t;var i=n.split(";").filter(function(n){return n});return i.map(function(n){return f[n]?f[n]:k(n)})},n.applyGrouping=function(i,r){var u=fo.utils.isaCollection(i)?i.elements:i,f=n.makeGrouper(r);return r?h(u,f):t},n.applyMapping=function(t,i){var e=fo.utils.isaCollection(t)?t.elements:t,r=n.applyGrouping(e,i),u={};for(var f in r)u[f]=r[f][0];return u},n.identifyUniqueKeyFields=function(t){if(fo.utils.isArray(t)&&t[0]){var i={},r=Object.keys(t[0]),u=t.length;return r.forEach(function(r){var f=n.applyGrouping(t,r),e=Object.keys(f).length;u==e&&(i[r]=f)}),i}},n.applyFilterSortAndGrouping=function(t,i,r,u){var f=n.applyFilterAndSort(t,i,r);return n.applyGrouping(f,u)},n.multiSelect=c,n.typeIn=p,n.eitherOr=d,n.ifAnyContains=y,n.ifAnyMatches=g,n.inRange=v,n.createFilterFunction=w,n.createSortFunction=b,n}(Foundry.filtering);Foundry=Foundry||{};Foundry.convert=Foundry.convert||{},function(n){function t(n,t){var u,f;t=t||",";for(var e=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),r=[[]],i=null;i=e.exec(n);)u=i[1],u.length&&u!=t&&r.push([]),f=i[2]?i[2].replace(new RegExp('""',"g"),'"'):i[3],r[r.length-1].push(f);return r}function i(n){for(var r,e,o,s,u=t(n),f=[],i=1;i<u.length;i++)for(f[i-1]={},r=0;r<u[0].length&&r<u[i].length;r++)e=u[0][r],f[i-1][e]=u[i][r];return o=JSON.stringify(f),s=o.replace(/},/g,"},\r\n"),s}function r(n){var i=typeof n!="object"?JSON.parse(n):n,e="",t="",o,u,f,r;if($("#labels").is(":checked")){if(o=i[0],$("#quote").is(":checked"))for(r in i[0])f=r+"",t+='"'+f.replace(/"/g,'""')+'",';else for(r in i[0])t+=r+",";t=t.slice(0,-1);e+=t+"\r\n"}for(u=0;u<i.length;u++){if(t="",$("#quote").is(":checked"))for(r in i[u])f=i[u][r]+"",t+='"'+f.replace(/"/g,'""')+'",';else for(r in i[u])t+=i[u][r]+",";t=t.slice(0,-1);e+=t+"\r\n"}return e}n.csvToJson=i;n.jsonToCsv=r}(Foundry.convert);Foundry=Foundry||{};Foundry.canvas=Foundry.canvas||{};Foundry.cv=Foundry.canvas;createjs?(Foundry.createjs=createjs,Foundry.createjs.createShape=function(){return new createjs.Shape},Foundry.createjs.createContainer=function(){return new createjs.Container},Foundry.createjs.createText=function(n,t,i){return new createjs.Text(n,t,i)},Foundry.createjs.createBitmap=function(n){return new createjs.Bitmap(n)},Foundry.createjs.createStage=function(n,t){return new createjs.Stage(n,t)},createjs.Text&&createjs.Text.prototype&&(canonicalizeNewlines=function(n){return n.replace(/(\r\n|\r|\n)/g,"\n")},createjs.Text.prototype.splitLine=function(n,t){for(var f="",i=canonicalizeNewlines(n);i[0]=="\n";)i=i.substring(1);while(i.length>t){var u=i.substring(0,t),r=u.lastIndexOf(" "),e=u.lastIndexOf("\n");e!=-1&&(r=e);r==-1&&(r=t);f+=u.substring(0,r)+"\n";i=i.substring(r+1)}return f+i},createjs.Text.prototype.flowText=function(n,t,i){var r,u;if(n){if(r=n?this.splitLine(n,t):n,u=r.split("\n"),!i||u.length<=i)return this.text=r,r;var f=i-1,o=u.splice(0,f-1),e=o.join("\n")+" "+u[f]+" ...";return this.text=e,e}})):Foundry.createjs={createShape:function(){return},createContainer:function(){return},createText:function(){return},createBitmap:function(){return},createStage:function(){return},Tween:undefined,Touch:undefined,Ticker:undefined},function(n,t,i){var f=i.Tween,u=t.utils,r;n.updateShapeForLayout=function(){};r=function(n,r,f){var e={isVisible:!0,context:function(){if(this.contextType)return t.newInstance(this.contextType)},geom:function(){return i.createShape()},update:function(){return this.geom?(this.geom.graphics.clear(),!1):!1}};return this.base=t.Component,this.base(u.union(e,n),r,f),this.myType=n&&n.myType||"FoundryShape",this};r.prototype=function(){var n=function(){this.constructor=r};return n.prototype=t.Component.prototype,new n}();n.FoundryShape=r;u.isaFoundryShape=function(n){return n instanceof r?!0:!1};r.prototype.render=function(n,t){var r=this.getProperty("geom"),i;r&&this.update&&(i=r.getValue(),n&&n.addChild&&n.addChild(i),this.Subcomponents.forEach(function(r){r.render(i||n,t)}))};r.prototype.updateStage=function(){return this.myParent&&this.render(this.myParent.geom),this};r.prototype.isPage=function(){return this==this.rootPage()};r.prototype.outlineRef=function(){return""};r.prototype.isInGroup=function(){return this.myParent!==this.rootPage()};r.prototype.isShapeHit=function(n,t,i,r,u){var e=this.geom,s,h,c,o,f,l;if(!e)return e;if((s=e.localToGlobal(0,0),n<s.x)||(h=e.localToGlobal(i,r),n>h.x))return!1;if(t>=s.y&&t<=h.y)return this;for(c=this.Subcomponents.elements,o=0;o<c.length;o++)if((f=c[o],!u||!f.isSelected)&&(l=f.isShapeHit(n,t,f.width,f.height,u),l))return l};r.prototype.subcomponentHitTest=function(n,t,i){for(var r,f,e=this.Subcomponents.elements,o=e.length-1,u=o;u>=0;u--)if((r=e[u],!i||!r.isSelected)&&(f=r.isShapeHit(n,t,r.width,r.height,i),f))return f};r.prototype.glueRemoveFromModel=function(){this.Connections&&this.Connections.map(function(n){var t=n.target;t.removeFromModel()})};r.prototype.glueTo=function(n){var i=this.establishCollection("Connections",[]),t=i.firstWhere(function(t){return t.target==n});return t||(t={source:this,target:n},i.push(t)),t};r.prototype.unglueTo=function(n,t){var i,r;return(t&&this.Subcomponents.map(function(r){i=r.unglueTo(n,t)}),r=this.Connections,!r)?i:(i=r.firstWhere(function(t){return t.target==n}),i&&r.remove(i),i)};r.prototype.glueShapeMoved=function(n,t,i,r,u,f){(this.Connections&&this.Connections.map(function(f){var e=f.target;e.glueShapeMoved(n,t,i,r,u)}),f)&&this.Subcomponents.map(function(n){n.glueShapeMoved(n,t,i+u,n.width,n.height,f)})}}(Foundry.canvas,Foundry,Foundry.createjs),function(n,t,i){var f=i.Tween,u=t.utils,r=function(t,i,r){var f={pinX:0,pinY:0,angle:0,isSelected:!1,isEditing:!1,isActiveTarget:!1,canGroupItems:function(){return!0},canBeGrouped:function(){return!0},showSubcomponents:!0,showDetails:!0};return this.base=n.FoundryShape,this.base(u.union(f,t),i,r),this.myType=t&&t.myType||"Shape",this};r.prototype=function(){var t=function(){this.constructor=r};return t.prototype=n.FoundryShape.prototype,new t}();n.Shape=r;u.isaShape=function(n){return n instanceof r?!0:!1};n.makeShape=function(n,t,i){return new r(n,t,i)};r.prototype.setVisualState=function(){};r.prototype.angleInRads=function(){return Math.PI/180*this.angle};r.prototype.rootPage=function(){if(this.myParent)return this.myParent.rootPage&&this.myParent.rootPage()};r.prototype.outlineRef=function(){var r=this.componentDepth(),n,t,i;return r==0||!this.myParent?"":(n=(this.myIndex()+1).toString(),this.myParent.componentDepth()==0)?n:(t=this.myParent.outlineRef(),i=t?t+"."+n:n,i)};r.prototype.defaultPinX=function(){var n=this.rootPage();return n.defaultPinX()};r.prototype.defaultPinY=function(){var n=this.rootPage();return n.defaultPinY()};r.prototype.setDefaultDropLocation=function(){this.isInGroup()==!1&&(this.pinX=this.defaultPinX(),this.pinY=this.defaultPinY())};r.prototype.hasGroupMembers=function(){return this.Subcomponents.isNotEmpty()};r.prototype.hasDetails=function(){return this.context&&this.context.isTextDifferent};r.prototype.currentToggleSubcomponentsState=function(){return this.hasGroupMembers()?this.showSubcomponents?"minus":"plus":"none"};r.prototype.toggleShowSubcomponents=function(){return this.showSubcomponents=!this.showSubcomponents,this.showSubcomponents};r.prototype.currentToggleDetailsState=function(){return this.hasDetails()?this.showDetails?"close":"open":"none"};r.prototype.toggleShowDetails=function(){return this.showDetails=!this.showDetails,this.showDetails};r.prototype.MorphGeomTo=function(n,t,i,r){var u=this.geom;return this.MorphTo(u,n,t,i,r)};r.prototype.MorphTo=function(n,t,i,r,u){var f=this.rootPage();f?f.MorphTo(n,t,i,r,u):u&&u()};r.prototype.repositionTo=function(n,t,r,u){var f=this;this.MorphGeomTo({x:n,y:t},500,i.Ease.sineInOut,function(){f.pinX=n;f.pinY=t;f.angle=r?r:0;f.glueShapeMoved(f,n,t,f.width,f.height,!0);u&&u()})}}(Foundry.canvas,Foundry,Foundry.createjs),function(n,t){n.establishType&&n.establishType("Shape",{},t.makeShape)}(Foundry,Foundry.canvas);Foundry=Foundry||{};Foundry.canvas=Foundry.canvas||{},function(n,t,i){var u=t.utils,f,r;t.digestLockCount=0;t.globalDigestLock=function(n){return t.digestLockCount=t.digestLockCount+n,t.digestLockCount==0,t.digestLockCount};f={};r=n.FoundryShape.prototype;r.doRepaint=function(){var n=this._update;n.smash();this.updateStage()};r.doUpdate=function(n){var r=this._update,u=r.getID();t.digestLock(i,function(){r.smash();f[u]=r;n&&n()});t.digestLockCount==0&&(this.updateStage(),t.publish("refreshPanZoom",[]))};r.capture=function(n,i,r){var u=this.captureSubcomponent(n,i,r);return t.digestLockCount==0&&(n.updateStage(),t.publish("refreshPanZoom",[])),u};r.tracePropertyLifecycle=function(n,t){var i=this.getProperty(n,t),r=this};r.fxMod=function(n){this.myParent&&!u.isaDrawing(this.myParent)&&(u.isa2DCanvas(this.myParent)?this.smashProperties(["height","width","update"]):this.smashProperties(["height","width","pinX","pinY","update"]),n&&this.smashProperties(n))};r.markForUpdate=function(){var n=this._update,t=n.getID();f[t]||(f[t]=n);this.fxMod()};r.forceLayout=function(){var t=this;t&&t.applyToSelfAndChildren&&(t.applyToSelfAndChildren(function(){this.fxMod&&this.fxMod()},!0),t.applyToSelfAndChildren(n.updateShapeForLayout,!0));t.render()};r.unParentGeom=function(n){var r=this,i=r.getProperty("geom"),t;if(i&&i.isValueKnown()&&(t=n.getProperty("geom"),t&&t.isValueKnown()))return i.getValue().removeChild(t.getValue()),!0};r.reParentGeom=function(n){var r=this,i=r.getProperty("geom"),t;if(i&&i.isValueKnown()&&(t=n.getProperty("geom"),t&&t.isValueKnown()))return i.getValue().addChild(t.getValue()),!0};r.captureSubcomponent=function(n,i,r){var f=this,e=n.myParent;return i&&(n.myName=i),f.canCaptureSubcomponent(n)?(t.digestLock(f,function(){e&&u.isa2DCanvas(e)?(e.removeSubcomponent(n),e.unParentGeom(n),r&&delete e[i],n.fxMod()):e&&(e.removeSubcomponent(n),e.unParentGeom(n),r&&delete e[i],e.markForUpdate(),n.fxMod());f&&u.isa2DCanvas(f)?(f.addSubcomponent(n),f.reParentGeom(n),r&&(f[i]=component)):f&&(f.addSubcomponent(n),f.reParentGeom(n),r&&(f[i]=component),n.fxMod(),f.markForUpdate());n.markForUpdate()}),e):void 0};r.captureInsertSubcomponent=function(n,i,r){var f=this,e=i.myParent;return r&&(i.myName=r),f.canCaptureSubcomponent(i)?(t.digestLock(f,function(){e&&u.isa2DCanvas(e)?(e.removeSubcomponent(i),e.unParentGeom(i),i.fxMod()):e&&(e.removeSubcomponent(i),e.unParentGeom(i),e.markForUpdate(),i.fxMod());f&&u.isa2DCanvas(f)?(f.insertSubcomponent(n,i),f.reParentGeom(i)):f&&(f.insertSubcomponent(n,i),f.reParentGeom(i),i.fxMod(),f.markForUpdate())}),e):void 0};t.globalDigestRefresh=function(n,i){var e=t.globalDigestLock(0),r;e||(r=u.getOwnPropertyValues(f),r.length>0&&(f={},r.forEach(function(n){if(!n.isValueKnown())var t=n.owner,i=n.getValue()}),i&&i()))};t.digestLock=function(n,i,r){var e=t.globalDigestLock(1),u=i(),f=t.globalDigestLock(-1);return f==0&&(n&&n.forceLayout&&n.forceLayout(),t.globalDigestRefresh(n),r&&r()),u}}(Foundry.canvas,Foundry);Foundry=Foundry||{};Foundry.canvas=Foundry.canvas||{},function(n,t,i,r){var o=i.Tween,f=t.utils,u=function(u,e,o){var h=u&&u.canvasElement||document.getElementById("myCanvas")||document.createElement("canvas"),s={canvas:function(){return h},stage:function(){var n=i.createStage(this.canvas,!0);if(n)return i.Touch&&i.Touch.enable(n),n&&(n.mouseMoveOutside=!1),n},geom:function(){return this.stage},update:function(){return this.geom?!0:!1},scale:1,panX:0,panY:0,rotation:0,headerText:function(){return this.myName},canvasWidth:function(){return this.canvas?this.canvas.width:0},canvasHeight:function(){return this.canvas?this.canvas.height:0},pixelsPerInch:150,drawingWidth:function(){return 16*this.pixelsPerInch},drawingHeight:function(){return 9*this.pixelsPerInch},drawingMargin:function(){return.25*this.pixelsPerInch},surfaceWidth:function(){return this.drawingWidth+2*this.drawingMargin},surfaceHeight:function(){return this.drawingHeight+2*this.drawingMargin},showBackground:!0,background:function(){var n=i.createShape(),t;return n&&(t=n.graphics,t.beginFill("gray").drawRect(this.drawingMargin,this.drawingMargin,this.drawingWidth,this.drawingHeight).endFill()),n},canDoWheelZoom:!0,showGrid:!1,gridX:function(){return 1*this.pixelsPerInch},gridY:function(){return.5*this.pixelsPerInch},grid:function(){var n=i.createShape();return n&&this.gridGeom(this.drawingWidth,this.drawingHeight,this.drawingMargin,this.gridX,this.gridY,n,!0),n}};return s=f.mixin(s,{draggable:!0,selectionSet:function(){return t.makeCollection()},dropTargetSet:function(){return t.makeCollection()}}),this.base=n.FoundryShape,this.base(f.union(s,u),e,o),this.myType=u&&u.myType||"Page",this.canvas&&this.stage&&this.draggable&&(this.setupDragAndDrop(!0),this.setupScaleBindings()),this.doAnimations=!0,this.PIP=r,this._defaultPinX=100,this._defaultPinY=100,this._defaultPinXDelta=0,this._defaultPinYDelta=0,this.resetDropDelta(),this._pasteAreaPinX=0,this._pasteAreaPinY=0,this._pasteAreaGap=10,this.resetPasteArea(),this},e;u.prototype=function(){var t=function(){this.constructor=u};return t.prototype=n.FoundryShape.prototype,new t}();n.Page2DCanvas=u;f.isa2DCanvas=function(n){return n instanceof u?!0:!1};f.isaPage=function(n){return n instanceof u?!0:!1};n.makePage=function(n,t,i){var r=new u(n,t,i);return r.myName||(r.myName=r.myType||"Page"),r};n.makePage2D=function(i,r,u){var e=t.utils.isString(i)?document.getElementById(i):i,f=r||{};return f.canvasElement=e,n.makePage(f,{},u)};u.prototype.clearStage=function(){this.stage.removeAllChildren()};u.prototype.rePaint=function(){this.stage&&this.stage.update()};u.prototype.render=function(n,i){var r=n?n:this.stage;this.showBackground&&this.establishChild(this.background);this.showGrid&&this.establishChild(this.grid);this.Subcomponents.forEach(function(n){n.render(r||this.geom,i)});t.publish("refreshPanZoom",[])};u.prototype.updateStage=function(n){var t=this,i=e;return e&&t.setAnimationsOn(!1),n&&(t.clearStage(),t.selectShape(r,!0)),t.render(t.geom,t.context),this.rePaint(),t.setAnimationsOn(i),t};e=!1;u.prototype.setAnimationsOn=function(n){var r=this,t=r.geom;i.Ticker&&(n?(i.Ticker.useRAF=!0,i.Ticker.setFPS(30),i.Ticker.addEventListener("tick",t)):i.Ticker.removeEventListener("tick",t),e=n)};u.prototype.resetPasteArea=function(n){return this._pasteAreaPinX=this.drawingMargin,this._pasteAreaPinY=this.drawingMargin,this._pasteAreaGap=n?n:10,this._pasteAreaGap};u.prototype.showPasteArea=function(n){var t=this,r=t.surfaceWidth,u=t.surfaceHeight,i=Math.min(t.canvasWidth/r,t.canvasHeight/u),f=(t.canvasWidth-i*r)/2,e=(t.canvasHeight-i*u)/2;return t.transformTo(i,f+100,e,200,function(){n&&n()}),this};u.prototype.moveToPasteArea=function(n){var i=this,e=i._pasteAreaPinX-n.width/2-i._pasteAreaGap,u=i._pasteAreaPinY+i._pasteAreaGap,f;n.setXY(e,u);f=1;i._pasteAreaPinY=u+n.height*f;t.publish("ShapeMoved",[n.myName,r,n]);setTimeout(function(){i.introduceShape(n)},300)};u.prototype.resetDropDelta=function(){this._defaultPinXDelta=this._defaultPinYDelta=0;this._defaultPinX=1.5*this.drawingMargin-this.panX/this.scale;this._defaultPinY=1.5*this.drawingMargin-this.panY/this.scale;this.resetPasteArea()};u.prototype.overrideDefaultPinXPinY=function(n,t){this._defaultPinX=n;this._defaultPinY=t;this._defaultPinXDelta=this._defaultPinYDelta=0};u.prototype.defaultPinX=function(){return this._defaultPinX+this.defaultPinXDelta()};u.prototype.defaultPinY=function(){return this._defaultPinY+this.defaultPinYDelta()};u.prototype.defaultXY=function(){return[this.defaultPinX(),this.defaultPinY()]};u.prototype.defaultPinXDelta=function(){return this._defaultPinXDelta>200&&(this._defaultPinXDelta=0),this._defaultPinXDelta=this._defaultPinXDelta+20,this._defaultPinXDelta};u.prototype.defaultPinYDelta=function(){return this._defaultPinYDelta>200&&(this._defaultPinYDelta=0),this._defaultPinYDelta=this._defaultPinYDelta+20,this._defaultPinYDelta};u.prototype.rootPage=function(){return this};u.prototype.isPage=function(){return!0};u.prototype.setCanvasWidth=function(n){this.canvas&&this.canvas.width!=n&&(this.canvas.width=n,this.smashProperty("canvasWidth"))};u.prototype.setCanvasHeight=function(n){this.canvas&&this.canvas.height!=n&&(this.canvas.height=n,this.smashProperty("canvasHeight"))};u.prototype.establishChild=function(n,t){var i=this.stage;return i.getChildIndex(n)==-1&&(i.addChild(n),t!=r&&i.setChildIndex(n,t)),n};u.prototype.setupScaleBindings=function(){var n=this;n.addBinding("scale",function(n,t){var r=n.getValue(),i=t.stage;i.scaleX=i.scaleY=r});n.addBinding("panX",function(n,t){var r=n.getValue(),i;t.resetDropDelta();i=t.stage;i.x=r});n.addBinding("panY",function(n,t){var r=n.getValue(),i;t.resetDropDelta();i=t.stage;i.y=r})};u.prototype.updatePIP=function(){};u.prototype.setPIP=function(n){this.PIP=n;var i=this;u.prototype.updatePIP=function(){i.PIP&&t.publish("refreshPanZoom",[i.PIP,i])};i.updatePIP()};u.prototype.setPIPSize=function(n,i,r){var u=this;this.canvas&&u.PIP&&t.publish("sizePanZoom",[u.PIP,u,n,i,r])};u.prototype.setPIPPosition=function(n,i,r){var u=this;this.canvas&&u.PIP&&t.publish("positionPanZoom",[u.PIP,u,n,i,r])};u.prototype.introduceShape=function(n,r){var u=n.geom;r&&r();u.scaleX=u.scaleY=0;u.rotation=-45;u.visible=!0;n.MorphTo(u,{scaleY:1,scaleX:1,rotation:0},200,i.Ease.linear,function(){u.scaleY=u.scaleX=1;u.rotation=0;t.publish("refreshPanZoom",[])})};u.prototype.farewellShape=function(n,u){this.selectShape(r,!0);var f=n.geom;n.MorphTo(f,{scaleY:0,scaleX:0,rotation:45},200,i.Ease.linear,function(){f.visible=!1;u&&u();t.publish("refreshPanZoom",[])})};u.prototype.MorphTo=function(n,t,i,r,u){if(this.doAnimations&&n){var f=o.get(n).to(t,i,r);f.call(function(){u&&u()})}else u&&u()};u.prototype.DrawDot=function(n,t,r,u){var f=i.createShape(),e,o;f&&(e=r?r:"#F00",o=u?u:6,f.setTransform(n,t).graphics.beginFill(e).drawCircle(0,0,o).endFill(),this.stage.addChild(f))};u.prototype.gridGeom=function(n,t,i,r,u,f,e){var o=f.graphics,s,h;e&&o.clear();o.beginStroke("#000");var c=i,l=i,a=i+n,v=i+t;for(o.drawRect(c,l,n,t),s=c;s<a;)o.moveTo(s,l),o.lineTo(s,v),s+=r;for(h=l;h<v;)o.moveTo(c,h),o.lineTo(a,h),h+=u;return o}}(Foundry.canvas,Foundry,Foundry.createjs),function(n,t,i,r){function s(n){u=n.ctrlKey;f=n.altKey;e=n.shiftKey}function h(){u=!1;f=!1;e=!1}var o=i.Tween,c=t.utils;Page2DCanvas=n.Page2DCanvas;var u=!1,f=!1,e=!1;window.addEventListener("keydown",s,!0);window.addEventListener("keyup",h,!0);Page2DCanvas.prototype.zoomBy=function(n){var t=this;return t.scale*=n,this};Page2DCanvas.prototype.setZoomTo=function(n){var t=this,i=n/t.scale;return t.zoomBy(i),this};Page2DCanvas.prototype.setPanTo=function(n,t){var i=this;return i.panX=n,i.panY=t,this};Page2DCanvas.prototype.panBy=function(n,t){var i=this;return i.panX+=n,i.panY+=t,this};Page2DCanvas.prototype.transformTo=function(n,t,r,u,f){var e=this,s=e.stage,h=u?u:0,c=o.get(s).to({x:t,y:r,scaleX:n,scaleY:n},h,i.Ease.linear);return c.call(function(){e.setPanTo(t,r);e.setZoomTo(n);f&&f()}),this};Page2DCanvas.prototype.zoomToFit=function(n){var t=this,f=0,e=0,i=t.surfaceWidth,r=t.surfaceHeight;t.Subcomponents.forEach(function(n){var t,u;f=Math.min(f,n.pinX);e=Math.min(e,n.pinY);t=n.width?n.width:0;i=Math.max(i,n.pinX+t);u=n.height?n.height:0;r=Math.max(r,n.pinY+u)});var u=Math.min(t.canvasWidth/i,t.canvasHeight/r),o=(t.canvasWidth-u*i)/2,s=(t.canvasHeight-u*r)/2;return t.transformTo(u,o,s,500,function(){t.updatePIP();n&&n()}),this};Page2DCanvas.prototype.zoom1To1=function(n){var t=this;return t.transformTo(1,0,0,500,function(){t.updatePIP();n&&n()}),this};Page2DCanvas.prototype.selectShapeHitTest=function(n,t){for(var i,f,u=this.selectionSet.elements,r=0;r<u.length;r++)if((i=u[r],i.myParent==this)&&(f=i.isShapeHit(n,t,i.width,i.height),f==i))return i};Page2DCanvas.prototype.clear=function(){this.selectShape(r,!0);this.removeAllSubcomponents()};Page2DCanvas.prototype.selectShape=function(n,i){var u=this.selectionSet,f,e,o;if(n&&n.isSelected){t.publish("ShapeSelected",[this,n,u]);return}if(!n&&u.count==0){t.publish("ShapeSelected",[this,n,u]);return}f=u.first();i&&(u.forEach(function(n){n.isSelected=n.isEditing=!1;n.setVisualState("isSelected")}),u.clear(),this.selectDropTarget(r,!0));n&&(f=r,n.isSelected=!0,u.count==0&&u.push(n),n.setVisualState("isSelected"),e=this.geom,o=e.children.length-1,e.setChildIndex(n.geom,o));t.publish("ShapeSelected",[this,n?n:f,u])};Page2DCanvas.prototype.selectedShape=function(){var n=this.selectionSet;return n.count>0?n.last():r};Page2DCanvas.prototype.selectedContext=function(){var n=this.selectedShape();return n?n.context:r};Page2DCanvas.prototype.selectDropTarget=function(n,t){var i=this.dropTargetSet;n&&n.isActiveTarget||(t&&(i.forEach(function(n){n.isActiveTarget=!1;n.setVisualState("isActiveTarget")}),i.clear()),n&&(n.isActiveTarget=!0,n.setVisualState("isActiveTarget"),i.count==0&&i.push(n)))};Page2DCanvas.prototype.selectedDropTarget=function(){var n=this.dropTargetSet;return n.count>0?n.last():r};Page2DCanvas.prototype.shapeDropped=function(n,i,r){var e=r.stageX,o=r.stageY,s=this,h={pinX:n.pinX,pinY:n.pinY,index:n.myIndex()},u=s.subcomponentHitTest(e,o,!0),f;u&&(f=u.capture(n),t.publish("ShapeReparented",[n,f,n.myParent,h]))};Page2DCanvas.prototype.shapePulled=function(n,i,u,f){var h=f?f.stageX:0,c=f?f.stageY:0,e=this,o=(h-e.panX)/e.scale-u.x,s=(c-e.panY)/e.scale-u.y,l={pinX:o,pinY:s,index:n.myIndex()},a=e.capture(n);t.publish("ShapeReparented",[n,a,n.myParent,l]);n.setXY(o,s);t.publish("ShapeMoved",[n.myName,r,n]);n.doUpdate()};Page2DCanvas.prototype.setupDragAndDrop=function(){function ut(n,t){var i={x1:Math.min(n.x,t.x),x2:Math.max(n.x,t.x),y1:Math.min(n.y,t.y),y2:Math.max(n.y,t.y)};return i.width=i.x2-i.x1,i.height=i.y2-i.y1,i.area=i.width*i.height,i}function ft(n){var t=tt.graphics;t.clear();n&&(t.beginFill("#ff0000").drawRect(n.x1,n.y1,n.width,n.height),f.addChild(tt));f.update()}function it(t){var i=t.stageX,r=t.stageY,u=i-a.x,f=r-a.y;n.setPanTo(u,f);n.updatePIP()}function pt(t,i,r){var f=n.geom.globalToLocal(t,i),u;n.zoomBy(r);n.updatePIP();u=n.geom.localToGlobal(f.x,f.y);n.panBy(t-u.x,i-u.y);n.updatePIP()}function st(t,i,r){var f=n.geom.globalToLocal(t,i),u;n.setZoomTo(r);n.updatePIP();u=n.geom.localToGlobal(f.x,f.y);n.panBy(t-u.x,i-u.y);n.updatePIP()}function b(n){n||(n=window.event);n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}function wt(i){var l,y,c,k,nt,p,tt;if(b(i),l=i.stageX,y=i.stageY,u){a={x:l-f.x,y:y-f.y};f.addEventListener("stagemousemove",it);f.addEventListener("stagemouseup",function(){f.removeEventListener("stagemousemove",it)});return}s={x:0,y:0};o=e=r;c=n.selectShapeHitTest(l,y);c&&(p=c.geom.globalToLocal(l,y),s={x:p.x,y:p.y});k=c?r:n.subcomponentHitTest(l,y);k&&!c&&(c=k,p=c.geom.globalToLocal(l,y),s={x:p.x,y:p.y},c.myParent!=n&&(c.setVisualState("canPullFromGroup"),o=c,e=c.myParent,h=yt,nt=e.geom,p=nt.globalToLocal(l,y),vt={x:p.x,y:p.y}));n.selectShape(c,!0);n.selectDropTarget(r,!0);d=!0;v=c!==r;g=!v&&n.publishTouchBoxingEvents;g&&(w=n.geom.globalToLocal(l,y),ft(),tt=ut(w,w),t.publish("BoxingStarted",[n,tt,i]));!c&&n.allowSingleTouchPan&&(a={x:l-f.x,y:y-f.y},f.addEventListener("stagemousemove",it),f.addEventListener("stagemouseup",function(){f.removeEventListener("stagemousemove",it)}))}function bt(i){var p,k,a,it,tt,rt,c,u,y,et,l;if(d&&!at){if(b(i),p=i.stageX,k=i.stageY,o&&h>=0){if(u=o.geom,a=e.geom,h-=1,e&&h>ot)return;if(e&&h>0){it=ot-h-3;tt=2*it;o.setVisualState("canBePullFromGroup",{skewY:tt,skewX:tt},200,function(){u&&(u.skewX=u.skewY=tt)});rt=1.01+it/10;e.setVisualState("canHaveItemPulled",{scaleX:rt},200,function(){a&&(a.scaleX=rt)});return}h==0&&(h=-1,a.removeChild(u),y=n.geom.globalToLocal(p,k),u.x=y.x-s.x,u.y=y.y-s.y,f.addChild(u),n.selectShape(o,!0),n.selectDropTarget(r,!0),o.setVisualState("wasPulledFromGroup",{skewY:0,skewX:0},200,function(){u.skewY=0;u.skewX=0;e&&e.setVisualState("canHaveItemPulled",{scaleX:1},300,function(){a&&(a.scaleX=1)})}));return}if((c=n.selectedShape(),c&&v&&(u=c.geom,y=n.geom.globalToLocal(p,k),u.x=y.x-s.x,u.y=y.y-s.y,u.skewX=u.skewY=0,c.glueShapeMoved(c,u.x,u.y,c.width,c.height,!0),t.publish("ShapeMoving",[n,c,i])),g&&d&&(nt=n.geom.globalToLocal(p,k),et=ut(w,nt),ft(et),t.publish("BoxingSizing",[n,et,i])),v&&c&&!o)&&(!c||c.canBeGrouped)){if(l=n.subcomponentHitTest(p,k,!0),l=l&&l.canGroupItems?l:r,l){n.selectDropTarget(l,!0);return}n.selectDropTarget(l,!0)}}}function kt(i){var a,y,c,l,tt,u,f,it,p,et;if(b(i),a=i.stageX,y=i.stageY,d=!1,g&&(nt=n.geom.globalToLocal(a,y),c=ut(w,nt),l=r,n.Subcomponents.forEach(function(n){var t=n.geom;t.x<c.x1||t.x>c.x2||t.y<c.y1||t.y>c.y2||(l=l?l:[],l.push(n))}),ft(),t.publish("BoxingFinished",[n,c,l,i])),o&&h>0){var f=o.geom,rt=e.geom,k=0;o.setVisualState("canBePullFromGroup",{skewY:k,skewX:k},300,function(){f&&(f.skewX=f.skewY=k)});tt=1;e.setVisualState("canHaveItemPulled",{scaleX:tt},300,function(){rt&&(rt.scaleX=tt)});v=!1}u=n.selectedShape();u&&v&&(v=!1,f=u.geom,it=n.geom.globalToLocal(a,y),f.x=it.x-s.x,f.y=it.y-s.y,t.publish("ShapeMoving",[n,u,i]),p=n.subcomponentHitTest(a,y,!0),n.selectDropTarget(p,!0),o&&h==-1?n.shapePulled(o,e,s,i):e&&h>=0?e.setVisualState("canNotDropOnGroup"):p&&p.canGroupItems?n.shapeDropped(u,s,i):(u.pinX=f.x,u.pinY=f.y,u.angle=0,u.isInGroup()||(et=u.context,t.publish("ShapeMoved",[u.myName,et,u]))));n.selectDropTarget(r,!0);n.applyToChildren(function(n){n.isActiveTarget&&(n.isActiveTarget=!1);n.setVisualState&&n.setVisualState("isActiveTarget")},!0);o=r;e=r}function dt(i){var f;b(i);var e=i.stageX,o=i.stageY,r=n.selectedShape();r&&(r.setVisualState("SelectedForEdit"),f=u?"OpenNav":"OpenEdit",t.publish("doubleClick",[r,r.context,f]))}function ht(n){b(n);var t=1.1,i=Math.max(-1,Math.min(1,n.wheelDelta||-n.detail))>0?t:1/t,r=n.offsetX,u=n.offsetY;pt(r,u,i,n)}function lt(n){var i=t.utils.forEachValue(n,function(n,t){return{x:t.clientX,y:t.clientX}}),r=Math.pow(i[1].x-i[0].x,2),u=Math.pow(i[1].y-i[0].y,2);return Math.ceil(Math.sqrt(r+u))}function ni(n){var i=t.utils.forEachValue(n,function(n,t){return{x:t.clientX,y:t.clientX}});return{x:(i[1].x+i[0].x)/2,y:(i[1].y+i[0].y)/2}}var n=this,f=n.geom,c=n.canvas,ui=n.selectionSet,s={x:0,y:0},v=!1,at=!1,d=!1,g=!1,w={x:0,y:0},nt={x:0,y:0},vt={x:0,y:0},o=r,e=r,h=0,ot=10,yt=18,a,tt;n.allowSingleTouchPan=!1;n.publishTouchBoxingEvents=!1;a={x:0,y:0};tt=i.createShape();tt.alpha=.1;t.subscribe("touchZoomStageToCenter",function(n,t,i,r){st(gx,gy,i,r)});f&&f.addEventListener&&(f.addEventListener("stagemousedown",wt,!1),f.addEventListener("stagemousemove",bt,!1),f.addEventListener("stagemouseup",kt,!1),f.addEventListener("dblclick",dt,!1));c&&c.addEventListener&&this.canDoWheelZoom&&(c.addEventListener("mousewheel",ht,!1),c.addEventListener("DOMMouseScroll",ht,!1));var rt,ct=1,gt=1,y={},l=r,k={},p=r;var et=1,ti=function(t){var i=t.pointerId,e,o,s,h;if(t.pointerType=="touch"&&(l==r?y[i]=t:l[i]=t,p={},k[i]&&(p[i]=t)),l&&rt){var c=lt(l),u=c/ct,f=Math.abs(u-et);if(f<.1||f>.8)return;et=u;e=rt.x;o=rt.y;st(e,o,et,t)}p&&p[i]&&(s=p[i].clientX-a.x,h=p[i].clientY-a.y,n.setPanTo(s,h),n.updatePIP())},ii=function(n){var t=n.pointerId;n.pointerType=="touch"&&(l=r,p=r,y[t]&&delete y[t],k[t]&&delete k[t])},ri=function(t){var u=t.pointerId,e,i;if(t.pointerType=="touch"&&(k={},n.selectedShape()==r&&(k[u]=t,a={x:t.clientX-f.x,y:t.clientY-f.y}),y[u]=t,e=Object.keys(y).length,e==2)){l={};for(i in y)l[i]=y[i];rt=ni(l);ct=lt(l);gt=n.scale}};c&&c.addEventListener&&(c.addEventListener("pointerdown",ri,!1),c.addEventListener("pointermove",ti,!1),c.addEventListener("pointerup",ii,!1))}}(Foundry.canvas,Foundry,Foundry.createjs),function(n,t){n.establishType&&n.establishType("Page",{},t.makePage)}(Foundry,Foundry.canvas);Foundry=Foundry||{};Foundry.canvas=Foundry.canvas||{},function(n,t,i,r){var o=i.Tween,f=t.utils,e,u;n.colorsFill=["#FFFFFF","#FFFF99","#FFFF33","#FFCC66","#FFCC00","#CC9900","#996600","#663300"];n.standardNoteOffset=10;n.standardNoteSize=150;n.minNoteSize=50;n.updateShapeForLayout=function(t){function f(t){var i=t.groupDepth;return i>0||t.inGroup?n.minNoteSize:t.minHeight>0?t.minHeight:n.standardNoteSize}function e(t){var i=t.groupDepth,r,u;return i<=0?n.standardNoteSize:i<=1?t.minWidth+i*n.standardNoteOffset:(t.applyToChildren(n.updateShapeForLayout),r=t.Subcomponents,u=r.sumAll("width",n.standardNoteOffset),u)}t.shapeDepth=t.componentDepth();t.groupDepth=t.branchDepth();t.inGroup=t.isInGroup();t.segHeight=f(t);t.segWidth=e(t);var r=n.colorsFill.length-1,i=t.groupDepth,u=i>r?r:i;return t.fillColor=n.colorsFill[u||0],t.strokeColor=n.colorsFill[u+1],t.textColor=i>=5?"white":"black",t};e={pinX:function(){var t=n.standardNoteOffset,u=this.mySiblingsMaxValue("groupDepth",0),i,r;return this.groupDepth==0&&u==0?t:(i=this.mySiblingsBefore(),r=i.sumAll("width",t),r)},pinY:function(){var t=n.minNoteSize,i,r,u;return this.groupDepth>0?t:(i=this.mySiblingsMaxValue("groupDepth",0),this.groupDepth==0&&i>0)?t:(r=this.mySiblingsBefore(),u=r.sumAll("height",t),u)},locX:function(){return 0*this.width},locY:function(){return 0*this.height},minWidth:function(){return n.standardNoteSize},minHeight:function(){return n.minNoteSize},width:function(){this.context;var t=Math.max(this.segWidth,this.minWidth);return isNaN(t)&&(t=n.standardNoteSize),t},height:function(){this.context;var t=Math.max(this.segHeight||this.minHeight);return isNaN(t)&&(t=n.standardNoteSize),t},headerText:function(){return this.context?this.context.headerText:this.myName},headline:function(){return i.createText("","bold 12px Arial","#000000")},background:function(){return i.createShape()},selected:function(){return i.createShape()},dropTarget:function(){return i.createShape()},geom:function(){var n=i.createContainer();return n&&n.addChild(this.background,this.dropTarget,this.selected,this.headline),n},update:function(){var o=this.geom,i,r,s;if(!o||(i=this,i.myParent&&!i.myParent.update))return!1;n.updateShapeForLayout(i);var f=this.width,e=this.height,u=this.background.graphics.clear();return t.suspendDependencies(function(){var n=i.fillColor,t=i.strokeColor;u.beginFill(n).beginStroke(t).setStrokeStyle(1).drawRect(0,0,i.width,i.height).endStroke().endFill()}),u=this.selected.graphics.clear(),u.beginStroke("blue").setStrokeStyle(5).drawRect(3,3,f-6,e-6).endStroke(),u=this.dropTarget.graphics.clear(),u.beginStroke("green").setStrokeStyle(5).drawRect(2,2,f-4,e-4).endStroke(),r=this.headline,r.flowText(this.headerText,21,3),r.textAlign="center",r.textBaseline="top",r.lineWidth=f-10,r.x=f/2,s=r.getMeasuredHeight(),r.y=(e-s)/2,t.suspendDependencies(function(){o.setTransform(i.pinX,i.pinY);i.selected.alpha=i.isSelected?.5:0;i.dropTarget.alpha=i.isActiveTarget?.5:0}),!0}};u=function(i,u,o){var s,h;return this.base=n.Shape,s=i&&i.pinX,s&&!t.utils.isFunction(s)?delete i.pinX:s=r,h=i&&i.pinY,h&&!t.utils.isFunction(h)?delete i.pinY:h=r,this.base(f.union(e,i),u,o),this.myType=i&&i.myType||"Shape2D",this.setXY(s,h),this};u.prototype=function(){var t=function(){this.constructor=u};return t.prototype=n.Shape.prototype,new t}();n.Shape2D=u;f.isaShape2D=function(n){return n instanceof u?!0:!1};u.prototype.setDefaultXY=function(n){return this.setXY(n[0],n[1])};u.prototype.setXY=function(n,t){return isNaN(n)||(this.pinX=this.locX+n),isNaN(t)||(this.pinY=this.locY+t),this};n.makeShape2D=function(n,t,r){var f=new u(n,t,r),e=f.getProperty("isVisible");return e.onValueSet=function(n,t,i){i.geom.isVisible=n},f.setVisualState=function(n,t,r,u){var c,o,e,s,h;if(t&&r&&u){c=f.geom;f.MorphTo(c,t,r,i.Ease.linear,u);return}if(n.matches("isActiveTarget")){if(e=f.isActiveTarget?.5:0,o=f.dropTarget,!o||o.alpha==e)return;f.MorphTo(o,{alpha:e},10,i.Ease.linear,function(){o.alpha=e});return}if(n.matches("isSelected")){if(e=f.isSelected?.5:0,s=f.selected,!s||s.alpha==e)return;f.MorphTo(s,{alpha:e},10,i.Ease.linear,function(){s.alpha=e});return}if(n.matches("canPullFromGroup")){if(h=f.geom,!h)return;f.MorphTo(h,{skewY:2},100,i.Ease.linear,function(){h.skewY=0});return}},f}}(Foundry.canvas,Foundry,Foundry.createjs),function(n,t,i){var f=i.Tween,r=t.utils,u={noteText:function(){return this.context?this.context.noteText:this.headerText},note:function(){return i.createText("","10px Arial","#000000")},isTextDifferent:function(){return this.headerText==this.noteText?!1:!this.headerText||!this.noteText?!1:!this.headerText.matches(this.noteText)},height:function(){var t,i,r;return(this.context,t=Math.max(this.segHeight||this.minHeight),isNaN(t)&&(t=n.standardNoteSize),!this.isTextDifferent)?t:(i=this.hasGroupMembers(),r=this.isInGroup(),i||r)?t:n.standardNoteSize},bitmap:function(){var t=this.context,r;if(t){if(t.imageUri){var u=this.minWidth,n=i.createBitmap(t.imageUri),e=n.image;return e.onload=function(){var i,t;n.loaded=!0;i=n.image.width/n.image.height;n.image.width>u&&(t=u/n.image.width,n.scaleX=t,n.scaleY=t)},n}if(t.dataUri){var n=i.createBitmap(t.dataUri),o=n.image.width/n.image.height,f=400;return n.image.width>f&&(r=f/n.image.width,n.scaleX=r,n.scaleY=r),n}}},geom:function(){var n=i.createContainer();return n&&n.addChild(this.background,this.bitmap,this.dropTarget,this.selected,this.note,this.headline),n},update:function(){var r,h,p;if(!this.geom)return!1;r=this;n.updateShapeForLayout(r);var c=this.geom,u=this.width,o=this.height;this.note.lineWidth=u-2*n.standardNoteOffset;this.headline.lineWidth=u-n.standardNoteOffset;var l=this.fillColor,a=this.strokeColor,e=this.background.graphics.clear();e.beginFill(l).beginStroke(a).setStrokeStyle(1).drawRect(0,0,u,o).endStroke().endFill();e=this.selected.graphics.clear();e.beginStroke("blue").setStrokeStyle(5).drawRect(3,3,u-6,o-6).endStroke();e=this.dropTarget.graphics.clear();e.beginStroke("green").setStrokeStyle(5).drawRect(2,2,u-4,o-4).endStroke();var s=this.context,i=this.note,f=this.headline,v=this.hasGroupMembers(),y=this.isInGroup();return s&&(f.flowText(s.headerText,21,3),f.textAlign="center",f.textBaseline="top",f.x=u/2,h=f.getMeasuredHeight(),f.y=(o-h)/2,i.flowText(s.noteText,25,15),i.x=(u-i.lineWidth)/2,i.textAlign="left",i.textBaseline="top",p=i.getMeasuredHeight(),i.y=n.minNoteSize,v||y?i.visible=!1:(i.visible=this.isTextDifferent,i.visible&&(f.y=(n.minNoteSize-h)/2))),t.suspendDependencies(function(){c.setTransform(r.pinX,r.pinY);r.selected.alpha=r.isSelected?.5:0;r.dropTarget.alpha=r.isActiveTarget?.5:0}),!0}};n.makeNoteShape2D=function(t,i,f){var e=r.union(u,t);return n.makeShape2D(e,i,f)}}(Foundry.canvas,Foundry,Foundry.createjs),function(n,t,i){var r=i.Tween,u=t.utils;n.makeShape1D=function(t,i,r){return n.makeShape2D({},i,r)}}(Foundry.canvas,Foundry,Foundry.createjs),function(n,t,i,r){var o=i.Tween,f=t.utils,e={pinX:function(){var t=n.standardNoteOffset,u=this.mySiblingsMaxValue("groupDepth",0),i,r;return this.groupDepth==0&&u==0?t:(i=this.mySiblingsBefore(),r=i.sumAll("width",t),r)},pinY:function(){var t=n.minNoteSize,i,r,u;return this.groupDepth>0?t:(i=this.mySiblingsMaxValue("groupDepth",0),this.groupDepth==0&&i>0)?t:(r=this.mySiblingsBefore(),u=r.sumAll("height",t),u)},locX:function(){return 0*this.width},locY:function(){return 0*this.height},minWidth:function(){return n.standardNoteSize},minHeight:function(){return n.minNoteSize},width:function(){this.context;var t=Math.max(this.segWidth,this.minWidth);return isNaN(t)&&(t=n.standardNoteSize),t},height:function(){this.context;var t=Math.max(this.segHeight||this.minHeight);return isNaN(t)&&(t=n.standardNoteSize),t},headerText:function(){return this.context?this.context.headerText:this.myName},headline:function(){return i.createText("","bold 12px Arial","#000000")},background:function(){return i.createShape()},selected:function(){return i.createShape()},dropTarget:function(){return i.createShape()},geom:function(){var n=i.createContainer();return n&&n.addChild(this.background,this.dropTarget,this.selected,this.headline),n},update:function(){var o=this.geom,i,r,s;if(!o||(i=this,i.myParent&&!i.myParent.update))return!1;n.updateShapeForLayout(i);var f=this.width,e=this.height,u=this.background.graphics.clear();return t.suspendDependencies(function(){u.beginFill("yellow").beginStroke("black").setStrokeStyle(1).drawRect(0,0,i.width,i.height).endStroke().endFill()}),u=this.selected.graphics.clear(),u.beginStroke("blue").setStrokeStyle(5).drawRect(3,3,f-6,e-6).endStroke(),u=this.dropTarget.graphics.clear(),u.beginStroke("green").setStrokeStyle(5).drawRect(2,2,f-4,e-4).endStroke(),r=this.headline,r.textAlign="center",r.textBaseline="top",r.lineWidth=f-10,r.x=f/2,s=r.getMeasuredHeight(),r.y=(e-s)/2,t.suspendDependencies(function(){o.setTransform(i.pinX,i.pinY);i.selected.alpha=i.isSelected?.5:0;i.dropTarget.alpha=i.isActiveTarget?.5:0}),!0}},u=function(i,u,o){var s,h;return this.base=n.Shape,s=i&&i.pinX,s&&!t.utils.isFunction(s)?delete i.pinX:s=r,h=i&&i.pinY,h&&!t.utils.isFunction(h)?delete i.pinY:h=r,this.base(f.union(e,i),u,o),this.myType=i&&i.myType||"TableShape2D",this.setXY(s,h),this};u.prototype=function(){var t=function(){this.constructor=u};return t.prototype=n.Shape.prototype,new t}();n.TableShape2D=u;f.isaTableShape2D=function(n){return n instanceof u?!0:!1};u.prototype.setDefaultXY=function(n){return this.setXY(n[0],n[1])};u.prototype.setXY=function(n,t){return isNaN(n)||(this.pinX=this.locX+n),isNaN(t)||(this.pinY=this.locY+t),this};n.makeTableShape2D=function(n,t,r){var f=new u(n,t,r),e=f.getProperty("isVisible");return e.onValueSet=function(n,t,i){i.geom.isVisible=n},f.setVisualState=function(n,t,r,u){var c,o,e,s,h;if(t&&r&&u){c=f.geom;f.MorphTo(c,t,r,i.Ease.linear,u);return}if(n.matches("isActiveTarget")){if(e=f.isActiveTarget?.5:0,o=f.dropTarget,!o||o.alpha==e)return;f.MorphTo(o,{alpha:e},10,i.Ease.linear,function(){o.alpha=e});return}if(n.matches("isSelected")){if(e=f.isSelected?.5:0,s=f.selected,!s||s.alpha==e)return;f.MorphTo(s,{alpha:e},10,i.Ease.linear,function(){s.alpha=e});return}if(n.matches("canPullFromGroup")){if(h=f.geom,!h)return;f.MorphTo(h,{skewY:2},100,i.Ease.linear,function(){h.skewY=0});return}},f}}(Foundry.canvas,Foundry,Foundry.createjs),function(n,t){n.establishType&&(n.establishType("Shape2D",{},t.makeShape2D),n.establishType("noteShape2D",{},t.makeNoteShape2D),n.establishType("tableShape2D",{},t.makeTableShape2D),n.establishType("Shape1D",{},t.makeShape1D))}(Foundry,Foundry.canvas);Canvas2Image=Canvas2Image||{},function(n){var h=!1,t=document.createElement("canvas");t.getContext("2d")&&(h=!0);var c=!!t.getContext("2d").getImageData,e=!!t.toDataURL,l=!!window.btoa,i="image/octet-stream",a=function(n){var t=parseInt(n.width),i=parseInt(n.height);return n.getContext("2d").getImageData(0,0,t,i)},o=function(n){var i="",r,t;if(typeof n=="string")i=n;else for(r=n,t=0;t<r.length;t++)i+=String.fromCharCode(r[t]);return btoa(i)},v=function(n){var i=[],s=n.width,c=n.height,r,t,u,f,e,y,l,h,a,v,w;for(i.push(66),i.push(77),r=s*c*3+54,i.push(r%256),r=Math.floor(r/256),i.push(r%256),r=Math.floor(r/256),i.push(r%256),r=Math.floor(r/256),i.push(r%256),i.push(0),i.push(0),i.push(0),i.push(0),i.push(54),i.push(0),i.push(0),i.push(0),t=[],t.push(40),t.push(0),t.push(0),t.push(0),u=s,t.push(u%256),u=Math.floor(u/256),t.push(u%256),u=Math.floor(u/256),t.push(u%256),u=Math.floor(u/256),t.push(u%256),f=c,t.push(f%256),f=Math.floor(f/256),t.push(f%256),f=Math.floor(f/256),t.push(f%256),f=Math.floor(f/256),t.push(f%256),t.push(1),t.push(0),t.push(24),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),e=s*c*3,t.push(e%256),e=Math.floor(e/256),t.push(e%256),e=Math.floor(e/256),t.push(e%256),e=Math.floor(e/256),t.push(e%256),y=0;y<16;y++)t.push(0);var d=(4-s*3%4)%4,p=n.data,b="",k=c;do{for(l=s*(k-1)*4,h="",a=0;a<s;a++)v=4*a,h+=String.fromCharCode(p[l+v+2]),h+=String.fromCharCode(p[l+v+1]),h+=String.fromCharCode(p[l+v]);for(w=0;w<d;w++)h+=String.fromCharCode(0);b+=h}while(--k);return o(i.concat(t))+o(b)},r=function(n){document.location.href=n},s=function(n,t){return"data:"+t+";base64,"+n},u=function(n){var t=document.createElement("img");return t.src=n,t},f=function(n,t,i){var r,u;return t&&i?(r=document.createElement("canvas"),r.width=t,r.height=i,r.style.width=t+"px",r.style.height=i+"px",u=r.getContext("2d"),u.drawImage(n,0,0,n.width,n.height,0,0,t,i),r):n};n.saveAsPNG=function(n,t,o,s){if(!e)return!1;var c=f(n,o,s),h=c.toDataURL("image/png");return t?u(h):(r(h.replace("image/png",i)),!0)};n.saveAsJPEG=function(n,t,o,s){if(!e)return!1;var l=f(n,o,s),h="image/jpeg",c=l.toDataURL(h);return c.indexOf(h)!=5?!1:t?u(c):(r(c.replace(h,i)),!0)};n.saveAsBMP=function(n,t,e,o){if(!(c&&l))return!1;var y=f(n,e,o),p=a(y),h=v(p);return t?u(s(h,"image/bmp")):(r(s(h,i)),!0)}}(Canvas2Image);Foundry=Foundry||{};Foundry.canvas=Foundry.canvas||{};Foundry.createjs=this.createjs||{},function(n,t){var r=t.utils,u={screenWidth:800,screenHeight:600,leftMargin:0,rightMargin:0,viewWidth:function(){return this.screenWidth-this.leftMargin-this.rightMargin},topMargin:0,bottomMargin:0,viewHeight:function(){return this.screenHeight-this.topMargin-this.bottomMargin},pageId:"drawingCanvas",pageElement:function(){var n=document.getElementById(this.pageId);return n&&(n.style.position="absolute"),n},page:function(){var t=n.makePage2D(this.pageId);return this.panZoom=this.panZoomId&&n.makePanZoomWindow2D(this.panZoomId,{},t),this.panZoom&&t.setPIP(this.panZoom),t.myParent=this,t},pipId:"PIP",pipElement:function(){var n=document.getElementById(this.pipId);return n&&(n.style.position="absolute"),n},panZoomId:"zoomCanvas",panZoomElement:function(){return document.getElementById(this.panZoomId)},panZoom:function(){return this.page},doUpdatePIP:function(){var n=this.page;n&&n.updatePIP()},doZoom1To1:function(){var n=this.page;n&&n.zoom1To1(n.updatePIP)},doZoomToFit:function(){var n=this.page;n&&n.zoomToFit(n.updatePIP)},zoomDelta:1.1,doZoomOut:function(){var n=this.page;n&&n.zoomBy(1/this.zoomDelta)},doZoomIn:function(){var n=this.page;n&&n.zoomBy(this.zoomDelta)},doTogglePanZoomWindow:function(){var n=this.panZoom;n&&(n.isVisible=!n.isVisible,this.pipElement.style.display=n.isVisible?"block":"none",n.isVisible&&n.zoomToFit());this.smashProperty("isPanZoomWindowOpen")},isPanZoomWindowOpen:function(){var n=this.panZoom;return n?n.isVisible:!1}},i=function(n,i,f,e,o,s){var h=r.union(u,e);return h.pageId=n,h.pipId=f,h.panZoomId=i,this.base=t.Component,this.base(h,o,s),this.myType="Drawing",this.setScreenSize(this.screenWidth,this.screenHeight),this};i.prototype=function(){var n=function(){this.constructor=i};return n.prototype=t.Component.prototype,new n}();n.Drawing=i;n.makeDrawing=function(n,t,r,u){return new i(n,t,r,u)};r.isaDrawing=function(n){return n instanceof i?!0:!1};i.prototype.setScreenSize=function(n,i){var r=this,u=this.page;t.runWithUIRefreshLock(function(){r.screenWidth=n;r.screenHeight=i;u.setCanvasWidth(n);u.setCanvasHeight(i);r.panZoomElement&&u.setPIPSize(r.viewWidth,r.viewHeight,r.panZoomElement);r.pipElement&&u.setPIPPosition(r.screenWidth,r.screenHeight,r.pipElement)})}}(Foundry.canvas,Foundry,Foundry.createjs);
/*
//# sourceMappingURL=FoundryComplete.min.js.map
*/