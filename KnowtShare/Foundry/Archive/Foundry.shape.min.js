var Foundry=Foundry||{};Foundry.canvas=Foundry.canvas||{};createjs?(Foundry.createjs=createjs,Foundry.createjs.createShape=function(){return new createjs.Shape},Foundry.createjs.createContainer=function(){return new createjs.Container},Foundry.createjs.createText=function(n,t,i){return new createjs.Text(n,t,i)},Foundry.createjs.createBitmap=function(n){return new createjs.Bitmap(n)},Foundry.createjs.createStage=function(n,t){return new createjs.Stage(n,t)}):Foundry.createjs={createShape:function(){return},createContainer:function(){return},createText:function(){return},createBitmap:function(){return},createStage:function(){return},Tween:undefined,Touch:undefined,Ticker:undefined},function(n,t,i,r){function h(n){n||(n=window.event);n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}function d(n){c=n.ctrlKey;y=n.altKey;p=n.shiftKey}function g(){c=!1;y=!1;p=!1}var v=i.Tween,k=function(n){return n.replace(/(\r\n|\r|\n)/g,"\n")},e,u,f,o;i&&i.Text&&i.Text.prototype&&(i.Text.prototype.splitLine=function(n,t){for(var f="",i=k(n);i[0]=="\n";)i=i.substring(1);while(i.length>t){var u=i.substring(0,t),r=u.lastIndexOf(" "),e=u.lastIndexOf("\n");e!=-1&&(r=e);r==-1&&(r=t);f+=u.substring(0,r)+"\n";i=i.substring(r+1)}return f+i},i.Text.prototype.flowText=function(n,t,i){var r=n?this.splitLine(n,t):n,u=r.split("\n");if(!i||u.length<=i)return this.text=r,r;var f=i-1,o=u.splice(0,f-1),e=o.join("\n")+" "+u[f]+" ...";return this.text=e,e});e=function(t,i,r){var u={context:function(){var n=this.getValueOf("model");return n=n?n.getSubcomponent(this.name,!0):n,n&&alert("Model found"),n},shapeDepth:function(){this.myIndex();return this.componentDepth()},groupDepth:function(){this.shapeDepth;return this.branchDepth()}};return this.base=n.Component,this.base(n.utils.union(u,t),i,r),this.myType=t&&t.myType||"FoundryShape",this.debug=!0,this};e.prototype=function(){var t=function(){this.constructor=e};return t.prototype=n.Component.prototype,new t}();t.FoundryShape=e;n.utils.isaFoundryShape=function(n){return n instanceof e?!0:!1};e.prototype.isOfType=function(n){var i=this.myType,t=this.isType(n);return t?!0:this.context&&this.context.isOfType(n)};e.prototype.outlineRef=function(){var t=this.shapeDepth,n;return t==0||!this.myParent?"":(n=(this.myIndex()+1).toString(),this.myParent.shapeDepth==0)?n:this.myParent.outlineRef()+"."+n};e.prototype.rootPage=function(){if(this.myParent)return this.myParent.rootPage&&this.myParent.rootPage()};e.prototype.isPage=function(){return this==this.rootPage()};e.prototype.removeFromModel=function(){var n=this;return n.smashProperty("geom"),n.glueRemoveFromModel(),this.base.prototype.removeFromModel.call(this)};e.prototype.glueRemoveFromModel=function(){this.Connections&&this.Connections.map(function(n){var t=n.target;t.removeFromModel()})};e.prototype.glueTo=function(n){var i=this.establishCollection("Connections",[]),t=i.firstWhere(function(t){return t.target==n});return t||(t={source:this,target:n},i.push(t)),t};e.prototype.unglueTo=function(n,t){var i,r;return(t&&this.Subcomponents.map(function(r){i=r.unglueTo(n,t)}),r=this.Connections,!r)?i:(i=r.firstWhere(function(t){return t.target==n}),i&&r.remove(i),i)};e.prototype.glueShapeMoved=function(n,t,i,r,u,f){(this.Connections&&this.Connections.map(function(f){var e=f.target;e.glueShapeMoved(n,t,i,r,u)}),f)&&this.Subcomponents.map(function(n){n.glueShapeMoved(n,t,i+u,n.width,n.height,f)})};e.prototype.isShapeHit=function(n,t,i,r,u){var e=this.geom,s,h,c,o,f,l;if(!e)return e;if((s=e.localToGlobal(0,0),n<s.x)||(h=e.localToGlobal(i,r),n>h.x))return!1;if(t>=s.y&&t<=h.y)return this;for(c=this.Subcomponents.elements,o=0;o<c.length;o++)if((f=c[o],!u||!f.isSelected)&&(l=f.isShapeHit(n,t,f.width,f.height,u),l))return l};e.prototype.subcomponentHitTest=function(n,t,i){for(var r,f,e=this.Subcomponents.elements,o=e.length-1,u=o;u>=0;u--)if((r=e[u],!i||!r.isSelected)&&(f=r.isShapeHit(n,t,r.width,r.height,i),f))return f};e.prototype.captureSubcomponent=function(t,i){var u=this,r=t.myParent;return i&&(t.name=i),u.canCaptureSubcomponent(t)?(n.runWithUIRefreshLock(function(){r&&(r.removeSubcomponent(t),r.shapeDepth>0&&(r.smashPropertyTree("shapeDepth"),r.smashPropertyTree("minHeight"),r.smashPropertyTree("minWidth")));t.smashProperty("pinX");t.smashProperty("pinY");u&&(u.addSubcomponent(t),u.shapeDepth>0?u.smashPropertyBranch("shapeDepth"):(t.smashProperty("minHeight"),t.smashProperty("minWidth"),t.smashProperty("shapeDepth")))}),r):void 0};e.prototype.capture=function(n,t){return this.captureSubcomponent(n,t)};e.prototype.captureInsertSubcomponent=function(t,i,r){var f=this,u=i.myParent;return r&&(i.name=r),f.canCaptureSubcomponent(i)?(n.runWithUIRefreshLock(function(){u&&(u.removeSubcomponent(i),u.shapeDepth>0&&(u.smashPropertyTree("shapeDepth"),u.smashPropertyTree("minHeight"),u.smashPropertyTree("minWidth")));i.smashProperty("pinX");i.smashProperty("pinY");f&&(f.insertSubcomponent(t,i),f.shapeDepth>0?f.smashPropertyBranch("shapeDepth"):(i.smashProperty("minHeight"),i.smashProperty("minWidth"),i.smashProperty("shapeDepth")))}),u):void 0};u=function(t,u,f){var s=t&&t.canvasElement||document.getElementById("myCanvas")||document.createElement("canvas"),h={canvas:function(){return s},stage:function(){var n=i.createStage(this.canvas,!0);return createjs.Touch.enable(n),n.mouseMoveOutside=!1,n},draggable:!0,isVisible:!0,geom:function(){return this.Subcomponents.count,this.stage},title:function(){var n=this.rootComponent("model");return n?n.title:""},scale:1,panX:0,panY:0,rotation:0,context:function(){return this.canvas?this.canvas.getContext("2d"):r},canvasWidth:function(){return this.canvas?this.canvas.width:0},canvasHeight:function(){return this.canvas?this.canvas.height:0},selectionSet:function(){return n.makeCollection()},dropTargetSet:function(){return n.makeCollection()},pixelsPerInch:150,drawingWidth:function(){return 16*this.pixelsPerInch},drawingHeight:function(){return 9*this.pixelsPerInch},drawingMargin:function(){return.25*this.pixelsPerInch},surfaceWidth:function(){return this.drawingWidth+2*this.drawingMargin},surfaceHeight:function(){return this.drawingHeight+2*this.drawingMargin},showBackground:!0,background:function(){var n=i.createShape();return this.backgroundGeom(this.drawingWidth,this.drawingHeight,this.drawingMargin,n,!0),n},showGrid:!1,gridX:function(){return 1*this.pixelsPerInch},gridY:function(){return.5*this.pixelsPerInch},grid:function(){var n=i.createShape();return this.gridGeom(this.drawingWidth,this.drawingHeight,this.drawingMargin,this.gridX,this.gridY,n,!0),n},showCross:!1,cross:function(){var n=i.createShape();return this.crossGeom(this.drawingWidth,this.drawingHeight,this.drawingMargin,n,!0),n}},o;return this.base=e,this.base(n.utils.union(h,t),u,f),this.name=this.name?this.name:"PAGE",this.doAnimations=!0,this.PIP=r,o=this,this._defaultPinX=100,this._defaultPinY=100,this._defaultPinXDelta=0,this._defaultPinYDelta=0,this.pageRenderComplete=function(){},o.resetDropDelta(),this._pasteAreaPinX=0,this._pasteAreaPinY=0,this._pasteAreaGap=10,o.resetPasteArea(),o.addBinding("scale",function(t){var i=t.getValue();n.runWithUIRefreshLock(function(){var n=o.stage;n.scaleX=n.scaleY=i})}),o.addBinding("panX",function(t){var i=t.getValue();n.runWithUIRefreshLock(function(){o.resetDropDelta();var n=o.stage;n.x=i})}),o.addBinding("panY",function(t){var i=t.getValue();n.runWithUIRefreshLock(function(){o.resetDropDelta();var n=o.stage;n.y=i})}),this.canvas&&this.stage&&this.draggable&&this.setupDragAndDrop(!0),this.myType=t&&t.myType||"Page",o.addBinding("geom",function(t,i){t.canTrace()&&n.trace.error(i.gcsIndent("Binding TRIGGERED a page render"));o.render()}),o};u.prototype=function(){var n=function(){this.constructor=u};return n.prototype=e.prototype,new n}();t.Page2DCanvas=u;n.utils.isa2DCanvas=function(n){return n instanceof u?!0:!1};u.prototype.updatePIP=function(){};u.prototype.setPIP=function(t){this.PIP=t;var i=this;u.prototype.updatePIP=function(){i.PIP&&n.publish("refreshPanZoom",[i.PIP,i])};i.updatePIP()};u.prototype.setPIPSize=function(t,i,r){var u=this;this.canvas&&u.PIP&&n.publish("sizePanZoom",[u.PIP,u,t,i,r])};u.prototype.setPIPPosition=function(t,i,r){var u=this;this.canvas&&u.PIP&&n.publish("positionPanZoom",[u.PIP,u,t,i,r])};u.prototype.setCanvasWidth=function(n){this.canvas&&this.canvas.width!=n&&(this.canvas.width=n,this.smashProperty("canvasWidth"))};u.prototype.setCanvasHeight=function(n){this.canvas&&this.canvas.height!=n&&(this.canvas.height=n,this.smashProperty("canvasHeight"))};u.prototype.autoLayout=function(){this.Subcomponents.forEach(function(n){n.Subcomponents.forEach(function(n){n.smashPropertyBranch("shapeDepth");n.smashPropertyBranch("pinX");n.smashPropertyBranch("pinY")})})};u.prototype.componentDepth=function(){return 0};var c=!1,y=!1,p=!1;window.addEventListener("keydown",d,!0);window.addEventListener("keyup",g,!0);u.prototype.selectShapeHitTest=function(n,t){for(var i,f,u=this.selectionSet.elements,r=0;r<u.length;r++)if((i=u[r],i.myParent==this)&&(f=i.isShapeHit(n,t,i.width,i.height),f==i))return i};u.prototype.selectShape=function(t,i){var u=this.selectionSet,f,e;if(!t||!t.isSelected){if(!t&&u.count==0){n.publish("ShapeSelected",[this,t,u]);return}i&&(u.forEach(function(n){n.isSelected=!1;n.setVisualState("isSelected")}),u.clear(),this.selectDropTarget(r,!0));t&&(t.isSelected=!0,u.count==0&&u.push(t),t.setVisualState("isSelected"),f=this.geom,e=f.children.length-1,f.setChildIndex(t.geom,e));n.publish("ShapeSelected",[this,t,u])}};u.prototype.gotoCurrentShape=function(){if(!this.Subcomponents.isEmpty()){var i=this.selectionSet,n=i.first(),t=n?n:this.Subcomponents.first();return this.selectShape(t,!0),t}};u.prototype.gotoParentShape=function(){if(!this.Subcomponents.isEmpty()){var i=this.selectionSet,t=i.first(),n=t?t.myParent:this.Subcomponents.first();return n==this&&(n=r),this.selectShape(n,!0),n}};u.prototype.gotoChildShape=function(){if(!this.Subcomponents.isEmpty()){var i=this.selectionSet,n=i.first(),t=n?n.Subcomponents.first():this.Subcomponents.first();return this.selectShape(t,!0),t}};u.prototype.gotoNextShape=function(n){if(!this.Subcomponents.isEmpty()){var r=this.selectionSet,t=r.first(),i=t?t.mySiblingNext():this.Subcomponents.first();return!i&&t&&n&&(i=t.myParent.Subcomponents.first()),this.selectShape(i,!0),i}};u.prototype.gotoPreviousShape=function(n){if(!this.Subcomponents.isEmpty()){var r=this.selectionSet,t=r.first(),i=t?t.mySiblingPrevious():this.Subcomponents.last();return!i&&t&&n&&(i=t.myParent.Subcomponents.last()),this.selectShape(i,!0),i}};u.prototype.selectDropTarget=function(n,t){var i=this.dropTargetSet;n&&n.isActiveTarget||(t&&(i.forEach(function(n){n.isActiveTarget=!1;n.setVisualState("isActiveTarget")}),i.clear()),n&&(n.isActiveTarget=!0,n.setVisualState("isActiveTarget"),i.count==0&&i.push(n)))};u.prototype.selectedDropTarget=function(){var n=this.dropTargetSet;return n.count>0?n.last():r};u.prototype.resetPasteArea=function(n){return this._pasteAreaPinX=this.drawingMargin,this._pasteAreaPinY=this.drawingMargin,this._pasteAreaGap=n?n:10,this._pasteAreaGap};u.prototype.showPasteArea=function(n){var t=this,r=t.surfaceWidth,u=t.surfaceHeight,i=Math.min(t.canvasWidth/r,t.canvasHeight/u),f=(t.canvasWidth-i*r)/2,e=(t.canvasHeight-i*u)/2;return t.transformTo(i,f+100,e,200,function(){n&&n()}),this};u.prototype.moveToPasteArea=function(n){var t=this,f=t._pasteAreaPinX-n.width/2-t._pasteAreaGap,i=t._pasteAreaPinY+t._pasteAreaGap,u;n.setXY(f,i);u=1;t._pasteAreaPinY=i+n.height*u;fo.publish("ShapeMoved",[n.name,r,n]);setTimeout(function(){t.introduceShape(n)},300)};u.prototype.resetDropDelta=function(){this._defaultPinXDelta=this._defaultPinYDelta=0;this._defaultPinX=1.5*this.drawingMargin-this.panX/this.scale;this._defaultPinY=1.5*this.drawingMargin-this.panY/this.scale;this.resetPasteArea()};u.prototype.overrideDefaultPinXPinY=function(n,t){this._defaultPinX=n;this._defaultPinY=t;this._defaultPinXDelta=this._defaultPinYDelta=0};u.prototype.selectedShape=function(){var n=this.selectionSet;return n.count>0?n.last():r};u.prototype.selectedContext=function(){var n=this.selectedShape();return n?n.context:r};u.prototype.shapeDropped=function(t,i,r){var e=r.stageX,o=r.stageY,s=this,h={pinX:t.pinX,pinY:t.pinY,index:t.myIndex()},u=s.subcomponentHitTest(e,o,!0),f;u&&(f=u.captureSubcomponent(t),n.publish("ShapeReparented",[t,f,t.myParent,h]))};u.prototype.shapePulled=function(t,i,u,f){var h=f?f.stageX:0,c=f?f.stageY:0,e=this,l={pinX:t.pinX,pinY:t.pinY,index:t.myIndex()},a=e.captureSubcomponent(t),o,s;n.publish("ShapeReparented",[t,a,t.myParent,l]);o=(h-e.panX)/e.scale-u.x;s=(c-e.panY)/e.scale-u.y;t.setXY(o,s);n.publish("ShapeMoved",[t.name,r,t])};u.prototype.setupDragAndDrop=function(){function rt(n,t){var i={x1:Math.min(n.x,t.x),x2:Math.max(n.x,t.x),y1:Math.min(n.y,t.y),y2:Math.max(n.y,t.y)};return i.width=i.x2-i.x1,i.height=i.y2-i.y1,i.area=i.width*i.height,i}function ut(n){var t=tt.graphics;t.clear();n&&(t.beginFill("#ff0000").drawRect(n.x1,n.y1,n.width,n.height),u.addChild(tt));u.update()}function it(i){var r=i.stageX,u=i.stageY,f=r-a.x,e=u-a.y;n.runWithUIRefreshLock(function(){t.setPanTo(f,e);t.updatePIP()})}function pt(i,r,u){var e=t.geom.globalToLocal(i,r),f;n.runWithUIRefreshLock(function(){t.zoomBy(u);t.updatePIP()});f=t.geom.localToGlobal(e.x,e.y);n.runWithUIRefreshLock(function(){t.panBy(i-f.x,r-f.y);t.updatePIP()})}function st(i,r,u){var e=t.geom.globalToLocal(i,r),f;n.runWithUIRefreshLock(function(){t.setZoomTo(u);t.updatePIP()});f=t.geom.localToGlobal(e.x,e.y);n.runWithUIRefreshLock(function(){t.panBy(i-f.x,r-f.y);t.updatePIP()})}function wt(i){var v,p,l,k,nt,w,tt;if(h(i),v=i.stageX,p=i.stageY,c){a={x:v-u.x,y:p-u.y};u.addEventListener("stagemousemove",it);u.addEventListener("stagemouseup",function(){u.removeEventListener("stagemousemove",it)});return}o={x:0,y:0};e=f=r;l=t.selectShapeHitTest(v,p);l&&(w=l.geom.globalToLocal(v,p),o={x:w.x,y:w.y});k=l?r:t.subcomponentHitTest(v,p);k&&!l&&(l=k,w=l.geom.globalToLocal(v,p),o={x:w.x,y:w.y},l.myParent!=t&&(l.setVisualState("canPullFromGroup"),e=l,f=l.myParent,s=yt,nt=f.geom,w=nt.globalToLocal(v,p),vt={x:w.x,y:w.y}));n.runWithUIRefreshLock(function(){t.selectShape(l,!0);t.selectDropTarget(r,!0)});d=!0;y=l!==r;g=!y&&t.publishTouchBoxingEvents;g&&(b=t.geom.globalToLocal(v,p),ut(),tt=rt(b,b),n.publish("BoxingStarted",[t,tt,i]));!l&&t.allowSingleTouchPan&&(a={x:v-u.x,y:p-u.y},u.addEventListener("stagemousemove",it),u.addEventListener("stagemouseup",function(){u.removeEventListener("stagemousemove",it)}))}function bt(i){var w,k,v,it,tt,ft,l,c,p,et,a;if(d&&!at){if(h(i),w=i.stageX,k=i.stageY,e&&s>=0){if(c=e.geom,v=f.geom,s-=1,f&&s>ot)return;if(f&&s>0){it=ot-s-3;tt=2*it;e.setVisualState("canBePullFromGroup",{skewY:tt,skewX:tt},200,function(){c&&(c.skewX=c.skewY=tt)});ft=1.01+it/10;f.setVisualState("canHaveItemPulled",{scaleX:ft},200,function(){v&&(v.scaleX=ft)});return}s==0&&(s=-1,v.removeChild(c),p=t.geom.globalToLocal(w,k),c.x=p.x-o.x,c.y=p.y-o.y,u.addChild(c),t.selectShape(e,!0),t.selectDropTarget(r,!0),e.setVisualState("wasPulledFromGroup",{skewY:0,skewX:0},200,function(){c.skewY=0;c.skewX=0;f&&f.setVisualState("canHaveItemPulled",{scaleX:1},300,function(){v&&(v.scaleX=1)})}));return}if((l=t.selectedShape(),l&&y&&(c=l.geom,p=t.geom.globalToLocal(w,k),c.x=p.x-o.x,c.y=p.y-o.y,c.skewX=c.skewY=0,l.glueShapeMoved(l,c.x,c.y,l.width,l.height,!0),n.publish("ShapeMoving",[t,l,i]),t.updatePIP()),g&&d&&(nt=t.geom.globalToLocal(w,k),et=rt(b,nt),ut(et),n.publish("BoxingSizing",[t,et,i])),y&&l&&!e)&&(!l||l.canBeGrouped)){if(a=t.subcomponentHitTest(w,k,!0),a=a&&a.canGroupItems?a:r,a){t.selectDropTarget(a,!0);return}t.selectDropTarget(a,!0)}}}function kt(i){var v,p,l,a,tt,u,c,it,w,et;if(h(i),v=i.stageX,p=i.stageY,d=!1,g&&(nt=t.geom.globalToLocal(v,p),l=rt(b,nt),a=r,t.Subcomponents.forEach(function(n){var t=n.geom;t.x<l.x1||t.x>l.x2||t.y<l.y1||t.y>l.y2||(a=a?a:[],a.push(n))}),ut(),n.publish("BoxingFinished",[t,l,a,i])),e&&s>0){var c=e.geom,ft=f.geom,k=0;e.setVisualState("canBePullFromGroup",{skewY:k,skewX:k},300,function(){c&&(c.skewX=c.skewY=k)});tt=1;f.setVisualState("canHaveItemPulled",{scaleX:tt},300,function(){ft&&(ft.scaleX=tt)});y=!1}u=t.selectedShape();u&&y&&(y=!1,c=u.geom,it=t.geom.globalToLocal(v,p),c.x=it.x-o.x,c.y=it.y-o.y,n.publish("ShapeMoving",[t,u,i]),w=t.subcomponentHitTest(v,p,!0),t.selectDropTarget(w,!0),e&&s==-1?n.runWithUIRefreshLock(function(){t.shapePulled(e,f,o,i)}):f&&s>=0?f.setVisualState("canNotDropOnGroup"):w&&w.canGroupItems?n.runWithUIRefreshLock(function(){t.shapeDropped(u,o,i)}):(n.runWithUIRefreshLock(function(){u.pinX=c.x;u.pinY=c.y;u.angle=0}),u.isInGroup()||(et=u.context,n.publish("ShapeMoved",[u.name,et,u]))));t.selectDropTarget(r,!0);t.applyToSubcomponent(function(n){n.isActiveTarget&&(n.isActiveTarget=!1);n.setVisualState&&n.setVisualState("isActiveTarget")},!0);e=r;f=r}function dt(i){var r,u,f,e;h(i);r=t.selectedShape();r?(r.setVisualState("SelectedForEdit"),u=c?"OpenNav":"OpenEdit",n.publish("doubleClick",[r,r.context,u])):(f=i.stageX,e=i.stageY)}function ht(n){h(n);var t=1.1,i=Math.max(-1,Math.min(1,n.wheelDelta||-n.detail))>0?t:1/t,r=n.offsetX,u=n.offsetY;pt(r,u,i,n)}function lt(t){var i=n.utils.forEachValue(t,function(n,t){return{x:t.clientX,y:t.clientX}}),r=Math.pow(i[1].x-i[0].x,2),u=Math.pow(i[1].y-i[0].y,2);return Math.ceil(Math.sqrt(r+u))}function ni(t){var i=n.utils.forEachValue(t,function(n,t){return{x:t.clientX,y:t.clientX}});return{x:(i[1].x+i[0].x)/2,y:(i[1].y+i[0].y)/2}}var t=this,u=t.geom,v=t.canvas,ui=t.selectionSet,o={x:0,y:0},y=!1,at=!1,d=!1,g=!1,b={x:0,y:0},nt={x:0,y:0},vt={x:0,y:0},e=r,f=r,s=0,ot=10,yt=18,a,tt;t.allowSingleTouchPan=!1;t.publishTouchBoxingEvents=!1;a={x:0,y:0};tt=i.createShape();tt.alpha=.1;n.subscribe("touchZoomStageToCenter",function(n,t,i,r){st(gx,gy,i,r)});u.addEventListener("stagemousedown",wt,!1);u.addEventListener("stagemousemove",bt,!1);u.addEventListener("stagemouseup",kt,!1);u.addEventListener("dblclick",dt,!1);v&&(v.addEventListener("mousewheel",ht,!1),v.addEventListener("DOMMouseScroll",ht,!1));var ft,ct=1,gt=1,p={},l=r,k={},w=r;var et=1,ti=function(i){var u=i.pointerId,o,s,h,c;if(i.pointerType=="touch"&&(l==r?p[u]=i:l[u]=i,w={},k[u]&&(w[u]=i)),l){var v=lt(l),f=v/ct,e=Math.abs(f-et);if(e<.1||e>.8)return;et=f;o=ft.x;s=ft.y;st(o,s,et,i)}w&&w[u]&&(h=w[u].clientX-a.x,c=w[u].clientY-a.y,n.runWithUIRefreshLock(function(){t.setPanTo(h,c);t.updatePIP()}))},ii=function(n){var t=n.pointerId;n.pointerType=="touch"&&(l=r,w=r,p[t]&&delete p[t],k[t]&&delete k[t])},ri=function(n){var f=n.pointerId,e,i;if(n.pointerType=="touch"&&(k={},t.selectedShape()==r&&(k[f]=n,a={x:n.clientX-u.x,y:n.clientY-u.y}),p[f]=n,e=Object.keys(p).length,e==2)){l={};for(i in p)l[i]=p[i];ft=ni(l);ct=lt(l);gt=t.scale}};v&&(v.addEventListener("pointerdown",ri,!1),v.addEventListener("pointermove",ti,!1),v.addEventListener("pointerup",ii,!1))};u.prototype.backgroundGeom=function(n,t,i,r,u){var f=r.graphics;return u&&f.clear(),f.beginFill("gray"),f.drawRect(i,i,n,t),f.endFill(),f};u.prototype.gridGeom=function(n,t,i,r,u,f,e){var o=f.graphics,s,h;e&&o.clear();o.beginStroke("#000");var c=i,l=i,a=i+n,v=i+t;for(o.drawRect(c,l,n,t),s=c;s<a;)o.moveTo(s,l),o.lineTo(s,v),s+=r;for(h=l;h<v;)o.moveTo(c,h),o.lineTo(a,h),h+=u;return o};u.prototype.crossGeom=function(n,t,i,r,u){var f=r.graphics,e;u&&f.clear();f.beginStroke("yellow").setStrokeStyle(5);var o=i,s=i,c=i+n,l=i+t,h=o+n/2;return f.moveTo(h,s),f.lineTo(h,l),e=s+t/2,f.moveTo(o,e),f.lineTo(c,e),f};u.prototype.rootPage=function(){return this};u.prototype.defaultPinX=function(){return this._defaultPinX+this.defaultPinXDelta()};u.prototype.defaultPinY=function(){return this._defaultPinY+this.defaultPinYDelta()};u.prototype.defaultPinXDelta=function(){return this._defaultPinXDelta>200&&(this._defaultPinXDelta=0),this._defaultPinXDelta=this._defaultPinXDelta+20,this._defaultPinXDelta};u.prototype.defaultPinYDelta=function(){return this._defaultPinYDelta>200&&(this._defaultPinYDelta=0),this._defaultPinYDelta=this._defaultPinYDelta+20,this._defaultPinYDelta};u.prototype.zoomBy=function(n){var t=this;return t.scale*=n,this};u.prototype.setZoomTo=function(n){var t=this,i=n/t.scale;return t.zoomBy(i),this};u.prototype.setPanTo=function(n,t){var i=this;return i.panX=n,i.panY=t,this};u.prototype.panBy=function(n,t){var i=this;return i.panX+=n,i.panY+=t,this};u.prototype.transformTo=function(t,i,r,u,f){var e=this,o=e.stage,s=u?u:0,h=v.get(o).to({x:i,y:r,scaleX:t,scaleY:t},s,createjs.Ease.linear);return h.call(function(){n.runWithUIRefreshLock(function(){e.setPanTo(i,r);e.setZoomTo(t);f&&f()})}),this};u.prototype.zoomToFit=function(n){var t=this,f=0,e=0,i=t.surfaceWidth,r=t.surfaceHeight;t.Subcomponents.forEach(function(n){var t,u;f=Math.min(f,n.pinX);e=Math.min(e,n.pinY);t=n.width?n.width:0;i=Math.max(i,n.pinX+t);u=n.height?n.height:0;r=Math.max(r,n.pinY+u)});var u=Math.min(t.canvasWidth/i,t.canvasHeight/r),o=(t.canvasWidth-u*i)/2,s=(t.canvasHeight-u*r)/2;return t.transformTo(u,o,s,500,function(){n&&n()}),this};u.prototype.zoom1To1=function(n){var t=this;return t.transformTo(1,0,0,500,function(){n&&n()}),this};u.prototype.establishChild=function(n,t){var u=this,i=u.stage;return i.getChildIndex(n)==-1&&(i.addChild(n),t!=r&&i.setChildIndex(n,t)),n};u.prototype.render=function(t){var i=this,u=i.context,r=i.geom,f;return createjs.Ticker.removeEventListener("tick",r),t&&r.removeAllChildren(),i.showBackground&&i.establishChild(i.background,0),i.showGrid&&this.establishChild(i.grid,1),i.showCross&&this.establishChild(i.cross),n.updateStage=function(){r.update();i.pageRenderComplete&&i.pageRenderComplete()},n.runWithUIRefreshLock(function(){i.renderContent?i.renderContent.call(i,u,r):i.Subcomponents&&i.Subcomponents.forEach(function(n){n.render(u,r)})},n.updateStage),f=r.children.length,createjs.Ticker.useRAF=!0,createjs.Ticker.setFPS(30),createjs.Ticker.addEventListener("tick",r),this};u.prototype.introduceShape=function(n,t){var u=this,r=u.stage,i=n.geom;i.scaleX=i.scaleY=0;i.rotation=-30;r.addChild(i);r.update();n.MorphTo(i,{scaleY:1,scaleX:1,rotation:0},200,createjs.Ease.linear,function(){i.scaleY=1;i.scaleX=1;i.rotation=0;t&&t()})};u.prototype.farewellShape=function(n,t){var r=this,i=n.geom;n.MorphTo(i,{scaleY:0,scaleX:0,rotation:30},200,createjs.Ease.linear,function(){t&&t()})};u.prototype.MorphTo=function(t,i,r,u,f){var e=this.stage,o;this.doAnimations?(o=v.get(t).to(i,r,u),o.call(function(){n.runWithUIRefreshLock(f);e.update()})):(n.runWithUIRefreshLock(f),e.update())};u.prototype.DrawDot=function(n,t,r,u){var f=i.createShape(),e=r?r:"#F00",o=u?u:6;f.graphics.beginFill(e).drawCircle(0,0,o).endFill();f.x=n;f.y=t;this.stage.addChild(f)};f=function(t,i,r){var u={pinX:0,pinY:0,angle:0,isSelected:!1,isActiveTarget:!1,canGroupItems:function(){return!0},canBeGrouped:function(){return!0},showSubcomponents:!0};return this.base=e,this.base(n.utils.union(u,t),i,r),this.myType=t&&t.myType||"Shape",this};f.prototype=function(){var n=function(){this.constructor=f};return n.prototype=e.prototype,new n}();t.Shape=f;n.utils.isaShape=function(n){return n instanceof f?!0:!1};f.prototype.rootPage=function(){if(this.myParent)return this.myParent.rootPage&&this.myParent.rootPage()};f.prototype.isInGroup=function(){return this.myParent!==this.rootPage()};f.prototype.hasGroupMembers=function(){return this.Subcomponents.isNotEmpty()};f.prototype.toggleShowSubcomponents=function(){return n.runWithUIRefreshLock(function(){this.showSubcomponents=!this.showSubcomponents}),this.showSubcomponents};f.prototype.render=function(n,t){var r=this.getProperty("geom"),i;r&&(i=r.getValue(),t.addChild(i),this.Subcomponents.forEach(function(r){r.render(n,i||t)}))};f.prototype.setVisualState=function(){};f.prototype.upcaseHeading=function(){};f.prototype.angleInRads=function(){return Math.PI/180*this.angle};n.utils.isaShape=function(n){return n instanceof f?!0:!1};f.prototype.defaultPinX=function(){var n=this.rootPage();return n.defaultPinX()};f.prototype.defaultPinY=function(){var n=this.rootPage();return n.defaultPinY()};f.prototype.setDefaultDropLocation=function(){this.isInGroup()==!1&&(this.pinX=this.defaultPinX(),this.pinY=this.defaultPinY())};f.prototype.MorphGeomTo=function(n,t,i,r){var u=this.geom;return this.MorphTo(u,n,t,i,r)};f.prototype.MorphTo=function(n,t,i,r,u){var f=this.rootPage();f.MorphTo(n,t,i,r,u)};f.prototype.repositionTo=function(n,t,i,r){var u=this;this.MorphGeomTo({x:n,y:t},500,createjs.Ease.sineInOut,function(){u.pinX=n;u.pinY=t;u.angle=i?i:0;u.glueShapeMoved(u,n,t,u.width,u.height,!0);r&&r()})};var w=["#FFFFFF","#FFFF99","#FFFF33","#FFCC66","#FFCC00","#CC9900","#996600","#663300"],b=10,l=150,a=50,s=function(t,u,e){var o={locX:function(){return 0*this.width},locY:function(){return 0*this.height},minWidth:function(){return l},width:function(){return Math.max(this.widthTotal,this.minWidth)},minHeight:function(){return l},height:function(){var n=this.isInGroup();return this.groupDepth>0||n?a:this.minHeight?this.minHeight:l},widthTotal:function(){var n=this.groupDepth,t,i;return n<=0?l:n<=1?this.minWidth+n*10:(t=this.Subcomponents,i=t.sumAll("width",b),i)},strokeColor:function(){var n=this.groupDepth+1;return n>7&&(n=7),w[n]},fillColor:function(){var n=this.groupDepth;return n>6&&(n=6),w[n]},textColor:function(){var n=this.groupDepth;return n>=5?"white":"black"},fxMod:function(){return this.width*this.height},pinX:function(){var n=b,r=this.mySiblingsMaxValue("groupDepth",0),t,i;return this.groupDepth==0&&r==0?n:(t=this.mySiblingsBefore(),i=t.sumAll("width",n),i)},pinY:function(){var n=a,t,i,r;return this.groupDepth>0?n:(t=this.mySiblingsMaxValue("groupDepth",0),this.groupDepth==0&&t>0)?n:(i=this.mySiblingsBefore(),r=i.sumAll("height",n),r)},geom:function(){var t=this,v=t.getProperty("stage",!0),nt,f,y,d,o,u,it,p,w,b,g,l,s;if(!v){myParent||alert("this shape is not attaced to model "+y);return}if(nt=t.shapeDepth,f=this.context,!v){y=JSON.stringify(f.getSpec(),r,3);alert("cannot create geometry for shape2D, the stage is missing "+y);return}var rt=v.getValue(),k=i.createShape(),h=i.createShape(),c=i.createShape(),tt=f?f.noteText:"",e=i.createText(tt,"10px Arial","#000000");return e.x=5,e.textAlign="left",e.textBaseline="top",d=f?f.headerText:"",o=i.createText(d,"bold 12px Arial","#000000"),o.textAlign="center",o.textBaseline="top",f&&f.dataUri&&(u=i.createBitmap(f.dataUri),it=u.image.width/u.image.height,p=400,u.image.width>p&&(w=p/u.image.width,u.scaleX=w,u.scaleY=w)),f&&f.imageUri&&(b=this.minWidth,u=i.createBitmap(f.imageUri),g=u.image,g.onload=function(){var t,n;u.loaded=!0;t=u.image.width/u.image.height;u.image.width>b&&(n=b/u.image.width,u.scaleX=n,u.scaleY=n)}),l=function(i,r,s,l,v){var rt=i.fillColor,ut=i.strokeColor,ot=i.groupDepth==0,st=i.shapeDepth==0,g,nt,p,it,y,et,b,d;t.canTrace()&&n.trace.log("createGraphics "+v+": "+i.name);e.color=o.color=i.textColor;e.lineWidth=o.lineWidth=r-10;g=v;nt=l.matches(v)?"":l;e.flowText(nt,25,15);var ft=e.lineWidth,tt=e.getMeasuredHeight(),w=Math.max(r,ft);o.flowText(g,21,3);hdHeight=o.getMeasuredHeight();p=i.isInGroup()?s:Math.max(s,hdHeight+tt);o.x=w/2;it=i.hasGroupMembers();it?(p=s,o.y=p/4,e.visible=!1):(e.y=o.y=5,e.y+=hdHeight+5,l||(p=a),p=i.isInGroup()?s:Math.max(p,e.y+tt),e.visible=!i.isInGroup(),e.visible||(o.y=p/4));y=k.graphics;y.clear();isNaN(p)&&(p=25);isNaN(w)&&(w=25);y.beginFill(rt);y.beginStroke(ut).setStrokeStyle(1);y.drawRect(0,0,w,p);y.endStroke();y.endFill();y=h.graphics;y.clear();y.beginStroke("blue").setStrokeStyle(5);y.drawRect(3,3,w-6,p-6);y.endStroke();h.alpha=i.isSelected?.5:0;y=c.graphics;y.clear();y.beginStroke("green").setStrokeStyle(5);y.drawRect(2,2,w-4,p-4);y.endStroke();c.alpha=i.isActiveTarget?.5:0;f&&f.imageUri&&(et=u.image.width/u.image.height,b=w,u.image.width>b&&(d=b/u.image.width,u.scaleX=d,u.scaleY=d))},s=i.createContainer(),s.addChild(k,u,c,h,e,o),t.setVisualState=function(n,i,r,u){var f;if(i&&r&&u){t.MorphTo(s,i,r,createjs.Ease.linear,u);return}if(n.matches("isActiveTarget")){if(f=t.isActiveTarget?.5:0,c.alpha==f)return;t.MorphTo(c,{alpha:f},10,createjs.Ease.linear,function(){c.alpha=f});return}if(n.matches("isSelected")){if(f=t.isSelected?.5:0,h.alpha==f)return;t.MorphTo(h,{alpha:f},10,createjs.Ease.linear,function(){h.alpha=f});return}if(n.matches("canPullFromGroup")){t.MorphTo(s,{skewY:2},100,createjs.Ease.linear,function(){s.skewY=0});return}},t.getProperty("fxMod").onValueSmash=function(t,i,r){n.trace&&n.trace.log("smash "+this.name+"  "+r.name);var u=t},t.addOnRefresh("fxMod",function(t,i){var r,u,e,o;n.trace&&n.trace.log("binding "+t.name+"  "+i.name);r=i.height;u=i.width;f?(e=i.context.headerText,o=i.context.noteText,l(i,u,r,o||"",e||"")):l(i,u,r,"","")}),f&&(f.addOnRefresh("noteText",function(i,r){n.trace&&n.trace.log("binding "+i.name+"  "+r.name);var u=i.getValue();u&&(e.text.matches(u)||l(t,t.width,t.height,u,r.headerText||""))}),f.addOnRefresh("headerText",function(i,r){n.trace&&n.trace.log("binding "+i.name+"  "+r.name);var u=i.getValue();u&&(o.text.matches(u)||l(t,t.width,t.height,r.noteText||"",u))})),t.addOnRefresh("pinX",function(n){var t=n.getValue();s.x=isNaN(t)?0:t}),t.addOnRefresh("locX",function(n){s.regX=n.getValue()}),t.addOnRefresh("pinY",function(n){var t=n.getValue();s.y=isNaN(t)?0:t}),t.addOnRefresh("locY",function(n){s.regY=n.getValue()}),t.addOnRefresh("isSelected",function(){t.setVisualState("isSelected")}),t.addOnRefresh("isActiveTarget",function(){t.setVisualState("isActiveTarget")}),s}};return this.base=f,this.base(n.utils.union(o,t),u,e),this.myType=t&&t.myType||"Shape2D",this.getProperty("geom").onValueDetermined=function(t,i,r){var u=this,f=r.context,e=u.thisValueDependsOn.duplicate();e.forEach(function(n){n.owner==f&&u.removeDependency(n)});u.canTrace()&&n.trace.info(r.gcsIndent("CREATE GEOM "+r.name))},this.getProperty("geom").onValueSmash=function(t,i,r){var f=this,u;f.canTrace()&&n.trace.error(r.gcsIndent("REMOVE GEOM "+r.name));u=t.parent;u&&(u.removeChild(t),f.canTrace()&&n.trace.error(r.gcsIndent("DELETED FROM PARENT "+r.context.headerText)))},this};s.prototype=function(){var n=function(){this.constructor=s};return n.prototype=f.prototype,new n}();t.Shape2D=s;n.utils.isaShape2D=function(n){return n instanceof s?!0:!1};s.prototype.resetDefaults=function(t){return this.smashProperties("locX,locY,width,height"),n.utils.mixin(this,t),this};s.prototype.setXY=function(n,t){return this.pinX=this.locX+n,this.pinY=this.locY+t,this};s.prototype.refreshRectangle=function(){return this.x1=this.pinX-this.locX,this.y1=this.pinY-this.locY,this.x2=this.x1+this.width,this.y2=this.y1+this.height,this};o=function(t,r,u){var e={sourceID:"",targetID:"",source:function(){var t=this.rootPage(),n=t.getSubcomponent(this.sourceID,!0);return n&&n.glueTo(this),n},target:function(){var t=this.rootPage(),n=t.getSubcomponent(this.targetID,!0);return n&&n.glueTo(this),n},beginX:function(){return this.source?this.source.pinX+.5*this.source.width:0},beginY:function(){return this.source?this.source.pinY+.5*this.source.height:0},endX:function(){return this.target?this.target.pinX+.5*this.target.width:0},endY:function(){return this.target?this.target.pinY+.5*this.target.height:0},fxMod:function(){return this.source&&this.target?this.source.fxMod*this.target.fxMod:0},canGroupItems:function(){return!1},canBeGrouped:function(){return!1},geom:function(){var t=this,o=this.context,u=t.getProperty("stage",!0);if(!u){alert("cannot create geometry for Shape1D");return}var s=u.getValue(),f=i.createShape(),e=function(i){t.canTrace()&&n.trace.log("createGraphics: "+this.sourceID+" >-< "+this.targetID);var r=f.graphics;r.clear();r.beginStroke("black").setStrokeStyle(1);r.moveTo(i.beginX,i.beginY);r.lineTo(i.endX,i.endY);r.endStroke()},r=i.createContainer();return r.addChild(f),t.setVisualState=function(n,i,u,f){if(i&&u&&f){t.MorphTo(r,i,u,createjs.Ease.linear,f);return}},t.connectionMoved=function(){e(t)},t.addOnRefresh("fxMod",function(n,t){e(t)}),r}};return this.base=f,this.base(n.utils.union(e,t),r,u),this.myType=t&&t.myType||"Shape1D",this.getProperty("geom").onValueSmash=function(t,i,r){var f=this,u;f.canTrace()&&n.trace.error(r.gcsIndent("REMOVE GEOM "+r.name));u=t.parent;u&&(u.removeChild(t),f.canTrace()&&n.trace.error(r.gcsIndent("DELETED FROM PARENT "+r.context.headerText)))},this};o.prototype=function(){var n=function(){this.constructor=o};return n.prototype=f.prototype,new n}();o.prototype.glueShapeMoved=function(n,t,i,r,u){this.source==n?(this.beginX=t+.5*r,this.beginY=i+.5*u):this.target==n&&(this.endX=t+.5*r,this.endY=i+.5*u);this.connectionMoved()};o.prototype.otherSide=function(n){return this.source==n?this.target:this.target==n?this.source:void 0};o.prototype.hasGlueTo=function(n){return n?this.source==n||this.target==n:r};o.prototype.subcomponentHitTest=function(){};o.prototype.isShapeHit=function(){};o.prototype.removeFromModel=function(){var n=this,t,i;return n.smashProperty("geom"),t=n.source,t&&t.unglueTo(n),i=n.target,i&&i.unglueTo(n),this.base.prototype.removeFromModel.call(this)};o.prototype.render=function(n,t){var r=this.getProperty("geom"),i;r&&(i=r.getValue(),t.addChild(i),t.setChildIndex(i,1))};t.Shape1D=o;n.utils.isaShape1D=function(n){return n instanceof o?!0:!1};t.makePage=function(n,t,i){return new u(n,t,i)};t.makePage2D=function(n,t){var r=fo.utils.isString(n)?document.getElementById(n):n,i=t||{};return i.canvasElement=r,fo.construct("Page",i)};t.makeShape=function(n,t,i){return new f(n,t,i)};t.makeShape2D=function(n,t,i){return new s(n,t,i)};t.makeShape1D=function(n,t,i){return new o(n,t,i)}}(Foundry,Foundry.canvas,Foundry.createjs),function(n,t){n.defineType&&(n.defineType("Page",{},t.makePage),n.defineType("Shape",{},t.makeShape),n.defineType("Shape2D",{},t.makeShape2D),n.defineType("Shape1D",{},t.makeShape1D))}(Foundry,Foundry.canvas);
/*
//# sourceMappingURL=Foundry.shape.min.js.map
*/