var Foundry=Foundry||{},fo;(function(n){n.version="2.1.0";n.buildDate="01 May 2014 16:05:45 GMT"})(Foundry);Foundry=Foundry||{},function(n,t){function i(n){return n?String(n):""}n.dom={ul:function(n,i){return i==t?"<ul>"+n+"<\/ul>":"<ul id='"+i+"'>"+n+"<\/ul>"},li:function(n,i){return i==t?"<li>"+n+"<\/li>":"<li id='"+i+"'>"+n+"<\/li>"},p:function(n,i){return i==t?"<p>"+n+"<\/p>":"<p id='"+i+"'>"+n+"<\/p>"},span:function(n,i){return i==t?"<span>"+n+"<\/span>":"<span id='"+i+"'>"+n+"<\/span>"},div:function(n,i){return i==t?"<div>"+n+"<\/div>":"<div id='"+i+"'>"+n+"<\/div>"},pre:function(n,i){return i==t?"<pre>"+n+"<\/pre>":"<pre id='"+i+"'>"+n+"<\/pre>"},w:function(n,i){return i==t?"<div>"+n+"<br/><\/div>":"<div id='"+i+"'>"+n+"<br/><\/div>"}};n.traceEnabled=!1;n.trace={clr:function(){window.console&&window.console.clear&&window.console.clear()},exception:function(n){window.console&&window.console.log&&window.console.log(n)},log:function(n){window.console&&window.console.log&&window.console.log(n)},assert:function(t,i){n.traceEnabled&&window.console&&window.console.assert&&window.console.assert(t,i)},error:function(t){n.traceEnabled&&window.console&&window.console.error&&window.console.error(t)},warn:function(t){n.traceEnabled&&window.console&&window.console.warn&&window.console.warn(t)},info:function(t){n.traceEnabled&&window.console&&window.console.info&&window.console.info(t)},dir:function(t){if(n.traceEnabled&&window.console&&window.console.dir)try{window.console.dir(t)}catch(i){window.console.dir(i)}},assert:function(t,i){n.traceEnabled&&window.console&&window.console.assert&&window.console.assert(t,i)},funcTrace:function(t,i){var f=i?i+"()":t.callee.caller.toString().split(")")[0]+")",r,u;for(f+=" -> ",r=0;r<t.length;r++)u=t[r],f+=typeof u=="function"?" "+u.toString().split("(")[0]+", ":" "+u+", ";n.trace.log(f)},alert:function(n){window.alert&&window.alert(n)},writeLog:function(t){for(var i,u=t+" -> ",r=1;r<arguments.length;r++)i=arguments[r],u+=typeof i=="function"?" "+i.toString().split("(")[0]+", ":" "+i+", ";n.trace.log(u)},p:function(n,t){var r=document.createElement("div"),u,f;return r.innerHTML="<p>"+i(n)+"<\/p>",r.style.color="#0000FF",r.setAttribute("class","foundry-trace"),u=document.getElementById("debug"),f=t||u||document.body,f.appendChild(r),r},br:function(n){var t=document.createElement("div"),i,r;return t.innerHTML="<br/>",t.style.color="#0000FF",t.setAttribute("class","foundry-trace"),i=document.getElementById("debug"),r=n||i||document.body,r.appendChild(t),t},pre:function(n,t){var r=document.createElement("div"),u,f;return r.innerHTML="<pre>"+i(n)+"<\/pre>",r.style.color="#0000FF",r.setAttribute("class","foundry-trace"),u=document.getElementById("debug"),f=t||u||document.body,f.appendChild(r),r},w:function(n,t){var r=document.createElement("div"),u,f;return r.innerHTML=i(n)+"<br />",r.style.color="#0000FF",r.setAttribute("class","foundry-trace"),u=document.getElementById("debug"),f=t||u||document.body,f.appendChild(r),r},clear:function(n){var t=document.getElementById("debug"),i=n||t||document.body;return i.innerHTML="",this.clr(),!0},timerStart:function(n){var t=this.w("start :"+i(n)).style;return t.backgroundColor="#000000",t.color="#FFFFFF",{time:Date.now(),text:n}},timerReport:function(n,i){var u=(Date.now()-n.time)/1e3,r=this.w("report:"+n.text+" ("+u+" sec) "+(i==t?"":i)).style;return r.backgroundColor="#000000",r.color="#FFFFFF",{time:Date.now(),text:i||n.text}},reportValueChange:function(n){var t=n.asReference(),i;return n.initValueComputed?this.w("change: "+t+" is changed to formula: "+n.init.toString()):(i="<pre>"+n.owner.stringify(n)+"<\/pre>",this.w("change: "+t+" is changed to: "+i))},reportValueSmash:function(n){var i=n.asReference(),r=n.formula===t?"V: "+n.value:"F: "+n.formula.toString();return this.w("smash: "+i+" status: "+n.status+" "+r)},varifyValue:function(n,t,i,r){n[t]===i?this.w("CORRECT! The value of "+t+" == "+i,r).style.color="#00FF00":this.w("ERROR    The value of "+t+"("+n[t]+") != "+i,r).style.color="#FF0000"},reportValue:function(t,i,r){var f,u;if(this.w("The value of Property: "+i+" is "+t[i],r),t[i]instanceof n.Collection)for(f=t[i].elements,u=0;u<f.length;u++)this.w("["+u+"] is "+f[u],r)},reportProperties:function(n,t){for(var r,u=Object.keys(n),i=0;i<u.length;i++)r=u[i],"_"===r[0]&&this.reportValue(n,r.substring(1),t)},reportPropertyState:function(n,i,r){var u=n[i],e=u.asReference(),f=u.formula===t?"V:"+u.value:"F:"+u.formula.toString();f=u.status!==t?"Value=|"+u.value+"|":f;this.w("Property: "+e+" status: "+u.status+" "+f,r)},reportState:function(n,t){for(var r,u=Object.keys(n),i=0;i<u.length;i++)r=u[i],"_"===r[0]&&this.reportPropertyState(n,r,t)},reportDependencyState:function(t,i){function r(t){var i=n.utils.isArray(t.value)?"array["+t.value.length+"]total":t.value;return"|{0} s: {1} v: {2}| ".format(t.asReference(),t.status,i)}var f=this,u=t[i],o=u.thisValueDependsOn,e;o&&o[0]?o.forEach(function(n){f.w(r(u)+" Depends on "+r(n))}):f.w(r(u)+" Depends on NOTHING ");e=u.thisInformsTheseValues;e&&e[0]?e.forEach(function(n){f.w(r(u)+" Informs "+r(n))}):f.w(r(u)+" Informs NOTHING ")},reportDependencyNetwork:function(n,t){for(var r,u=Object.keys(n),i=0;i<u.length;i++)r=u[i],"_"===r[0]&&this.reportDependencyState(n,r,t)},inspectProperty:function(n,t,i){var r=n[t];this.w("Property: "+r.asReference(),i);this.pre(r.stringify(),i)},inspect:function(n,t){for(var r,u=Object.keys(n),i=0;i<u.length;i++)r=u[i],"_"===r[0]&&this.inspectProperty(n,r,t);this.dir(n)},reportStructure:function(i,r,u){function f(t){var u=r(t),e=n.dom.div(u),i=n.dom.li(e,t.getID());return t.Subcomponents.isNotEmpty()&&(i=t.Subcomponents.mapReduce(function(t){return n.dom.ul(f(t))},function(n,t){return n+t},i)),i}r===t&&(r=function(n){return n.toString()});var o=f(i),s=document.getElementById("debug"),h=u||s||document.body,e=document.createElement("div");h.appendChild(e);e.innerHTML=o}}}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n,t){Array.prototype.every||(Array.prototype.every=function(n){for(var i=new Object(this),t=0,r=i.length>>>0;t<r;t++)if(t in i&&!n.call(arguments[1],i[t],t,i))return!1;return!0});Array.prototype.map||(Array.prototype.map=function(n){for(var r=[],i=new Object(this),t=0,u=i.length>>>0;t<u;t++)t in i&&r.push(n.call(arguments[1],i[t],t,i));return r});Array.prototype.filter||(Array.prototype.filter=function(n){for(var u=[],r,i=new Object(this),t=0,f=i.length>>>0;t<f;t++)r=i[t],t in i&&n.call(arguments[1],r,t,i)&&u.push(r);return u});Array.prototype.firstWhere||(Array.prototype.firstWhere=function(n){for(var r,u,i=0;i<this.length;i++)if(r=this[i],u=n==t?!0:n(r),u)return r});Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)=="[object Array]"});Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var i=new Object(this),r=i.length>>>0,t;if(!r)return-1;for(t=0,arguments.length>1&&(t=arguments[1]),t=t>=0?t:Math.max(0,r+t);t<r;t++)if(t in i&&i[t]===n)return t;return-1});Array.prototype.insert||(Array.prototype.insert=function(n,t){this.splice(n,0,t)});Array.prototype.max||(Array.prototype.max=function(){var n,i;if(this.length==0)return t;for(n=Number(this[0]),i=1;i<this.length;i++)n=Math.max(n,this[i]);return n});Array.prototype.min||(Array.prototype.min=function(){var n,i;if(this.length==0)return t;for(n=Number(this[0]),i=1;i<this.length;i++)n=Math.min(n,this[i]);return n});Array.prototype.sortOn||(Array.prototype.sortOn=function(n,t){var i=t?-1:1;return n?this.sort(function(t,r){return t[n]<r[n]?-1*i:t[n]>r[n]?1*i:0}):this});Array.prototype.forEach||(Array.prototype.forEach=function(n){for(var t=0,i=this.length>>>0;t<i;t++)n(this[t])});Array.prototype.indexOfFirst||(Array.prototype.indexOfFirst=function(n){for(var t=0,i=this.length;t<i;t++)if(n(this[t]))return t;return-1});Array.prototype.itemByIndex||(Array.prototype.itemByIndex=function(n){return n<0||n>this.length?t:this[n]});Array.prototype.contains||(Array.prototype.contains=function(n){for(var t=0,i=this.length;t<i;t++)if(this[t]==n)return!0});Array.prototype.distinctItems||(Array.prototype.distinctItems=function(){for(var t=[],n=0,i=this.length;n<i;n++)t.indexOf(this[n])<0&&t.push(this[n]);return t});Array.prototype.addNoDupe||(Array.prototype.addNoDupe=function(n){this.length===0?this.push(n):this.length===1&&n!==this[0]?this.push(n):(found=this.indexOf(n),found===-1&&this.push(n))});Array.prototype.prependNoDupe||(Array.prototype.prependNoDupe=function(n){this.length===0?this.push(n):this.length===1&&n!==this[0]?this.splice(0,0,n):(found=this.indexOf(n),found===-1&&this.splice(0,0,n))});Array.prototype.peek||(Array.prototype.peek=function(){if(this.length>0){var n=this.length-1;return this[n]}});Array.prototype.isEmpty||(Array.prototype.isEmpty=function(){return this.length==0});Array.prototype.isNotEmpty||(Array.prototype.isNotEmpty=function(){return this.length>0});Array.prototype.remove||(Array.prototype.remove=function(n,t){var i=this.slice((t||n)+1||this.length);return this.length=n<0?this.length+n:n,this.push.apply(this,i)});Array.prototype.removeItem||(Array.prototype.removeItem=function(n){var t=this.indexOf(n);return t<0?this:this.remove(t)});Array.prototype.duplicate||(Array.prototype.duplicate=function(){for(var t=new Array(this.length),n=0;n<this.length;n++)t[n]=this[n];return t});Array.prototype.uniqueValue||(Array.prototype.uniqueValue=function(n,t){for(var f,r,i=t?t:{},u=0;u<this.length;u++)f=this[u],r=n(f),i[r]?i[r]+=1:i[r]=1;return i});Array.prototype.groupBy||(Array.prototype.groupBy=function(n,t){for(var r,u,i=t?t:{},f=0;f<this.length;f++)r=this[f],u=n(r),i[u]?i[u].push(r):i[u]=[r];return i});String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};String.prototype.fulltrim=function(){return this.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")};String.prototype.removeSpaces=function(){return this.replace(/\s+/g,"")};String.prototype.format=function(){for(var i,t=this,n=0;n<arguments.length;n++)i=new RegExp("\\{"+n+"\\}","gi"),t=t.replace(i,arguments[n]);return t};String.prototype.matches||(String.prototype.matches=function(n){return n?this.toLocaleLowerCase()==n.toLocaleLowerCase():n==this});String.prototype.startsWith=function(n){return this.match("^"+n)==n};String.prototype.endsWith=function(n){return this.match(n+"$")==n};String.prototype.containsString=function(n){return this.indexOf(n)!=-1};String.prototype.contains||(String.prototype.contains=function(n){return this.toLocaleLowerCase().containsString(n.toLocaleLowerCase())});String.prototype.begins=function(n){return this[0]===n};String.prototype.ends=function(n){return this[this.length-1]===n};Function.prototype.debounce||(Function.prototype.debounce=function(n,t){var r=this,i;return function(){function e(){t||r.apply(u,f);i=null}var u=this,f=arguments;i?clearTimeout(i):t&&r.apply(u,f);i=setTimeout(e,n||100)}});Function.prototype.wait100||(Function.prototype.wait100=function(){function i(){return n.apply(n,t)}var n=this,t=arguments;setTimeout(i,100)});Function.prototype.wait200||(Function.prototype.wait200=function(){function i(){return n.apply(n,t)}var n=this,t=arguments;setTimeout(i,200)});Function.prototype.wait500||(Function.prototype.wait500=function(){function i(){return n.apply(n,t)}var n=this,t=arguments;setTimeout(i,500)});Function.prototype.wait1000||(Function.prototype.wait1000=function(){function i(){return n.apply(n,t)}var n=this,t=arguments;setTimeout(i,1e3)})}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n,t){n.lastGUID=0;n.newGuid=function(){return n.lastGUID+=1,n.lastGUID};n.utils={replaceAll:function(n,t){return this.split(n).join(t)},createID:function(t){var i=n.newGuid();return t&&(i=new String(t).replace(/ /g,"_")+"_"+i),i},generateUUID:function(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(t=="x"?i:i&7|8).toString(16)})},removeCRLF:function(n){return n.replace(/(\r\n|\n|\r)/gm," ")},removeExtraSpaces:function(n){return n.replace(/\s{2,}/g," ")},removeJSComments:function(n){return n.replace(/\/\*.+?\*\/|\/\/.*(?=[\n\r])/g,"")},cleanFormulaText:function(t){var i=t.toString();return n.utils.removeExtraSpaces(n.utils.removeCRLF(n.utils.removeJSComments(i)))},cleanTemplateHtml:function(t){var i=t;return n.utils.removeCRLF(t)},capitaliseFirstLetter:function(t){var i=n.utils.asString(t);return i.charAt(0).toUpperCase()+i.slice(1)},asString:function(n){return n===t?"":n.toString()},asInt:function(n,t){var r=t?t:0,i=parseInt(n);return isNaN(i)?r:i},isArray:function(n){return Array.isArray?Array.isArray(n):Object.prototype.toString.call(n)==="[object Array]"?!0:!1},isFunction:function(n){return typeof n=="function"},isString:function(n){return typeof n=="string"},isNumber:function(n){return typeof n=="number"},isObject:function(n){return n&&typeof n=="object"},asArray:function(i){return n.utils.isaCollection(i)?i.elements:n.utils.isArray(i)?i:i===t?[]:[i]},objectToArray:function(i){var r,u;if(n.utils.isaCollection(i))return i.elements;if(n.utils.isArray(i))return i;if(n.utils.isObject(i)){r=[];for(u in i)i.hasOwnProperty(u)&&r.push(i[u]);return r}return i?[i]:t},removeDuplicates:function(n){for(var f,u,i=[],e=n.length,r=0;r<e;r++){for(f=t,u=0;u<i.length;u++)if(origArr[r]===i[u]){f=!0;break}f||i.push(origArr[r])}return i},getParamNames:function(n){var t=n.toString();return t.slice(t.indexOf("(")+1,t.indexOf(")")).match(/([^\s,]+)/g)},hasAspect:function(n,t){return n&&(n[t]||n[t.toLowerCase()])},getAspectOrDefault:function(n,t){return n[t]?n[t]:n[t.toLowerCase()]?n[t.toLowerCase()]:n},extractSlots:function(n,t){var u={},i,r;for(i in n)n.hasOwnProperty(i)&&(r=n[i],t(r)&&(u[i]=r));return u},isSelf:function(n){return n.matches("@")||n.matches("this")||n.matches("self")},isaCollection:function(t){return t instanceof n.Collection?!0:!1},asCollection:function(t,i){return n.utils.isaCollection(t)?t:new n.Collection(n.utils.asArray(t),i)},isaComponent:function(t){return t instanceof n.Component?!0:!1},isaRelationship:function(t){return t instanceof n.Relationship?!0:!1},isaProperty:function(t){return t instanceof n.Property?!0:!1},isManaged:function(n){return this.isaComponent(n)||this.isaCollection(n)||this.isaProperty(n)},isArrayOrCollection:function(n){return this.isArray(n)||this.isaCollection(n)},isaPromise:function(t){return t instanceof n.Promise?!0:!1},forEachValue:function(n,t){var i=[],r=n?Object.keys(n):[];return r.forEach(function(r){var f=n[r],u=t(r,f);u&&i.push(u)}),i},findKeyForValue:function(n,t){for(var i in n)if(n[i].matches(t))return i},propEq:function(n,t){return function(i){return i[n]===t}},debounce:function(n,t,i){return n.debounce(t,i)},pluck:function(n){return function(t){return t[n]}},getNamespace:function(n){var t=n.myType.split("::");return t[0]},getType:function(n){var t=n.myType.split("::");return t.length==2?t[1]:t[0]},isComment:function(n){return n.startsWith("//")},comment:function(t){return n.utils.isComment(t)?t:"//"+t},unComment:function(t){return n.utils.isComment(t)?t.substring(2):t},bindingStringToObject:function(n){var i=t,f,r,e,u,o,s;if(n)for(f=n.split(","),r=0;r<f.length;r++)(e=f[r],u=e.split(":"),u.length!=1)&&(i=i||{},o=decodeURI(u[1].trim()),s=decodeURI(u[0].trim()),i[o]=s);return i},stylingStringToObject:function(n){var i=t,f,r,e,u,o,s;if(n)for(f=n.split(","),r=0;r<f.length;r++)(e=f[r],u=e.split(":"),u.length!=1)&&(i=i||{},o=decodeURI(u[0].trim()),s=decodeURI(u[1].trim()),i[o]=s);return i},queryStringToObject:function(n,i){var r=t,i,e,u,o,f,s,h;if(n)for(i=i===t?"&":i,e=n.split(i),u=0;u<e.length;u++)if(o=e[u],o){if(f=o.split("="),f.length==1)continue;r=r||{};s=decodeURI(f[0].trim());h=decodeURI(f[1].trim());r[s]=h}return r},hashStringToArray:function(n,i){var e=t,i,u,r,f;if(n)for(i=i===t?"#":i,u=n.split(i),r=0;r<u.length;r++)f=u[r],f&&(e=f.split("/").map(function(n){return decodeURI(n.trim())}));return e},objectToQueryString:function(n,i){var r="",u,f,e;if(n&&(u=Object.keys(n),u.length>0)){for(f=0;f<u.length;f++)(e=u[f],n[e]!==t)&&(r+="&"+e+"="+n[e]);i&&(r="?"+r.substring(1))}return r},clone:function(t){var r,f,i,u;if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return i=new Date,i.setTime(t.getTime()),i;if(t instanceof Array){for(i=[],r=0,f=t.length;r<f;r++)i[r]=n.utils.clone(t[r]);return i}if(t instanceof Object){i={};for(u in t)t.hasOwnProperty(u)&&(i[u]=n.utils.clone(t[u]));return i}throw new Error("Unable to copy obj! Its type isn't supported.");},getOwnPropertyValues:function(n){var t=[];for(var i in n)hasOwnProperty.call(n,i)&&t.push(n[i]);return t},makeComputedValue:function(t,i,r){var u=n.utils.isFunction(r);return Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:function(){return u?result=r.call(t,t):r}}),t},extendWithComputedValues:function(t,i){if(t&&i)for(var r in i)hasOwnProperty.call(i,r)&&n.utils.makeComputedValue(t,r,i[r]);return t},extend:function(n,t){if(!t)return n;for(var i in t)hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n},mixExtend:function(n,t){if(!t)return n;for(var i in t)hasOwnProperty.call(n,i)||(n[i]=t[i]);return n},mixin:function(n,t){if(!t)return n;if(!n)return t;for(var i in t)n[i]=t[i];return n},mixout:function(n,t){if(!t)return n;if(!n)return t;for(var i in t)n.hasOwnProperty(i)&&delete n[i];return n},union:function(n,t){var r={},i;if(n)for(i in n)r[i]=n[i];if(t)for(i in t)r[i]=t[i];return r},getEvent:function(n){return n||window.event},getEventSource:function(t){var i=n.utils.getEvent(t);return i.srcElement||i.originalTarget},getParentElement:function(n){if(n&&n.parentNode)return n.parentNode},getParentElementWithClassName:function(n,t){var i=n;if(t)while(i&&i.className!=t&&i.parentNode)i=i.parentNode;else i&&(i=i.parentNode);return i},getParentElementWithAttribute:function(n,i){for(var r=n;r&&r.hasAttribute&&r.hasAttribute(i)==!1;r=r.parentNode);return r&&r.hasAttribute&&r.hasAttribute(i)?r:t},urlCasheBuster:function(n){var t=Math.round((new Date).getTime()/1e3),i=n.indexOf("?")>=0?"&cb=":"?cb=";return n+i+t},xmlHttpGet:function(n,t,i){var r=new XMLHttpRequest;r.onload=function(){var n=r.responseText;t&&t(n,r)};try{r.open("GET",n,!1);r.send(null)}catch(u){i&&i(u,r)}},loadTemplate:function(t,i){n.utils.xmlHttpGet(t,function(n){var r=document.getElementsByTagName("head")[0],t=document.createElement("div");t.innerHTML=n;r.appendChild(t);i&&i()})},captureLine:function(){function i(n){var r=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(n),t,i;return r?[r[1],Number(r[2])]:(t=/at ([^ ]+):(\d+):(?:\d+)$/.exec(n),t)?[t[1],Number(t[2])]:(i=/.*@(.+):(\d+)$/.exec(n),i?[i[1],Number(i[2])]:void 0)}var f;try{throw new Error;}catch(r){var n=r.stack.split("\n"),u=n[0].indexOf("@")>0?n[1]:n[2],t=i(u);return t?(f=t[0],t[1]):void 0}}}}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n,t){var u=0,f,r;globalDependencyLock=function(n){return u=u+n,u==0,u};n.suspendDependencies=function(n,t){globalDependencyLock(1);n&&n(t);globalDependencyLock(-1)};f=function(i,r,u){var o="_"+r,e,f;return u==null&&(u=function(){return null}),e=n.utils.isFunction(u),u===fo.fromParent&&(u=function(){return fo.fromParent.call(i,r)}),this.myName=r,this.owner=i,this.formula=e?u:t,this.status=!e&&u!==t?"init":t,this.value=e?t:u,this.thisValueDependsOn=t,this.thisInformsTheseValues=t,this.uiBindings=t,this.onRefreshUi=t,this.onValueSet=t,this.onValueDetermined=t,this.onValueSmash=t,n.utils.isaCollectionSpec(this.value)?(f=this.value.createCollection(i),f.myName=r,this.value=f):n.utils.isaCollection(this.value)&&this.value.owner===t&&(f=n.makeCollection(this.value.elements,i),f.myName=r,this.value=f),Object.defineProperty(i,r,{enumerable:!0,configurable:!0,set:function(r){var u=i[o],s=u.value,e=n.utils.isFunction(r),f=e?t:r,h=s==f;if(!u.status||!h||e){if(u.guard){u.smash();return}i.withDependencies?(u.smash(),u.removeSmashTrigger()):r===t&&u.formula!==t&&(f=u.formula.call(u.owner));u.value=f;u.formula=e?r:u.formula;u.status=e?t:"given";fo.publishNoLock("setValue",[u,f]);e||(n.markForRefresh(u),u.onValueSet&&u.onValueSet.call(u,f,u.formula,u.owner),u.formula&&u.validate&&u.validate.call(u,f,u.owner))}},get:function(){var u=i[o],f,h=u.status===t,e,s,c;if(!i.withDependencies)return h&&u.formula!==t&&(f=u.formula.call(u.owner),fo.publishNoLock("setValueTo",[u,f]),u.value=f),u.value;if(e=i.globalComputeStack(),s=e?e.peek():t,h){if(s===u)return fo.publishNoLock("getValue",[u,u.value]),u.value;h&&(fo.publishNoLock("mustCompute",[u]),u.formula!==t?(e&&e.push(u),f=u.formula.call(u.owner,u),u.status=f===t?t:"calculated",c=e?e.pop():u,c!=u&&n.trace&&n.trace.alert("during compute: Something is not working")):(f=u.defaultValue,f===t&&n.utils.isFunction(u.defaultFormula)&&(f=u.defaultFormula.call(u.owner,u)),u.status=f===t?t:"default"),s&&s.addDependency(u),n.utils.isaCollection(f)&&f.owner===t&&(f.owner=i,f.myName=r),fo.publishNoLock("setValueTo",[u,f]),u.onValueDetermined&&u.onValueDetermined.call(u,f,u.formula,u.owner),u.value=f)}else return s===t?u.value:(s.addDependency(u),fo.publishNoLock("getValue",[u,u.value]),u.value);return f}}),i[o]=this,this};f.prototype={getID:function(){return this.guid?this.guid:(this.guid=n.utils.createID(this.myName),this.guid)},redefine:function(i,r){this.smash();var u=n.utils.isFunction(i);this.formula=u?i:t;this.status=u?t:"given";this.value=u?t:i;r&&(this.guard=r)},asLocalReference:function(){try{return this.owner._name?this.owner._name&&this.owner._name.status?this.myName+"@"+this.owner.myName:this.myName+"@OWNER_NAME_NOT_COMPUTED":this.myName+"@"+this.owner.myName}catch(n){return this.myName+"@???"}},asReference:function(){return this.myName+"@"+this.owner.asReference()},asDisplayValue:function(){return fo.utils.isManaged(this.value)?"=> "+this.value.myName:this.value},resolveReference:function(t){if(this.myName.match(t)||n.utils.isSelf(t))return this;return this.owner.resolveReference(t)},resolveSuperior:function(t){if(this.myName.match(t)||n.utils.isSelf(t))return this;return this.owner.resolveSuperior(t)},resolveProperty:function(n){var i={};return i.property=this,i.meta=n&&"@".matches(n)?t:n,i},getProperty:function(n,i){return n.matches(this.myName)?this:i&&this.owner?this.owner.getProperty(n,i):t},smashProperty:function(n,t){var i=this.getProperty(n,t);return i&&i.status&&i.smash(),i},smashPropertyTree:function(n){var i=this.smashProperties(n),t=this.myParent;return t?t.smashPropertyTree(n):i},smashPropertyBranch:function(n){this.smashProperties(n);this.Subcomponents.forEach(function(t){t.smashPropertyBranch(n)})},addDependency:function(n){return this===n?this:u?this:(this.thisValueDependsOn===t&&(this.thisValueDependsOn=[]),this.thisValueDependsOn.addNoDupe(n),fo.publishNoLock("nowDependsOn",[this,n]),n.thisInformsTheseValues===t&&(n.thisInformsTheseValues=[]),n.thisInformsTheseValues.addNoDupe(this),fo.publishNoLock("nowInforms",[n,this]),this)},removeDependency:function(n){return this.thisValueDependsOn?this.thisValueDependsOn.removeItem(n):fo.publishNoLock("dependsOnNotRemoved",[this,n]),n.thisInformsTheseValues?n.thisInformsTheseValues.removeItem(this):fo.publishNoLock("informsNotRemoved",[n,this]),fo.publishNoLock("noLongerDependsOn",[this,n]),this},valueDependsOnCount:function(){return this.thisValueDependsOn?this.thisValueDependsOn.length:0},informsTheseValuesCount:function(){return this.thisInformsTheseValues?this.thisInformsTheseValues.length:0},removeSmashTrigger:function(){var n=this;this.valueDependsOnCount()>0&&(this.thisValueDependsOn.length==1?this.removeDependency(this.thisValueDependsOn[0]):this.thisValueDependsOn.duplicate().forEach(function(t){n.removeDependency(t)}))},isolateFromSmash:function(){this.thisValueDependsOn&&this.thisValueDependsOn.length>0&&(this.removeSmashTrigger(),this.thisValueDependsOn=[]);this.status="isolated";fo.publishNoLock("isolated",[this])},smash:function(){var i,r;return this.status&&(this.onValueSmash&&this.onValueSmash.call(this,this.value,this.formula,this.owner),this.formula?this.status=t:this.status!="init"&&(this.status=t),fo.publishNoLock("smash",[this,this.value]),i=this,i.smashAndRemove=function(n){n.removeDependency(i);n.status&&(fo.publishNoLock("smashed",[i]),n.status&&fo.publishNoLock("thenSmashes",[n]));n.smash()},this.informsTheseValuesCount()>0&&(this.thisInformsTheseValues.length==1?i.smashAndRemove(this.thisInformsTheseValues[0]):(r=this.thisInformsTheseValues.duplicate(),this.thisInformsTheseValues=[],r.forEach(i.smashAndRemove))),(this.uiBindings||this.onRefreshUi)&&n.markForRefresh(this)),this},addBinding:function(i,r){return this.uiBindings=this.uiBindings===t?[]:this.uiBindings,n.utils.isFunction(i)?(this.uiBindings.push(i),r!==!1&&n.markForRefresh(this)):n.trace.alert("Binding must be a formula"),this},clearBinding:function(){if(this.uiBindings!==t)return this.uiBindings=t,this},purgeBindings:function(){var n=this.uiBindings!==t;return this.uiBindings&&this.uiBindings.length&&this.uiBindings.forEach(function(n){delete n}),this.uiBindings=t,n},updateBindings:function(){var r,u;if(this.uiBindings!==t){r=this.uiBindings.duplicate();try{for(i=0;i<r.length;i++)u=r[i],u.call(this,this,this.owner)}catch(f){n.trace&&n.trace.alert(f)}}return this},stringify:function(i){function u(i,r){switch(i){case"owner":case"myParent":return r?r.asReference():r;case"formula":return n.utils.isFunction(r)?n.utils.cleanFormulaText(r):r;case"thisValueDependsOn":case"thisInformsTheseValues":case"uiBindings":case"onRefreshUi":return t}return n.utils.isaPromise(r)?"Promise":r}var r=i||this;return JSON.stringify(r,u,3)},refreshUi:function(){return this.updateBindings(),this.onRefreshUi&&(this.getValue(),this.onRefreshUi.call(this,this,this.owner)),this},doCommand:function(i,r,u){var f,e;return this.status?this.value:(f=this.formula,r!==t&&n.utils.isFunction(this[r]))?(f=this[r],f.call(this,i)):f!==t?(e=f.call(this.owner,i,r,u),this.status=e===t?t:"calculated",this.value=e,e):f===t?this.getValue(r):void 0},isValueKnown:function(){return this.status?!0:!1},getValue:function(n){if(n===t)return this.owner[this.myName];return this.getMetaData(n)},getValueAsync:function(t){var i=this.getValue(t),r;return n.utils.isaPromise(i)?i:(r=new n.Promise(this.owner,t),r.value=i,r)},setValue:function(n){this.owner[this.myName]=n},refreshValue:function(t){var i=this;n.runWithUIRefreshLock(function(){i.setValue(t)})},getMetaData:function(i,r){if(i===t||this[i]===t)return r;var u=r,f=this[i];return(n.utils.isFunction(f)?u=f.call(this):f!==t&&(u=f),n.utils.isaPromise(u)&&r!==t)?r:u},getMetaDataAsync:function(i,r){var u=this.getMetaData(i,r),f;return n.utils.isaPromise(u)?u:(u=u?u:this.status?this.value:t,f=new n.Promise(this.owner,i),f.value=u,f)},setMetaData:function(n,i){return n!==t&&(this[n]=i),this},extendWith:function(n){for(var t in n)n.hasOwnProperty(t)&&(this[t]=n[t]);return this},createView:function(n,t){var i=n&&this[n]?this[n]:this;return i.makeUi?i.makeUi.call(this,t):""},extendUi:function(n){var i=this;for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return this},reCompute:function(){if(this.formula)return this.smash(),this.compute()},compute:function(){return this.getValue()}};n.Property=f;r=function(t){return this.base=n.Property,this.base(t,"count",function(){return this.elements.length}),this};r.prototype=function(){var t=function(){this.constructor=r};return t.prototype=n.Property.prototype,new t}();r.prototype.smash=function(){return this.base.prototype.smash.call(this)};r.prototype.addDependency=function(n){return this.base.prototype.smash.addDependency(this,n)};r.prototype.removeDependency=function(n){return this.base.prototype.smash.removeDependency(this,n)};r.prototype.asLocalReference=function(){var n=this.myName+"@"+this.owner.myName;return this.owner.owner&&(n+="."+this.owner.owner.myName),n};n.Counter=r}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n,t){var i=function(n,t,i){this.elements=n?n:[];this.baseSpec=t;this.uponCreation=i};i.prototype={createCollection:function(i){var r=this.baseSpec,f=this.elements.map(function(u){var f=u,e=u.spec?u.spec:n.utils.isObject(u)?u:t,o=u.myName?u.myName:n.utils.isString(u)?u:t;return n.utils.isaComponent(f)||(f=n.makeComponent(r?r:e,t,i),r!==t&&f.extendWith(e),o&&(f.myName=o)),f.myParent=f.myParent?f.myParent:i,f}),u=n.makeCollection(f,i);return this.uponCreation&&u.forEach(this.uponCreation),u},createSubcomponents:function(i){var r=this.baseSpec,u=this.elements.map(function(u){var f=u,e=u.spec?u.spec:n.utils.isObject(u)?u:t,o=u.myName?u.myName:n.utils.isString(u)?u:t;return n.utils.isaComponent(f)?i.addSubcomponent(f):(f=i.createSubcomponent(r?r:e),r!==t&&f.extendWith(e),o&&(f.myName=o)),f});return this.uponCreation&&u.forEach(this.uponCreation),u}};n.CollectionSpec=i;n.utils.isaCollectionSpec=function(t){return t instanceof n.CollectionSpec?!0:!1}}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n,t){var r=function(i,r,u){this.myName=t;this.owner=r;this.elements=i===t?[]:i;this.withDependencies=!0;var f=new n.Counter(this);return u&&n.utils.extendWithComputedValues(this,u),this},i;r.prototype={getID:function(){return this.guid?this.guid:(this.guid=n.utils.createID(this.myName),this.guid)},globalComputeStack:function(){return this.owner?this.owner.globalComputeStack():t},currentComputingProperty:function(){var n=this.globalComputeStack();return n&&n.peek()},findByName:function(n){return this.firstWhere(function(t){return t.myName&&t.myName.matches(n)})},stringify:function(n){function r(n,i){switch(n){case"owner":case"myParent":return i?i.asReference():i;case"thisValueDependsOn":case"thisInformsTheseValues":case"uiBindings":case"onRefreshUi":case"trace":return t}return i}var i=n||this;return JSON.stringify(i,r,3)},getSpec:function(n){if(this.count==0)return t;return this.elements.map(function(t){return t.getSpec(n)})},asReference:function(){return this.owner===t?this.myName?this.myName:"collection":this.owner.asReference()+"."+this.myName},smash:function(){var n=this._count;n.status&&(fo.publishNoLock("smash",[n]),n.smash())},purgeBindings:function(n){var t=!1;return this.elements.forEach(function(i){t=i.purgeBindings(n)||t}),t},resolveProperty:function(n){alert("please bind to a data-repeater"+n)},resolveSuperior:function(t){if(this.myName.match(t)||n.utils.isSelf(t))return this;return this.owner.resolveSuperior(t)},resolvePropertyReference:function(i){var r={},o=this,e,f,u;return i.containsString("#")?(e=i.split("#"),r=this.resolvePropertyReference(e[0]),r.meta=e[1],r):(f=o.getProperty(i),u=t,f===t?u=o[i]:(r.property=f,f.status&&(u=f.value)),n.utils.isaCollection(u)?r.collection=u:n.utils.isaComponent(u)&&(r.component=u),r)},getProperty:function(n,t){var r="_"+n,i=this[r];return i?i:t&&this.myParent?this.myParent.getProperty(n,t):i},smashProperty:function(n,t){var i=this.getProperty(n,t);return i&&i.status&&i.smash(),i},smashPropertyTree:function(n){var i=this.smashProperties(n),t=this.myParent;return t?t.smashPropertyTree(n):i},smashPropertyBranch:function(n){this.smashProperties(n);this.Subcomponents.forEach(function(t){t.smashPropertyBranch(n)})},smashProperties:function(n,t){var i=this,r=fo.utils.isArray(n)?n:n.split(",");return r.forEach(function(n){i.smashProperty(n,t)}),i},getMetaData:function(i,r){if(i===t||this[i]===t)return r;var u=r,f=this[i];return(n.utils.isFunction(f)?u=f.call(this):f!==t&&(u=f),n.utils.isaPromise(u)&&r!==t)?r:u},getMetaDataAsync:function(t,i){var u=this.getMetaData(t,i),r;return n.utils.isaPromise(u)?u:(r=new Promise(this.owner,t),r.value=this,r)},setMetaData:function(n,i){return n!==t&&(this[n]=i),this},getValue:function(n){return n!==t,this},push:function(n){return n&&(this.elements.push(n),this.smash()),n},addList:function(n){return n&&(this.elements=this.elements.concat(n),this.smash()),this},addNoDupe:function(n){return n&&(this.elements.addNoDupe(n),this.smash()),n},prependNoDupe:function(n){return n&&(this.elements.prependNoDupe(n),this.smash()),n},insertNoDupe:function(n,t){return t&&this.elements.indexOf(t)==-1&&(this.elements.insert(n,t),this.smash()),t},pop:function(){var n=this.elements.pop();return this.smash(),n},peek:function(){if(this.elements&&this.elements.length>0){var n=this.elements.length-1;return this.elements[n]}},item:function(n){return this.elements[n]},first:function(){return this.elements.length>0?this.elements[0]:t},last:function(){var n=this.elements.length-1;return n>=0?this.elements[n]:t},next:function(n,t){var i=this.indexOf(n)+1;return i>=this.elements.length?t?this.first():n:this.elements[i]},previous:function(n,t){var i=this.indexOf(n)-1;return i<0?t?this.last():n:this.elements[i]},add:function(i){if(i===t)return i;if(n.utils.isArray(i))for(var r=0;r<i.length;r++)this.elements.push(i[r]);else this.elements.push(i);return this.smash(),i},reset:function(n){return this.clear(),this.add(n)},remove:function(n){var t=this.elements.length,i=this.elements.removeItem(n).length;return t!==i&&this.smash(),n},removeWhere:function(n){for(var i=this.filter(n).elements,t=0;t<i.length;t++)this.remove(i[t]);return this},sumOver:function(n){return this.reduce(function(n,t){return n+t},n?n:0)},commaDelimited:function(n){var t=n?n:",";return this.reduce(function(n,i){return n+(i+t)},"")},slice:function(n,t){return this.elements.slice(n,t)},members:function(){return this.copyTo([])},membersWhere:function(i,r){var u=r===t?n.makeCollection([],this):r;return this.count>0&&this.copyWhere(i,u),u},isEmpty:function(){return this.elements.isEmpty()},isNotEmpty:function(){return this.elements.isNotEmpty()},copyTo:function(n){for(var i=n?n:[],t=0;t<this.elements.length;t++)i.push(this.elements[t]);return i},copyWhere:function(n,i){for(var u,e,f=i?i:[],r=0;r<this.elements.length;r++)u=this.elements[r],e=n==t?!0:n(u),e&&f.push(u);return f},firstWhere:function(n){for(var r,u,i=0;i<this.elements.length;i++)if(r=this.elements[i],u=n==t?!0:n(r),u)return r},clear:function(){this.elements=[];this.smash()},indexOf:function(n){return this.elements.indexOf(n)},indexOfFirst:function(n){return this.elements.indexOfFirst(n)},itemByIndex:function(n){return this.elements.itemByIndex(n)},duplicate:function(){var t=n.makeCollection();return this.count===0?t:(this.copyTo(t),t)},filter:function(t){var i=n.makeCollection();return this.count===0?i:this.copyWhere(t,i)},sortOn:function(t){var i=!1,r;return t&&(r=this.elements.sort(function(n,r){var u=n[t]<r[t]?-1:n[t]>r[t]?1:0;return u<0&&(i=!0),u})),i&&(this.elements=r,n.trace&&n.trace.error("SORTING SMASHED THE COLLECTION"),this.smash()),this},forEach:function(n){return this.count===0?t:this.elements.forEach(n)},map:function(n){return this.count===0?this.elements:this.elements.map(n)},reduce:function(n,i){return this.count===0?t:this.elements.reduce(n,i)},mapReduce:function(n,t,i){return this.elements.map(n).reduce(t,i)},sumAll:function(t,i){var r=n.utils.pluck(t),u=function(n,t){return n+t};return this.elements.map(r).reduce(u,i?i:0)},maxAll:function(i,r){var u=n.utils.pluck(i),f=function(n,t){return Math.max(n,t)};return this.elements.map(u).reduce(f,r!==t?r:-Infinity)},minAll:function(i,r){var u=n.utils.pluck(i),f=function(n,t){return Math.min(n,t)};return this.elements.map(u).reduce(f,r!==t?r:Infinity)},selectComponents:function(i,r){var f=r===t?n.makeCollection([],this):r,u,e;if(this.count>0)for(this.copyWhere(i,f),u=0;u<this.elements.length;u++)e=this.elements[u],e.selectComponents(i,f);return f}};i=function(t,i,u){this.base=r;var f=n.utils.isaCollection(t)?t.elements:t;return this.base(f,i),this.indexName=u,this.sortOn(this.indexName),this.synchronizeElements(),this};i.prototype=function(){var n=function(){this.constructor=i};return n.prototype=r.prototype,new n}();i.prototype.setItemIndex=function(i,r){return this.indexName===t?i:(i[this.indexName]!==t?i[this.indexName]=r:n.utils.isaComponent(i)?i.createProperty(this.indexName,r):i[this.indexName]=r,i)};i.prototype.synchronizeElements=function(){for(var i,t=this.elements,n=0;n<t.length;n++)i=t[n],this.setItemIndex(i,n);this.markForRefresh()};i.prototype.markForRefresh=function(){return n.markForRefresh(this.getProperty("count")),this};i.prototype.addItem=function(n){var t=this.add(n);return this.setItemIndex(t,this.elements.length-1),this.markForRefresh(),n};i.prototype.removeItem=function(n){var t=this.remove(n);return n.getProperty(this.indexName)&&n.deleteProperty(this.indexName),delete t[this.indexName],this.synchronizeElements(),t};i.prototype.swapItemTo=function(n,i){if(i<0||i>this.count-1||isNaN(i))return n;var u=this.elements[i],r=n[this.indexName];return r!==t&&(this.elements[i]=this.setItemIndex(n,i),this.elements[r]=this.setItemIndex(u,r),this.markForRefresh()),n};n.Collection=r;n.OrderedCollection=i}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n,t){function u(n){return n+"Begin"}function f(n){return n+"Complete"}function s(t,i,r){var u=new Blob([t],{type:"text/plain;charset=utf-8"});n.writeBlobFile(u,i,r)}var o=function(i,r,u){var f,e;return this.myName=t,this.myParent=u,this.myType="Component",this.withDependencies=!0,f=i&&i.uponCreation,f&&delete i.uponCreation,this.establishCollection("Properties",this.createParameters(i)),this.simpleProperty("myType"),this.simpleProperty("myName"),this.establishCollection("Subcomponents",this.createSubparts(r)),f&&(i.uponCreation=f,e=n.utils.isFunction(f)?f.call(this):f,n.utils.isaCollectionSpec(e)&&e.createSubcomponents(this)),this},e=[],i,r;o.prototype={toString:function(){return this.getID()+", |"+this.myName+"| type: "+this.myType},globalComputeStack:function(){return e},currentComputingProperty:function(){return e&&e.peek()},isType:function(n){return n===this.myType?!0:this.myType?n&&n.matches(this.myType):!1},isOfType:function(n){var i=this.isType(n),t;return i?!0:(t=this.myType.split("::"),t=t.length==2?t[1]:t[0],n&&n.matches(t))},createProperty:function(t,i){return new n.Property(this,t,i)},createParameters:function(n){var r=[],i,u,f;if(n!==t)for(i in n)n.hasOwnProperty(i)&&(u=n[i],f=this.createProperty.call(this,i,u),r.push(f));return r},createSubparts:function(i){var u=[],r;return n.utils.isArray(i)&&(r=this,u=i.map(function(i){var e=i.spec?i.spec:t,o=i.Subcomponents?i.Subcomponents:t,f=i.dependencies?i.dependencies:t,u=n.makeComponent(e,o,r);return i.myName&&(u.myName=i.myName),u.withDependencies=f?f:r.withDependencies,u})),u},establishCollection:function(t,i,r){var u=this[t];return n.utils.isaCollection(u)||(u=n.makeCollection(i,this,r),u.withDependencies=this.withDependencies,u.myName=t,this[t]=u),u},rootComponent:function(n){if(n&&this[n])return this[n];var i=this.myParent;return i===t?this:i.rootComponent(n)},getID:function(){return this.guid?this.guid:(this.guid=n.utils.createID(this.myName),this.guid)},setName:function(n){return this.myName=n,this},componentDepth:function(){return this.myParent?1+this.myParent.componentDepth():0},branchDepth:function(){var t=this.Subcomponents.first(),n;return t?(n=t.branchDepth(),this.Subcomponents.forEach(function(t){n=Math.max(t.branchDepth(),n)}),1+n):0},createSlots:function(n,i){var u=[],r;if(i!=t)for(r in i)this.getProperty(r)||(this[r]=i[r],u.push(r));return u},getProperty:function(n,t){var r="_"+n,i=this[r];return i?i:t&&this.myParent?this.myParent.getProperty(n,t):i},smashProperty:function(n,t){var i=this.getProperty(n,t);return i&&i.status&&i.smash(),i},smashPropertyTree:function(n){var i=this.smashProperties(n),t=this.myParent;return t?t.smashPropertyTree(n):i},smashPropertyBranch:function(n){this.smashProperties(n);this.Subcomponents.forEach(function(t){t.smashPropertyBranch(n)})},smashProperties:function(n,t){var i=this,r=fo.utils.isArray(n)?n:n.split(",");return r.forEach(function(n){i.smashProperty(n,t)}),i},deleteProperty:function(n){var i="_"+n,t=this[i];t&&(t.smash(),this.Properties.remove(t),delete this[i],delete this[n])},establishProperty:function(n,i,r){var u=this.getProperty(n);return u===t&&(u=this.createProperty(n,i),u.onValueSmash=r),u},simpleProperty:function(n,i){var r=this.getProperty(n),u;r!==t?(u=i?i:r.getValue(),this.deleteProperty(n),this[n]=u):i&&(this[n]=i)},asReference:function(){return this.myParent===t?"root":this.myName+"."+this.myParent.asReference()},superior:function(n){return n.matches(this.myName)?this:this.myParent?this.myParent.superior(n):void 0},findParentWhere:function(n){return n.call(this,this)?this:this.myParent?this.myParent.findParentWhere(n):void 0},getValueOf:function(n,i){var r=this.getProperty(n,!0),u=r?r.getValue():t;return u?u:i},resolveSuperior:function(t,i){var u=this,r;return n.utils.isSelf(t)?u:(r=this.getProperty(t),r)?r.getValue(i):(r=this[t],!r&&this.myParent)?this.myParent.resolveSuperior(t,i):r},resolveReference:function(i){var u=this,f,s,r,e,o;if(n.utils.isSelf(i))return u;if(f=i.split("@"),f.length==2&&f[1]!="")return this.resolveReference(f[1]);for(s=f[0].split("."),r=t,e=0;e<s.length;e++)o=s[e],r=u.getSubcomponent(o),r===t?(r=u.getProperty(o),r===t&&(u=u[o])):u=r;return r},resolvePropertyReference:function(i){var r={},h,e,s,f,u;if(i.begins("(")&&i.ends(")"))return h="return {0}; ".format(i),r.formula=new Function(h),r;if(i.begins("{")&&i.ends("}"))return r.JSON=JSON.parse(i),r;if(e=this,i.startsWith("@"))return u=this.resolveReference(i),n.utils.isaCollection(u)?r.collection=u:n.utils.isaComponent(u)?r.component=u:n.utils.isaProperty(u)?r.property=u:u&&(r.found=u),r;if(i.endsWith("@")){for(var c=i.substring(0,i.length-1),o=e.myParent,f=e.getProperty(c);f===t&&o;)f=o.getProperty(c),o=o.myParent;return r.property=f,r}return i.containsString("#")?(s=i.split("#"),r=this.resolvePropertyReference(s[0]),r.meta=s[1],r):i.startsWith("_")?(u=e[i],u&&(r.propertyPeek=u),r):(f=e.getProperty(i),u=t,f===t?u=e[i]:(r.property=f,f.status&&(u=f.value)),n.utils.isaCollection(u)?r.collection=u:n.utils.isaComponent(u)?r.component=u:u&&(r.slot=u),r)},resolveProperty:function(i){var e,f;if(i.ends("?"))return this.resolveProperty(i.substring(0,i.length-1));if(i.begins("?"))return this.resolveProperty(i.substring(1));if(i.begins("(")||i.begins("{")||!i.containsString("."))return this.resolvePropertyReference(i);var r=t,o=i.split("."),u=this;for(e=0;e<o.length;e++)f=o[e].trim(),r=u.resolvePropertyReference?u.resolvePropertyReference(f):t,r===t?u=u[f]:r.component?u=r.component:r.collection?u=r.collection:r.property&&r.property.status?u=r.property.getValue():n.utils.isaComponent(u)?(r.component=u.getSubcomponent(f),u=r.component?r.component:u[f]):u=u[f];return r},removeFromModel:function(){var n=this;return n.myParent&&n.myParent.removeSubcomponent(n),n.purgeBindings(!0),n},deleteAndPurge:function(){var n=this;n.removeFromModel()},purgeBindings:function(n){var t=!1;return this.Properties.forEach(function(i){t=i.purgeBindings(n)||t}),this.Subcomponents.forEach(function(i){t=i.purgeBindings(n)||t}),t},stringify:function(n){function r(n,i){switch(n){case"owner":case"myParent":case"source":case"target":return i?i.asReference():i;case"thisValueDependsOn":case"thisInformsTheseValues":case"uiBindings":case"onRefreshUi":return t}return i}var i=n||this;return JSON.stringify(i,r,3)},rehydrate:function(n,t,i,r){var u=this,f={};return t.forEach(function(t){var s=t.uniqueID?t.uniqueID:t.myName,c,h,e,o;if(t.myType=r?r(t):t.myType,c=t.parentHydrateId,delete t.parentHydrateId,h=t.Subcomponents,h&&delete t.Subcomponents,e=u,o=e.getSubcomponent(s),!o&&c&&(e=n.getSubcomponent(c,!0),e?o=e.getSubcomponent(s):e=u),o||(o=fo.make(t,e),e.getSubcomponent(s)&&alert("rehydrateing: We have a problem"),e.addSubcomponent(o,s)),i[s]=f[s]=o,h)try{o.rehydrate(n,h,i,r)}catch(l){fo.trace&&fo.trace.exception("rehydrate",l)}}),f},dehydrate:function(i,r){var u=this,f=u.myType?{myType:u.myType}:{},e,o;return u.myName&&(f.myName=u.myName),u.myParent&&u.myParent.myName&&(f.parentHydrateId=u.myParent.myName),e=r?Object.keys(r):[],u.Properties.forEach(function(i){var o=i.myName,h=e.contains(o),s,u;(!h||r[o])&&((s="given".matches(i.status)?!1:i.formula!==t,s)||(u=i.value,n.utils.isaComponent(u)||n.utils.isaCollection(u))||(f[o]=u))}),i&&u.Subcomponents.count>0&&(o=u.Subcomponents.map(function(n){return n.dehydrate(i,r)}),f.Subcomponents=o),f},makePartOfSpec:function(n,t){var i="_"+n;this[i]&&(this[i].canExport=t?t:!0)},exportValues:function(){var t={},n,i;for(n in this)n.startsWith("_")||(i=this[n],fo.utils.isObject(i)||(t[n]=this[n]));return t},getSpec:function(i){var r=this.myType?{myType:this.myType}:{};return this.myName&&(r.myName=this.myName),this.Properties.forEach(function(u){var o="given".matches(u.status)?!1:u.formula!==t,f,e;(!o||u.canExport)&&(r=r||{},f=u.value,(n.utils.isaComponent(f)||n.utils.isaCollection(f))&&(f=f.getSpec(i)),e=u.myName,f!==t?r[e]=f:u.canExport&&(r[e]=u.getValue()))}),i&&this.Members&&this.Members.forEach(function(t){if(t.count!=0){r=r||{};var u=t;(n.utils.isaComponent(u)||n.utils.isaCollection(u))&&(u=u.getSpec(i));u&&(r[t.myName]=u)}}),r},doCommand:function(t,i){if(n.utils.isFunction(t))return n.runWithUIRefreshLock(t);var r=this.getProperty(t,!0),u=i?i:this;return r&&r.doCommand(u)},redefine:function(n,t){var i="_"+n;this[i]?this[i].redefine(t):(property=this.createProperty.call(this,n,t),this.Properties.push(property))},createView:function(n){return this.Properties.map(function(t){return t.createView(n)})},extendUi:function(n){var i=this;for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return this},extendWith:function(n){for(var t in n)n.hasOwnProperty(t)&&this.redefine(t,n[t]);return this},extendProperties:function(t){var u=[],i,r,f;for(i in t)t.hasOwnProperty(i)&&(r=this.getProperty(i),r&&(f=n.utils.asArray(t[i]),f.forEach(function(n){r.extendWith(n)}),u.push(r)));return u},subscribeToCommands:function(){var n=this,t=Object.keys(n);t.forEach(function(t){(t.startsWith("do")||t.startsWith("goto"))&&fo.subscribe(t,function(){n[t]})})},definePropertyViews:function(t){var i,r,u;for(i in t)t.hasOwnProperty(i)&&(r=this.getProperty(i),r&&(u=n.utils.asArray(t[i]),u.forEach(function(n){for(var t in n)n.hasOwnProperty(t)&&r.extendUi(n[t],t)})));return[]},establishManagedProperty:function(n,t){var i=this.getProperty(n);return i?(i.redefine(t),i):this.replaceManagedProperty(n,t)},replaceManagedProperty:function(n,t){this.deleteProperty(n);var i=this.createProperty(n,t);return this.Properties&&this.Properties.push(i),i},establishManagedProperties:function(n){var t=this.createParameters(n);return this.establishCollection("Properties",t)},doSubcomponentRefresh:function(n){var t=this.Subcomponents.getProperty("count");t.updateBindings();n&&this.Subcomponents.forEach(function(n){n.doSubcomponentRefresh()})},onPropertyRefresh:function(n,t){var i=this.getProperty(n);return i&&(i.onRefreshUi=t),i},onPropertySmash:function(n,t){var i=this.getProperty(n);i&&(i.onValueSmash=t)},onPropertyValueSet:function(n,t){var i=this.getProperty(n);i&&(i.onValueSet=t)},addOnRefresh:function(t,i){var r=this.onPropertyRefresh(t,i);return r&&n.markForRefresh(r),r},addPropertyConstraint:function(n){function i(n,i,r){var f,u;if(n){f=this;for(u in t)f.myName.matches(u)||(r[u]=!1)}}var t=n;for(var r in t)this.onPropertyValueSet(r,i)},addBinding:function(n,t){var i=this.getProperty(n),r=i.uiBindings?i.uiBindings.length:0;return i?i.addBinding(t,!0):i},applyToSelfAndParents:function(n){var i=n.call(this,this),t=this.myParent;return t&&t.applyToSelfAndParents(n),i},applyToSelfAndChildren:function(n,t){var i=n.call(this,this);return this.applyToChildren(n,t),i},applyToChildren:function(n,t){this.Subcomponents.forEach(function(i){n.call(i,i);t&&i.applyToChildren(n,t)})},applyToSiblings:function(n,t){var i=this,r=this.myParent;return r.Subcomponents.forEach(function(r){i!=r&&(n.call(r,r),t&&r.applyToChildren(n,t))}),result},applyToSelfAndSiblings:function(n,t){var i=this.myParent;i.Subcomponents.forEach(function(i){n.call(i,i);t&&i.applyToChildren(n,t)})},capture:function(n,t,i){return this.captureSubcomponent(n,t,i)},canCaptureSubcomponent:function(t){return n.utils.isaComponent(t)?!0:!1},captureSubcomponent:function(t,i,r){var f=this,u=t.myParent;if(f.canCaptureSubcomponent(t))return n.runWithUIRefreshLock(function(){i&&(t.myName=i,r&&(f[i]=t));u&&(u.removeSubcomponent(t),r&&delete u[i]);f.addSubcomponent(t)}),u},pushSubcomponent:function(n,t){return n.myParent=this,t&&(n.myName=t),this.Subcomponents.push(n),n},addSubcomponent:function(t,i,r){if(n.utils.isaComponent(t))return t.myParent=this,i&&(t.myName=i),r?this.Subcomponents.prependNoDupe(t):this.Subcomponents.addNoDupe(t),t},insertSubcomponent:function(t,i,r){if(n.utils.isaComponent(i))return i.myParent=this,r&&(i.myName=r),this.Subcomponents.insertNoDupe(t,i),i},captureInsertSubcomponent:function(t,i,r){var f=this,u=i.myParent;if(f.canCaptureSubcomponent(i))return n.runWithUIRefreshLock(function(){r&&(i.myName=r);u&&u.removeSubcomponent(i);f.insertSubcomponent(t,i)}),u},removeSubcomponent:function(i){if(n.utils.isaComponent(i))return i.myParent===this&&(i.myParent=t),this.Subcomponents.remove(i),i},removeAllSubcomponents:function(){if(this.Subcomponents.count!=0){var n=this.Subcomponents.elements.duplicate();return n.forEach(function(n){n.myParent===this&&(n.myParent=t)}),this.Subcomponents.clear(),n}},createSubcomponent:function(i,r){var u=n.makeComponent(i,t,this);return u.withDependencies=r?r:this.withDependencies,this.addSubcomponent(u),u},getSubcomponent:function(n,t){var u=this.Subcomponents.findByName(n),i,f,r;if(u||!t||!n)return u;if(n.matches(this.myName))return this;for(i=0;i<this.Subcomponents.count;i++)if(f=this.Subcomponents.item(i),r=f.getSubcomponent(n,t),r)return r},establishSubcomponent:function(i,r){var f=this.getSubcomponent(i),u;return f||(u=n.makeComponent(r,t,this),u.myName||(u.myName=i),u.withDependencies=this.withDependencies,f=this.Subcomponents.addNoDupe(u)),f},forEachSubcomponent:function(n,t){this.Subcomponents.forEach(function(i){(n.call(i,i),t)||i.forEachSubcomponent(n,t)})},selectComponents:function(i,r){var f=r===t?n.makeCollection([],this):r,u,e;if(this.Subcomponents.count>0)for(this.Subcomponents.copyWhere(i,f),u=0;u<this.Subcomponents.count;u++)e=this.Subcomponents.item(u),e.selectComponents(i,f);return f},membersWhere:function(n,t){return this.Subcomponents.membersWhere(n,t)},appendTo:function(i,r){var u=this.establishCollection(i),f=this,e=n.utils.asArray(r).map(function(i){var r=i;return n.utils.isaComponent(r)?r.myParent=r.myParent?r.myParent:f:r=n.makeComponent(i,t,f),r});return u.addList(e),u},makeMembers:function(i,r){var u=this.establishCollection(i),f,e;return this.establishCollection("Members").addNoDupe(u),f=this,e=n.utils.asArray(r).map(function(i){var r=i,o,u,e;if(!n.utils.isaComponent(r)){o=n.utils.extractSlots(i,function(t){return!n.utils.isArray(t)});r=n.makeComponent(o,t,f);u=n.utils.extractSlots(i,function(t){return n.utils.isArray(t)});for(e in u)r.makeMembers(e,u[e])}return r.myParent=r.myParent?r.myParent:f,r}),u.addList(e),u},myIndex:function(){if(this.mySiblingTotal()<0)return-1;return this.myParent.Subcomponents.indexOf(this)},mySiblingTotal:function(){if(!this.myParent)return-1;return this.myParent.Subcomponents.count},mySiblingPrevious:function(){var n=this.myIndex();return n<0?t:(n-=1,this.myParent.Subcomponents.itemByIndex(n))},mySiblingNext:function(){var n=this.myIndex();return n<0?t:(n+=1,n>this.mySiblingTotal)?t:this.myParent.Subcomponents.itemByIndex(n)},mySiblingsBefore:function(){var t=this.myIndex(),r=n.makeCollection([],this.myParent),u,i;if(t<0)return r;if(u=this.myParent.Subcomponents.elements,t>=0&&t<u.length)for(i=0;i<t;i++)r.push(u[i]);return r},mySiblingsAfter:function(){var t=this.myIndex(),u=n.makeCollection([],this.myParent),i,r;if(t<0)return u;if(i=this.myParent.Subcomponents.elements,t>=0&&t<i.length)for(r=t+1;r<i.length;r++)u.push(i[r]);return u},mySiblings:function(){var u=this.myIndex(),i=n.makeCollection([],this.myParent),r,t;if(u<0)return i;for(r=this.myParent.Subcomponents.elements,t=0;t<r.length;t++)t!=u&&i.push(r[t]);return i},mySiblingsMaxValue:function(n,t,i){var f=this.myIndex(),r,u;return f<0?t:(r=this.myParent.Subcomponents.filter(i),u=r.maxAll(n,t),u)}};n.isDialogOpen=!1;n.Component=o;n.fromParent=function(n){var i=this.myParent,r;if(!i)throw new Error("the property "+n+" does not have a parent");if(i&&i.resolveSuperior?r=i.resolveSuperior(n):i&&(r=i[n]),r===t)throw new Error("the property "+n+" does not exist on the parent");return r};n.makeComponent=function(t,i,r){return new n.Component(t,i,r)};n.makeModel=function(t,i){var r=n.makeComponent(t.spec,t.Subcomponents,i);return r.myName=t.myName,r.myParent=i,r};n.makeCollection=function(t,i,r){return new n.Collection(t,i,r)};n.makeOrderedCollection=function(t,i,r){return new n.OrderedCollection(t,i,r)};n.makeCollectionSpec=function(t,i,r){return new n.CollectionSpec(t,i,r)};n.doCommand=function(t,i,r){if(i)return n.runWithUIRefreshLock(function(){i.doCommand(t);r&&r()}),!0};n.stringifyPayload=function(n){return JSON.stringify(n)};n.parsePayload=function(n){return JSON.parse(n)};i={};n.publishNoLock=function(r,u){if(i[r]===t)return!1;var f=!0;return i[r].forEach(function(t){try{t.apply(r,u||[])}catch(i){n.trace&&n.trace.log(i);f=!1}}),f};n.publish=function(t,i){n.publishNoLock(u(t),i);n.publishNoLock(t,i);n.publishNoLock(f(t),i)};n.subscribe=function(n,t){return i[n]||(i[n]=[]),i[n].push(t),[n,t]};n.subscribeBegin=function(t,i){n.subscribe(u(t),i)};n.subscribeComplete=function(t,i){n.subscribe(f(t),i)};n.unsubscribe=function(n){var t=n[0];i[t]&&i[t].forEach(function(r){this==n[1]&&i[t].splice(r,1)})};n.unsubscribeBegin=function(t,i){n.unsubscribe(u(t),i)};n.unsubscribeComplete=function(t,i){n.unsubscribe(f(t),i)};n.flushPubSubCache=function(n){delete i[u(n)];delete i[n];delete i[f(n)]};n.uiRefreshLock=0;n.globalUIRefreshLock=function(t){return n.uiRefreshLock=n.uiRefreshLock+t,n.uiRefreshLock==0,n.uiRefreshLock};r=[];n.markForRefresh=function(t){n.uiRefreshLock>0?r.addNoDupe(t):t.refreshUi()};n.globalUIReleaseAndRefresh=function(i){var f=n.globalUIRefreshLock(0),u,e;f==0&&r.length>0&&(u=r,r=[],e=this,n.globalUIRefreshLock(1),u.forEach(function(n){n.refreshUi()}),u=t,n.globalUIRefreshLock(-1));r.length==0&&i&&i()};n.runWithUIRefreshLock=function(t,i){var f=n.globalUIRefreshLock(1),r=t(),u=n.globalUIRefreshLock(-1);return u==0&&n.globalUIReleaseAndRefresh(i),r};n.UIRefreshLock=function(t,i){return function(){return n.runWithUIRefreshLock(function(){t[i]}),t[i]}};n.writeBlobFile=function(n,t,i){var r=t+i;saveAs(n,r)};n.writeTextFileAsync=function(n,t,i,r){if(s(n,t,i),r){r(n,t,i);return}fo.publish("textFileSaved",[n,t,i])};fo.readTextFileAsync=function(n,t,i){var r=new FileReader;r.onload=function(r){var e=n.name,u=e.replace(t,""),f=r.target.result;if(i){i(f,u,t);return}fo.publish("textFileDropped",[f,u,t])};r.readAsText(n)};fo.readImageFileAsync=function(n,t,i){var r=new FileReader;r.onload=function(r){var e=n.name,u=e.replace(t,""),f=r.target.result;if(i){i(f,u,t);return}fo.publish("imageFileDropped",[f,u,t])};r.readAsDataURL(n)};n.enableFileDragAndDrop=function(t){function r(n){n.stopPropagation();n.preventDefault()}function u(n){var s;n.stopPropagation();n.preventDefault();var r=n.dataTransfer,f=r.getData("Text"),u=r.getData("URL"),e=r.files,o=e.length,t=o>0&&e[0],i=t?t.name.match(/\.[0-9a-z]+$/i):[""];i=i[0];s=t&&t.name.replace(i,"");t&&t.type.startsWith("image")?fo.readImageFileAsync(t,i):t&&(i.matches(".knt")||i.matches(".csv")||i.matches(".json")||i.matches(".txt"))?fo.readTextFileAsync(t,i):u&&u.startsWith("http")?fo.publish("urlDropped",[u]):f&&fo.publish("textDropped",[f])}var i=n.utils.isString(t)?document.getElementById(t):t;return i.addEventListener("dragenter",r,!1),i.addEventListener("dragexit",r,!1),i.addEventListener("dragover",r,!1),i.addEventListener("drop",u,!1),i}}(Foundry);Foundry=Foundry||{};fo=Foundry,function(n){var t=function(t,i){this.base=n.Collection;var r=n.utils.isaCollection(t)?t.elements:t;return this.base(r,i),this};t.prototype=function(){var i=function(){this.constructor=t};return i.prototype=n.Collection.prototype,new i}();n.Relationship=t;n.makeRelationship=function(t,i,r){return new n.Relationship(t,i,r)};n.Component.prototype.establishRelationship=function(t,i,r){var u=this[t];return n.utils.isaRelationship(u)||(u=n.makeRelationship(i,this,r),u.withDependencies=this.withDependencies,u.myName=t,this[t]=u),u};n.makeRelation=function(n,t){if(n&&t){var r=this,i=n.establishRelationship(r.myName);return i.addNoDupe(t),i}};n.unmakeRelation=function(n,t){var i,r;if(n&&t)return(i=this,!n[i.myName])?void 0:(r=n.establishRelationship(i.myName),r.remove(t),r.isEmpty()&&delete n[i.myName],r)}}(Foundry);
/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
(function(n){if(typeof bootstrap=="function")bootstrap("promise",n);else if(typeof exports=="object")module.exports=n();else if(typeof define=="function"&&define.amd)define(n);else if(typeof ses!="undefined")if(ses.ok())ses.makeQ=n;else return;else Q=n()})(function(){"use strict";function h(n){return function(){return kt.apply(n,arguments)}}function ut(n){return n===Object(n)}function ii(n){return ti(n)==="[object StopIteration]"||n instanceof b}function ft(n,t){var r,i,u;if(a&&t.stack&&typeof n=="object"&&n!==null&&n.stack&&n.stack.indexOf(d)===-1){for(r=[],i=t;!!i;i=i.source)i.stack&&r.unshift(i.stack);r.unshift(n.stack);u=r.join("\n"+d+"\n");n.stack=ri(u)}}function ri(n){for(var t,r=n.split("\n"),u=[],i=0;i<r.length;++i)t=r[i],fi(t)||ui(t)||!t||u.push(t);return u.join("\n")}function ui(n){return n.indexOf("(module.js:")!==-1||n.indexOf("(node.js:")!==-1}function et(n){var r=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(n),t,i;return r?[r[1],Number(r[2])]:(t=/at ([^ ]+):(\d+):(?:\d+)$/.exec(n),t)?[t[1],Number(t[2])]:(i=/.*@(.+):(\d+)$/.exec(n),i?[i[1],Number(i[2])]:void 0)}function fi(n){var t=et(n),r,i;return t?(r=t[0],i=t[1],r===it&&i>=bt&&i<=pt):!1}function ot(){if(a)try{throw new Error;}catch(i){var n=i.stack.split("\n"),r=n[0].indexOf("@")>0?n[1]:n[2],t=et(r);return t?(it=t[0],t[1]):void 0}}function ei(n,t,i){return function(){return typeof console!="undefined"&&typeof console.warn=="function"&&console.warn(t+" is deprecated, use "+i+" instead.",new Error("").stack),n.apply(n,arguments)}}function n(n){return o(n)?n:ct(n)?yi(n):tt(n)}function r(){function y(n){e=n;s.source=n;v(c,function(t,i){u(function(){n.promiseDispatch.apply(n,i)})},void 0);c=void 0;l=void 0}var c=[],l=[],e,h=w(r.prototype),s=w(t.prototype);if(s.promiseDispatch=function(n,t,r){var f=i(arguments);c?(c.push(f),t==="when"&&r[1]&&l.push(r[1])):u(function(){e.promiseDispatch.apply(e,f)})},s.valueOf=function(){if(c)return s;var n=ht(e);return o(n)&&(e=n),n},s.inspect=function(){return e?e.inspect():{state:"pending"}},n.longStackSupport&&a)try{throw new Error;}catch(p){s.stack=p.stack.substring(p.stack.indexOf("\n")+1)}return h.promise=s,h.resolve=function(t){e||y(n(t))},h.fulfill=function(n){e||y(tt(n))},h.reject=function(n){e||y(f(n))},h.notify=function(n){e||v(l,function(t,i){u(function(){i(n)})},void 0)},h}function st(n){if(typeof n!="function")throw new TypeError("resolver must be a function.");var t=r();try{n(t.resolve,t.reject,t.notify)}catch(i){t.reject(i)}return t.promise}function oi(t){return st(function(i,r){for(var u=0,f=t.length;u<f;u++)n(t[u]).then(i,r)})}function t(n,i,r){var u,e;return i===void 0&&(i=function(n){return f(new Error("Promise does not support operation: "+n))}),r===void 0&&(r=function(){return{state:"unknown"}}),u=w(t.prototype),u.promiseDispatch=function(t,r,e){var o;try{o=n[r]?n[r].apply(u,e):i.call(u,r,e)}catch(s){o=f(s)}t&&t(o)},u.inspect=r,r&&(e=r(),e.state==="rejected"&&(u.exception=e.reason),u.valueOf=function(){var n=r();return n.state==="pending"||n.state==="rejected"?u:n.value}),u}function e(t,i,r,u){return n(t).then(i,r,u)}function ht(n){if(o(n)){var t=n.inspect();if(t.state==="fulfilled")return t.value}return n}function o(n){return ut(n)&&typeof n.promiseDispatch=="function"&&typeof n.inspect=="function"}function ct(n){return ut(n)&&typeof n.then=="function"}function si(n){return o(n)&&n.inspect().state==="pending"}function hi(n){return!o(n)||n.inspect().state==="fulfilled"}function ci(n){return o(n)&&n.inspect().state==="rejected"}function li(){!g&&typeof window!="undefined"&&window.console&&console.warn("[Q] Unhandled rejection reasons (should be empty):",s);g=!0}function lt(){for(var t,n=0;n<s.length;n++)t=s[n],console.warn("Unhandled rejection reason:",t)}function nt(){if(s.length=0,y.length=0,g=!1,!c&&(c=!0,typeof process!="undefined"&&process.on))process.on("exit",lt)}function ai(n,t){c&&(y.push(n),t&&typeof t.stack!="undefined"?s.push(t.stack):s.push("(no stack) "+t),li())}function vi(n){if(c){var t=dt(y,n);t!==-1&&(y.splice(t,1),s.splice(t,1))}}function f(n){var i=t({when:function(t){return t&&vi(this),t?t(n):this}},function(){return this},function(){return{state:"rejected",reason:n}});return ai(i,n),i}function tt(n){return t({when:function(){return n},get:function(t){return n[t]},set:function(t,i){n[t]=i},"delete":function(t){delete n[t]},post:function(t,i){return t===null||t===void 0?n.apply(void 0,i):n[t].apply(n,i)},apply:function(t,i){return n.apply(t,i)},keys:function(){return ni(n)}},void 0,function(){return{state:"fulfilled",value:n}})}function yi(n){var t=r();return u(function(){try{n.then(t.resolve,t.reject,t.notify)}catch(i){t.reject(i)}}),t.promise}function pi(i){return t({isDef:function(){}},function(n,t){return vt(i,n,t)},function(){return n(i).inspect()})}function at(t,i,r){return n(t).spread(i,r)}function wi(n){return function(){function t(n,t){var o;if(k){try{o=r[n](t)}catch(s){return f(s)}return o.done?o.value:e(o.value,i,u)}try{o=r[n](t)}catch(s){return ii(s)?s.value:f(s)}return e(o,i,u)}var r=n.apply(this,arguments),i=t.bind(t,"next"),u=t.bind(t,"throw");return i()}}function bi(t){n.done(n.async(t)())}function ki(n){throw new b(n);}function di(n){return function(){return at([this,l(arguments)],function(t,i){return n.apply(t,i)})}}function vt(t,i,r){return n(t).dispatch(i,r)}function l(n){return e(n,function(n){var i=0,t=r();return v(n,function(r,u,f){var s;o(u)&&(s=u.inspect()).state==="fulfilled"?n[f]=s.value:(++i,e(u,function(r){n[f]=r;--i==0&&t.resolve(n)},t.reject,function(n){t.notify({index:f,value:n})}))},void 0),i===0&&t.resolve(n),t.promise})}function yt(t){return e(t,function(t){return t=p(t,n),e(l(p(t,function(n){return e(n,rt,rt)})),function(){return t})})}function gi(t){return n(t).allSettled()}function nr(t,i){return n(t).then(void 0,void 0,i)}function tr(t,i){return n(t).nodeify(i)}var a=!1,b,k,d,pt;try{throw new Error;}catch(wt){a=!!wt.stack}var bt=ot(),it,rt=function(){},u=function(){function t(){for(var r,i;n.next;){n=n.next;r=n.task;n.task=void 0;i=n.domain;i&&(n.domain=void 0,i.enter());try{r()}catch(u){if(e){i&&i.exit();setTimeout(t,0);i&&i.enter();throw u;}else setTimeout(function(){throw u;},0)}i&&i.exit()}f=!1}var n={task:void 0,next:null},s=n,f=!1,i=void 0,e=!1,r,o;return u=function(n){s=s.next={task:n,domain:e&&process.domain,next:null};f||(f=!0,i())},typeof process!="undefined"&&process.nextTick?(e=!0,i=function(){process.nextTick(t)}):typeof setImmediate=="function"?i=typeof window!="undefined"?setImmediate.bind(window,t):function(){setImmediate(t)}:typeof MessageChannel!="undefined"?(r=new MessageChannel,r.port1.onmessage=function(){i=o;r.port1.onmessage=t;t()},o=function(){r.port2.postMessage(0)},i=function(){setTimeout(t,0);o()}):i=function(){setTimeout(t,0)},u}(),kt=Function.call;var i=h(Array.prototype.slice),v=h(Array.prototype.reduce||function(n,t){var i=0,r=this.length;if(arguments.length===1)do{if(i in this){t=this[i++];break}if(++i>=r)throw new TypeError;}while(1);for(;i<r;i++)i in this&&(t=n(t,this[i],i));return t}),dt=h(Array.prototype.indexOf||function(n){for(var t=0;t<this.length;t++)if(this[t]===n)return t;return-1}),p=h(Array.prototype.map||function(n,t){var i=this,r=[];return v(i,function(u,f,e){r.push(n.call(t,f,e,i))},void 0),r}),w=Object.create||function(n){function t(){}return t.prototype=n,new t},gt=h(Object.prototype.hasOwnProperty),ni=Object.keys||function(n){var t=[];for(var i in n)gt(n,i)&&t.push(i);return t},ti=h(Object.prototype.toString);b=typeof ReturnValue!="undefined"?ReturnValue:function(n){this.value=n};try{new Function("(function* (){ yield 1; })");k=!0}catch(wt){k=!1}d="From previous event:";n.resolve=n;n.nextTick=u;n.longStackSupport=!1;n.defer=r;r.prototype.makeNodeResolver=function(){var n=this;return function(t,r){t?n.reject(t):arguments.length>2?n.resolve(i(arguments,1)):n.resolve(r)}};n.promise=st;n.passByCopy=function(n){return n};t.prototype.passByCopy=function(){return this};n.join=function(t,i){return n(t).join(i)};t.prototype.join=function(t){return n([this,t]).spread(function(n,t){if(n===t)return n;throw new Error("Can't join: not the same: "+n+" "+t);})};n.race=oi;t.prototype.race=function(){return this.then(n.race)};n.makePromise=t;t.prototype.toString=function(){return"[object Promise]"};t.prototype.then=function(t,i,e){function c(n){try{return typeof t=="function"?t(n):n}catch(i){return f(i)}}function l(n){if(typeof i=="function"){ft(n,h);try{return i(n)}catch(t){return f(t)}}return f(n)}function a(n){return typeof e=="function"?e(n):n}var h=this,o=r(),s=!1;return u(function(){h.promiseDispatch(function(n){s||(s=!0,o.resolve(c(n)))},"when",[function(n){s||(s=!0,o.resolve(l(n)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(t){var i,r=!1;try{i=a(t)}catch(u){if(r=!0,n.onerror)n.onerror(u);else throw u;}r||o.notify(i)}]),o.promise};n.when=e;t.prototype.thenResolve=function(n){return this.then(function(){return n})};n.thenResolve=function(t,i){return n(t).thenResolve(i)};t.prototype.thenReject=function(n){return this.then(function(){throw n;})};n.thenReject=function(t,i){return n(t).thenReject(i)};n.nearer=ht;n.isPromise=o;n.isPromiseAlike=ct;n.isPending=si;t.prototype.isPending=function(){return this.inspect().state==="pending"};n.isFulfilled=hi;t.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled"};n.isRejected=ci;t.prototype.isRejected=function(){return this.inspect().state==="rejected"};var s=[],y=[],g=!1,c=!0;return n.resetUnhandledRejections=nt,n.getUnhandledReasons=function(){return s.slice()},n.stopUnhandledRejectionTracking=function(){nt();typeof process!="undefined"&&process.on&&process.removeListener("exit",lt);c=!1},nt(),n.reject=f,n.fulfill=tt,n.master=pi,n.spread=at,t.prototype.spread=function(n,t){return this.all().then(function(t){return n.apply(void 0,t)},t)},n.async=wi,n.spawn=bi,n["return"]=ki,n.promised=di,n.dispatch=vt,t.prototype.dispatch=function(n,t){var f=this,i=r();return u(function(){f.promiseDispatch(i.resolve,n,t)}),i.promise},n.get=function(t,i){return n(t).dispatch("get",[i])},t.prototype.get=function(n){return this.dispatch("get",[n])},n.set=function(t,i,r){return n(t).dispatch("set",[i,r])},t.prototype.set=function(n,t){return this.dispatch("set",[n,t])},n.del=n["delete"]=function(t,i){return n(t).dispatch("delete",[i])},t.prototype.del=t.prototype["delete"]=function(n){return this.dispatch("delete",[n])},n.mapply=n.post=function(t,i,r){return n(t).dispatch("post",[i,r])},t.prototype.mapply=t.prototype.post=function(n,t){return this.dispatch("post",[n,t])},n.send=n.mcall=n.invoke=function(t,r){return n(t).dispatch("post",[r,i(arguments,2)])},t.prototype.send=t.prototype.mcall=t.prototype.invoke=function(n){return this.dispatch("post",[n,i(arguments,1)])},n.fapply=function(t,i){return n(t).dispatch("apply",[void 0,i])},t.prototype.fapply=function(n){return this.dispatch("apply",[void 0,n])},n["try"]=n.fcall=function(t){return n(t).dispatch("apply",[void 0,i(arguments,1)])},t.prototype.fcall=function(){return this.dispatch("apply",[void 0,i(arguments)])},n.fbind=function(t){var r=n(t),u=i(arguments,1);return function(){return r.dispatch("apply",[this,u.concat(i(arguments))])}},t.prototype.fbind=function(){var n=this,t=i(arguments);return function(){return n.dispatch("apply",[this,t.concat(i(arguments))])}},n.keys=function(t){return n(t).dispatch("keys",[])},t.prototype.keys=function(){return this.dispatch("keys",[])},n.all=l,t.prototype.all=function(){return l(this)},n.allResolved=ei(yt,"allResolved","allSettled"),t.prototype.allResolved=function(){return yt(this)},n.allSettled=gi,t.prototype.allSettled=function(){return this.then(function(t){return l(p(t,function(t){function i(){return t.inspect()}return t=n(t),t.then(i,i)}))})},n.fail=n["catch"]=function(t,i){return n(t).then(void 0,i)},t.prototype.fail=t.prototype["catch"]=function(n){return this.then(void 0,n)},n.progress=nr,t.prototype.progress=function(n){return this.then(void 0,void 0,n)},n.fin=n["finally"]=function(t,i){return n(t)["finally"](i)},t.prototype.fin=t.prototype["finally"]=function(t){return t=n(t),this.then(function(n){return t.fcall().then(function(){return n})},function(n){return t.fcall().then(function(){throw n;})})},n.done=function(t,i,r,u){return n(t).done(i,r,u)},t.prototype.done=function(t,i,r){var f=function(t){u(function(){if(ft(t,e),n.onerror)n.onerror(t);else throw t;})},e=t||i||r?this.then(t,i,r):this;typeof process=="object"&&process&&process.domain&&(f=process.domain.bind(f));e.then(void 0,f)},n.timeout=function(t,i,r){return n(t).timeout(i,r)},t.prototype.timeout=function(n,t){var i=r(),u=setTimeout(function(){i.reject(new Error(t||"Timed out after "+n+" ms"))},n);return this.then(function(n){clearTimeout(u);i.resolve(n)},function(n){clearTimeout(u);i.reject(n)},i.notify),i.promise},n.delay=function(t,i){return i===void 0&&(i=t,t=void 0),n(t).delay(i)},t.prototype.delay=function(n){return this.then(function(t){var i=r();return setTimeout(function(){i.resolve(t)},n),i.promise})},n.nfapply=function(t,i){return n(t).nfapply(i)},t.prototype.nfapply=function(n){var t=r(),u=i(n);return u.push(t.makeNodeResolver()),this.fapply(u).fail(t.reject),t.promise},n.nfcall=function(t){var r=i(arguments,1);return n(t).nfapply(r)},t.prototype.nfcall=function(){var t=i(arguments),n=r();return t.push(n.makeNodeResolver()),this.fapply(t).fail(n.reject),n.promise},n.nfbind=n.denodeify=function(t){var u=i(arguments,1);return function(){var e=u.concat(i(arguments)),f=r();return e.push(f.makeNodeResolver()),n(t).fapply(e).fail(f.reject),f.promise}},t.prototype.nfbind=t.prototype.denodeify=function(){var t=i(arguments);return t.unshift(this),n.denodeify.apply(void 0,t)},n.nbind=function(t,u){var f=i(arguments,2);return function(){function s(){return t.apply(u,arguments)}var o=f.concat(i(arguments)),e=r();return o.push(e.makeNodeResolver()),n(s).fapply(o).fail(e.reject),e.promise}},t.prototype.nbind=function(){var t=i(arguments,0);return t.unshift(this),n.nbind.apply(void 0,t)},n.nmapply=n.npost=function(t,i,r){return n(t).npost(i,r)},t.prototype.nmapply=t.prototype.npost=function(n,t){var f=i(t||[]),u=r();return f.push(u.makeNodeResolver()),this.dispatch("post",[n,f]).fail(u.reject),u.promise},n.nsend=n.nmcall=n.ninvoke=function(t,u){var e=i(arguments,2),f=r();return e.push(f.makeNodeResolver()),n(t).dispatch("post",[u,e]).fail(f.reject),f.promise},t.prototype.nsend=t.prototype.nmcall=t.prototype.ninvoke=function(n){var u=i(arguments,1),t=r();return u.push(t.makeNodeResolver()),this.dispatch("post",[n,u]).fail(t.reject),t.promise},n.nodeify=tr,t.prototype.nodeify=function(n){if(n)this.then(function(t){u(function(){n(null,t)})},function(t){u(function(){n(t)})});else return this},pt=ot(),n});Foundry=Foundry||{};fo=Foundry,function(n,t,i){var r=function(t,r,u,f){var e=t.globalComputeStack();return this.promisedToProperty=e?e.peek():this,this.value=i,this.owner=t,this.myName=r,this.onSuccess=u,this.onFailure=f?f:function(){return n.trace.alert("missing OnFailure")},this.futures=[],this.futureError=function(){return n.trace.alert("Promise was broken")},this};r.prototype={isWaiting:function(){return n.utils.isaProperty(this.promisedToProperty)?!0:n.utils.isArray(this.futures)&&this.futures.length>0},whileWaiting:function(t){return this.isWaiting()&&this.value===i&&n.utils.isFunction(t)&&t(),this},continueWith:function(t){var r=this.value;if(this.isWaiting()||r===i)n.utils.isFunction(t)&&this.futures.push(t);else return this.runFutures(r),n.utils.isFunction(t)&&t(r),this;return this},errorWith:function(n){return this.futureError=n,this},runFutures:function(t){if(n.utils.isArray(this.futures)){for(var r=0,u=this.futures.length>>>0;r<u;r++)this.futures[r](t);this.futures=i;this.futureError=i}},fulfillPromised:function(t){n.utils.isaProperty(this.promisedToProperty)&&(this.value=t,this.promisedToProperty.setValue(t),this.promisedToProperty=i,this.runFutures(t))},breakPromised:function(t){if(this.promisedToProperty=i,this.futures=i,n.utils.isFunction(this.onError))this.onError(t);n.utils.isFunction(this.futureError)&&this.futureError(t)},onComplete:function(t){var i=this;n.runWithUIRefreshLock(function(){i.onSuccess(t)})},onError:function(){var t=this,i=this.arguments;n.runWithUIRefreshLock(function(){t.onFailure(i)})}};n.Component.prototype.createAsyncToken=function(n,t,i){return new r(this,n,t,i)};n.Promise=r}(Foundry,Q);
/*
//# sourceMappingURL=Foundry.core.min.js.map
*/